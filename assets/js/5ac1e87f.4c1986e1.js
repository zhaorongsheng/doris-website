"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["149946"],{865885:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>r,metadata:()=>i,assets:()=>o,toc:()=>a,contentTitle:()=>d});var i=JSON.parse('{"id":"data-operate/import/load-strict-mode","title":"Loading Strict Mode","description":"\x3c!--","source":"@site/versioned_docs/version-2.0/data-operate/import/load-strict-mode.md","sourceDirName":"data-operate/import","slug":"/data-operate/import/load-strict-mode","permalink":"/docs/2.0/data-operate/import/load-strict-mode","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Loading Strict Mode","language":"en"},"sidebar":"docs","previous":{"title":"Minimum Number of Replicas Loading","permalink":"/docs/2.0/data-operate/import/min-load-replica-num"},"next":{"title":"Updating Overview","permalink":"/docs/2.0/data-operate/update/update-overview"}}'),l=t("785893"),s=t("250065");let r={title:"Loading Strict Mode",language:"en"},d="import strict mode",o={},a=[{value:"How to set",id:"how-to-set",level:2},{value:"The role of strict mode",id:"the-role-of-strict-mode",level:2}];function c(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"import-strict-mode",children:"import strict mode"})}),"\n",(0,l.jsx)(n.p,{children:"Strict mode (strict_mode) is configured as a parameter in the import operation. This parameter affects the import behavior of certain values and the final imported data."}),"\n",(0,l.jsx)(n.p,{children:"This document mainly explains how to set strict mode, and the impact of strict mode."}),"\n",(0,l.jsx)(n.h2,{id:"how-to-set",children:"How to set"}),"\n",(0,l.jsx)(n.p,{children:"Strict mode is all False by default, i.e. off."}),"\n",(0,l.jsx)(n.p,{children:"Different import methods set strict mode in different ways."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/Load/BROKER-LOAD",children:"BROKER LOAD"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:'LOAD LABEL example_db.label1\n(\n    DATA INFILE("bos://my_bucket/input/file.txt")\n    INTO TABLE `my_table`\n    COLUMNS TERMINATED BY ","\n)\nWITH BROKER bos\n(\n    "bos_endpoint" = "http://bj.bcebos.com",\n    "bos_accesskey" = "xxxxxxxxxxxxxxxxxxxxxxxxxxx",\n    "bos_secret_accesskey"="yyyyyyyyyyyyyyyyyyyyyyyy"\n)\nPROPERTIES\n(\n    "strict_mode" = "true"\n)\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/Load/STREAM-LOAD",children:"STREAM LOAD"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'curl --location-trusted -u user:passwd \\\n-H "strict_mode: true" \\\n-T 1.txt \\\nhttp://host:port/api/example_db/my_table/_stream_load\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/Load/CREATE-ROUTINE-LOAD",children:"ROUTINE LOAD"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:'CREATE ROUTINE LOAD example_db.test_job ON my_table\nPROPERTIES\n(\n    "strict_mode" = "true"\n)\nFROM KAFKA\n(\n    "kafka_broker_list" = "broker1:9092,broker2:9092,broker3:9092",\n    "kafka_topic" = "my_topic"\n);\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/Manipulation/INSERT",children:"INSERT"})}),"\n",(0,l.jsxs)(n.p,{children:["Set via ",(0,l.jsx)(n.a,{href:"/docs/2.0/query/query-variables/variables",children:"session variables"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SET enable_insert_strict = true;\nINSERT INTO my_table ...;\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"the-role-of-strict-mode",children:"The role of strict mode"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Restricting the filtering of column type conversions during import."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"The strict filtering strategy is as follows:"}),"\n",(0,l.jsxs)(n.p,{children:["For column type conversion, if strict mode is turned on, the wrong data will be filtered. The wrong data here refers to: the original data is not ",(0,l.jsx)(n.code,{children:"null"}),", but the result is ",(0,l.jsx)(n.code,{children:"null"})," after column type conversion."]}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"column type conversion"})," mentioned here does not include the ",(0,l.jsx)(n.code,{children:"null"})," value calculated by the function."]}),"\n",(0,l.jsxs)(n.p,{children:["For an imported column type that contains range restrictions, if the original data can pass the type conversion normally, but cannot pass the range restrictions, strict mode will not affect it. For example: if the type is ",(0,l.jsx)(n.code,{children:"decimal(1,0)"})," and the original data is 10, it belongs to the range that can be converted by type but is not within the scope of the column declaration. This kind of data strict has no effect on it."]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Take the column type as TinyInt as an example:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Primitive data type"}),(0,l.jsx)(n.th,{children:"Primitive data example"}),(0,l.jsx)(n.th,{children:"Converted value to TinyInt"}),(0,l.jsx)(n.th,{children:"Strict mode"}),(0,l.jsx)(n.th,{children:"Result"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"NULL"}),(0,l.jsx)(n.td,{children:"\\N"}),(0,l.jsx)(n.td,{children:"NULL"}),(0,l.jsx)(n.td,{children:"ON or OFF"}),(0,l.jsx)(n.td,{children:"NULL"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Non-null value"}),(0,l.jsx)(n.td,{children:'"abc" or 2000'}),(0,l.jsx)(n.td,{children:"NULL"}),(0,l.jsx)(n.td,{children:"On"}),(0,l.jsx)(n.td,{children:"Illegal value (filtered)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"non-null value"}),(0,l.jsx)(n.td,{children:'"abc"'}),(0,l.jsx)(n.td,{children:"NULL"}),(0,l.jsx)(n.td,{children:"off"}),(0,l.jsx)(n.td,{children:"NULL"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"non-null value"}),(0,l.jsx)(n.td,{children:"1"}),(0,l.jsx)(n.td,{children:"1"}),(0,l.jsx)(n.td,{children:"on or off"}),(0,l.jsx)(n.td,{children:"import correctly"})]})]})]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Description:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Columns in the table allow to import null values"}),"\n",(0,l.jsxs)(n.li,{children:["After ",(0,l.jsx)(n.code,{children:"abc"})," and ",(0,l.jsx)(n.code,{children:"2000"})," are converted to TinyInt, they will become NULL due to type or precision issues. When strict mode is on, this data will be filtered. And if it is closed, ",(0,l.jsx)(n.code,{children:"null"})," will be imported."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Take the column type as Decimal(1,0) as an example"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Primitive Data Types"}),(0,l.jsx)(n.th,{children:"Examples of Primitive Data"}),(0,l.jsx)(n.th,{children:"Converted to Decimal"}),(0,l.jsx)(n.th,{children:"Strict Mode"}),(0,l.jsx)(n.th,{children:"Result"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Null"}),(0,l.jsx)(n.td,{children:"\\N"}),(0,l.jsx)(n.td,{children:"null"}),(0,l.jsx)(n.td,{children:"On or Off"}),(0,l.jsx)(n.td,{children:"NULL"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"non-null value"}),(0,l.jsx)(n.td,{children:"aaa"}),(0,l.jsx)(n.td,{children:"NULL"}),(0,l.jsx)(n.td,{children:"on"}),(0,l.jsx)(n.td,{children:"illegal value (filtered)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"non-null value"}),(0,l.jsx)(n.td,{children:"aaa"}),(0,l.jsx)(n.td,{children:"NULL"}),(0,l.jsx)(n.td,{children:"off"}),(0,l.jsx)(n.td,{children:"NULL"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"non-null value"}),(0,l.jsx)(n.td,{children:"1 or 10"}),(0,l.jsx)(n.td,{children:"1 or 10"}),(0,l.jsx)(n.td,{children:"on or off"}),(0,l.jsx)(n.td,{children:"import correctly"})]})]})]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Description:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Columns in the table allow to import null values"}),"\n",(0,l.jsxs)(n.li,{children:["After ",(0,l.jsx)(n.code,{children:"abc"})," is converted to Decimal, it will become NULL due to type problem. When strict mode is on, this data will be filtered. And if it is closed, ",(0,l.jsx)(n.code,{children:"null"})," will be imported."]}),"\n",(0,l.jsxs)(n.li,{children:["Although ",(0,l.jsx)(n.code,{children:"10"})," is an out-of-range value, because its type conforms to the requirements of decimal, strict mode does not affect it. ",(0,l.jsx)(n.code,{children:"10"})," will eventually be filtered in other import processing flows. But not filtered by strict mode."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Restricting partial column updates to only existing columns"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"In strict mode, when performing partial column updates, each row of data inserted must have a key that already exists in the table. In non-strict mode, partial column updates can update existing rows with existing keys or insert new rows with non-existing keys."}),"\n",(0,l.jsx)(n.p,{children:"For example, consider the following table structure:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"mysql> desc user_profile;\n+------------------+-----------------+------+-------+---------+-------+\n| Field            | Type            | Null | Key   | Default | Extra |\n+------------------+-----------------+------+-------+---------+-------+\n| id               | INT             | Yes  | true  | NULL    |       |\n| name             | VARCHAR(10)     | Yes  | false | NULL    | NONE  |\n| age              | INT             | Yes  | false | NULL    | NONE  |\n| city             | VARCHAR(10)     | Yes  | false | NULL    | NONE  |\n| balance          | DECIMALV3(9, 0) | Yes  | false | NULL    | NONE  |\n| last_access_time | DATETIME        | Yes  | false | NULL    | NONE  |\n+------------------+-----------------+------+-------+---------+-------+\n"})}),"\n",(0,l.jsx)(n.p,{children:"The table contains the following data:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'1,"kevin",18,"shenzhen",400,"2023-07-01 12:00:00"\n'})}),"\n",(0,l.jsx)(n.p,{children:"When a user uses non-strict mode stream load for partial column updates and inserts the following data into the table:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"1,500,2023-07-03 12:00:01\n3,23,2023-07-03 12:00:02\n18,9999999,2023-07-03 12:00:03\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'curl  --location-trusted -u root -H "partial_columns:true" -H "strict_mode:false" -H "column_separator:," -H "columns:id,balance,last_access_time" -T /tmp/test.csv http://host:port/api/db1/user_profile/_stream_load\n'})}),"\n",(0,l.jsx)(n.p,{children:"The existing row in the table will be updated, and two new rows will be inserted. For columns in the inserted data that are not specified by the user, if the column has a default value, it will be filled with the default value. Otherwise, if the column allows NULL, it will be filled with a NULL value. If neither condition is met, the insertion will not succeed."}),"\n",(0,l.jsx)(n.p,{children:"However, when a user uses strict mode stream load for partial column updates and inserts the above data into the table:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'curl  --location-trusted -u root -H "partial_columns:true" -H "strict_mode:true" -H "column_separator:," -H "columns:id,balance,last_access_time" -T /tmp/test.csv http://host:port/api/db1/user_profile/_stream_load\n'})}),"\n",(0,l.jsxs)(n.p,{children:["In this case, since strict mode is enabled and the keys ",(0,l.jsx)(n.code,{children:"(3)"}),", ",(0,l.jsx)(n.code,{children:"(18)"})," in the second and third rows, respectively, do not exist in the original table, the import will fail."]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return d},a:function(){return r}});var i=t(667294);let l={},s=i.createContext(l);function r(e){let n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);