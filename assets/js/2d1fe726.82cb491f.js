"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["507379"],{239458:function(e,s,l){l.r(s),l.d(s,{default:()=>u,frontMatter:()=>i,metadata:()=>n,assets:()=>c,toc:()=>d,contentTitle:()=>o});var n=JSON.parse('{"id":"install/cluster-deployment/k8s-deploy/install-doris-cluster","title":"Deploying Doris Cluster","description":"\x3c!--","source":"@site/versioned_docs/version-2.0/install/cluster-deployment/k8s-deploy/install-doris-cluster.md","sourceDirName":"install/cluster-deployment/k8s-deploy","slug":"/install/cluster-deployment/k8s-deploy/install-doris-cluster","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/install-doris-cluster","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Deploying Doris Cluster","language":"en"},"sidebar":"docs","previous":{"title":"Configuring Doris Cluster","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/install-config-cluster"},"next":{"title":"Accessing Doris Cluster","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/install-access-cluster"}}'),r=l("785893"),t=l("250065");let i={title:"Deploying Doris Cluster",language:"en"},o=void 0,c={},d=[{value:"Deploy cluster",id:"deploy-cluster",level:2},{value:"Deploy using Custom Resource files",id:"deploy-using-custom-resource-files",level:3},{value:"Deploy using Helm",id:"deploy-using-helm",level:3},{value:"View cluster status",id:"view-cluster-status",level:2},{value:"Check cluster status",id:"check-cluster-status",level:3},{value:"Check deployment resource status",id:"check-deployment-resource-status",level:3}];function a(e){let s={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"After planning the cluster topology, you can deploy the Doris cluster in Kubernetes."}),"\n",(0,r.jsx)(s.h2,{id:"deploy-cluster",children:"Deploy cluster"}),"\n",(0,r.jsx)(s.h3,{id:"deploy-using-custom-resource-files",children:"Deploy using Custom Resource files"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Online Deployment"})}),"\n",(0,r.jsx)(s.p,{children:"Deploying a cluster online requires the following steps:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Create namespace:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl create namespace ${namespace}\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"2",children:["\n",(0,r.jsx)(s.li,{children:"Deploy Doris cluster"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl apply -f ./${cluster_sample}.yaml -n ${namespace}\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Offline deployment"})}),"\n",(0,r.jsx)(s.p,{children:"To deploy Doris cluster offline, you need to upload the docker image used by Doris cluster to all nodes on a machine with external network. Then use docker load to install the image on the server. Offline deployment requires the following steps:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Download the required image"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Deploying Doris cluster requires the following images:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-text",children:"selectdb/doris.fe-ubuntu:2.0.2\nselectdb/doris.be-ubuntu:2.0.2\n"})}),"\n",(0,r.jsx)(s.p,{children:"Download the image locally and package it into a tar file"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"## download docker image\ndocker pull selectdb/doris.fe-ubuntu:2.0.2\ndocker pull selectdb/doris.be-ubuntu:2.0.2\n\n## save docker image as a tar package\ndocker save -o doris.fe-ubuntu-v2.0.2.tar selectdb/doris.fe-ubuntu:2.0.2\ndocker save -o doris.be-ubuntu-v2.0.2.tar docker pull selectdb/doris.be-ubuntu:2.0.2\n"})}),"\n",(0,r.jsx)(s.p,{children:"Upload the image tar package to the server and execute the docker load command:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"## load docker image\ndocker load -i doris.fe-ubuntu-v2.0.2.tar\ndocker load -i doris.be-ubuntu-v2.0.2.tar\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"2",children:["\n",(0,r.jsx)(s.li,{children:"Create namespace:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl create namespace ${namespace}\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"3",children:["\n",(0,r.jsx)(s.li,{children:"Deploy Doris cluster"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl apply -f ./${cluster_sample}.yaml -n ${namespace}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"deploy-using-helm",children:"Deploy using Helm"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Online Deployment"})}),"\n",(0,r.jsxs)(s.p,{children:["Before installation, you need to add a deployment warehouse. If it has been added, you can directly install Doris Cluster. Otherwise, please refer to the operation of ",(0,r.jsx)(s.strong,{children:"Add Deployment Warehouse"})," when adding ",(0,r.jsx)(s.a,{href:"/docs/2.0/install/cluster-deployment/k8s-deploy/install-operator#option-3-helm-deploys-doris-operator",children:"Deploy Doris Operator"})]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Install Doris Cluster"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Install ",(0,r.jsx)(s.a,{href:"https://artifacthub.io/packages/helm/doris/doris",children:"doriscluster"}),", using the default configuration this deployment only deploys 3 FE and 3 BE components, using the default ",(0,r.jsx)(s.code,{children:"storageClass"})," to implement PV dynamic provisioning."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"helm install doriscluster doris-repo/doris\n"})}),"\n",(0,r.jsxs)(s.p,{children:["If you need to customize resources and cluster shapes, please customize the resource configuration according to the annotations of each resource configuration in ",(0,r.jsx)(s.a,{href:"https://artifacthub.io/packages/helm/doris/doris?modal=values",children:"values.yaml"})," and execute The following command:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"helm install -f values.yaml doriscluster doris-repo/doris\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"2",children:["\n",(0,r.jsx)(s.li,{children:"Verify doris cluster installation results"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["You can check the pod deployment status through the ",(0,r.jsx)(s.code,{children:"kubectl get pods"})," command. When the Pod of ",(0,r.jsx)(s.code,{children:"doriscluster"})," is in ",(0,r.jsx)(s.code,{children:"Running"})," state and all containers in the Pod are ready, the deployment is successful."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl get pod --namespace doris\n"})}),"\n",(0,r.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"NAME                     READY   STATUS    RESTARTS   AGE\ndoriscluster-helm-fe-0   1/1     Running   0          1m39s\ndoriscluster-helm-fe-1   1/1     Running   0          1m39s\ndoriscluster-helm-fe-2   1/1     Running   0          1m39s\ndoriscluster-helm-be-0   1/1     Running   0          16s\ndoriscluster-helm-be-1   1/1     Running   0          16s\ndoriscluster-helm-be-2   1/1     Running   0          16s\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Offline deployment"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Download the Doris Cluster Chart resource"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Download ",(0,r.jsx)(s.code,{children:"doris-{chart_version}.tgz"})," to install Doris Cluster chart. If you need to download the 1.6.1 version of the Doris cluster, you can use the following command:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"wget https://charts.selectdb.com/doris-1.6.1.tgz\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"2",children:["\n",(0,r.jsx)(s.li,{children:"Install Doris cluster"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Doris cluster can be installed through the ",(0,r.jsx)(s.code,{children:"helm install"})," command."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"helm install doriscluster doris-1.4.0.tgz\n"})}),"\n",(0,r.jsxs)(s.p,{children:["If you need to customize the assembly ",(0,r.jsx)(s.a,{href:"https://artifacthub.io/packages/helm/doris/doris?modal=values",children:"values.yaml"}),", you can refer to the following command:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"helm install -f values.yaml doriscluster doris-1.4.0.tgz\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"3",children:["\n",(0,r.jsx)(s.li,{children:"Verify doris cluster installation results"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["You can check the pod deployment status through the ",(0,r.jsx)(s.code,{children:"kubectl get pods"})," command. When the Pod of ",(0,r.jsx)(s.code,{children:"doriscluster"})," is in ",(0,r.jsx)(s.code,{children:"Running"})," state and all containers in the Pod are ready, the deployment is successful."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl get pod --namespace doris\n"})}),"\n",(0,r.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"NAME                     READY   STATUS    RESTARTS   AGE\ndoriscluster-helm-fe-0   1/1     Running   0          1m39s\ndoriscluster-helm-fe-1   1/1     Running   0          1m39s\ndoriscluster-helm-fe-2   1/1     Running   0          1m39s\ndoriscluster-helm-be-0   1/1     Running   0          16s\ndoriscluster-helm-be-1   1/1     Running   0          16s\ndoriscluster-helm-be-2   1/1     Running   0          16s\n"})}),"\n",(0,r.jsx)(s.h2,{id:"view-cluster-status",children:"View cluster status"}),"\n",(0,r.jsx)(s.h3,{id:"check-cluster-status",children:"Check cluster status"}),"\n",(0,r.jsx)(s.p,{children:"After the cluster deployment resources are delivered, you can check the cluster status by running the following command."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl get pods -n ${namespace}\n"})}),"\n",(0,r.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"NAME                       READY   STATUS    RESTARTS   AGE\ndoriscluster-sample-fe-0   1/1     Running   0          20m\ndoriscluster-sample-be-0   1/1     Running   0          19m\n"})}),"\n",(0,r.jsxs)(s.p,{children:["When the ",(0,r.jsx)(s.code,{children:"STATUS"})," of all pods is in the ",(0,r.jsx)(s.code,{children:"Running"})," state, and all containers in the pods of all components are ",(0,r.jsx)(s.code,{children:"READY"}),", it means that the entire cluster is deployed normally."]}),"\n",(0,r.jsx)(s.h3,{id:"check-deployment-resource-status",children:"Check deployment resource status"}),"\n",(0,r.jsxs)(s.p,{children:["Doris Operator will collect the status of cluster services and display them in the distributed resources. Doris Operator defines the abbreviation ",(0,r.jsx)(s.code,{children:"dcr"})," for the ",(0,r.jsx)(s.code,{children:"DorisCluster"})," type resource name, which can be replaced by the abbreviation when using the resource type to view the cluster status."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"kubectl get dcr\n"})}),"\n",(0,r.jsx)(s.p,{children:"The return result is as follows:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"NAME                  FESTATUS    BESTATUS    CNSTATUS   BROKERSTATUS\ndoriscluster-sample   available   available\n"})}),"\n",(0,r.jsxs)(s.p,{children:["When the ",(0,r.jsx)(s.code,{children:"STATUS"})," of the configured related services is ",(0,r.jsx)(s.code,{children:"available"}),", the cluster deployment is successful."]})]})}function u(e={}){let{wrapper:s}={...(0,t.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},250065:function(e,s,l){l.d(s,{Z:function(){return o},a:function(){return i}});var n=l(667294);let r={},t=n.createContext(r);function i(e){let s=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);