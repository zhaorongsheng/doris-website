"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["713480"],{816078:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>i,metadata:()=>a,assets:()=>d,toc:()=>c,contentTitle:()=>o});var a=JSON.parse('{"id":"lakehouse/datalake-analytics/iceberg","title":"Iceberg Catalog","description":"\x3c!--","source":"@site/versioned_docs/version-2.1/lakehouse/datalake-analytics/iceberg.md","sourceDirName":"lakehouse/datalake-analytics","slug":"/lakehouse/datalake-analytics/iceberg","permalink":"/docs/lakehouse/datalake-analytics/iceberg","draft":false,"unlisted":false,"tags":[],"version":"2.1","frontMatter":{"title":"Iceberg Catalog","language":"en"},"sidebar":"docs","previous":{"title":"Hudi Catalog","permalink":"/docs/lakehouse/datalake-analytics/hudi"},"next":{"title":"Paimon Catalog","permalink":"/docs/lakehouse/datalake-analytics/paimon"}}'),r=s("785893"),t=s("250065");let i={title:"Iceberg Catalog",language:"en"},o=void 0,d={},c=[{value:"Limitations",id:"limitations",level:2},{value:"Create Catalog",id:"create-catalog",level:2},{value:"Create Catalog Based on Hive Metastore",id:"create-catalog-based-on-hive-metastore",level:3},{value:"Create Catalog based on Iceberg API",id:"create-catalog-based-on-iceberg-api",level:3},{value:"Hadoop Catalog",id:"hadoop-catalog",level:4},{value:"Hive Metastore",id:"hive-metastore",level:4},{value:"AWS Glue",id:"aws-glue",level:4},{value:"Alibaba Cloud DLF",id:"alibaba-cloud-dlf",level:4},{value:"REST Catalog",id:"rest-catalog",level:4},{value:"Google Dataproc Metastore",id:"google-dataproc-metastore",level:4},{value:"Iceberg On Object Storage",id:"iceberg-on-object-storage",level:3},{value:"Example",id:"example",level:2},{value:"Column type mapping",id:"column-type-mapping",level:2},{value:"Time Travel",id:"time-travel",level:2}];function l(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://doris.apache.org/docs/gettingStarted/tutorials/doris-iceberg",children:"Apache Doris & Iceberg Quick Start"})}),"\n",(0,r.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Supports Iceberg V1/V2."}),"\n",(0,r.jsx)(n.li,{children:"Supports Position Delete"}),"\n",(0,r.jsx)(n.li,{children:"Supports Equality Delete since 2.1.3"}),"\n",(0,r.jsx)(n.li,{children:"Supports Parquet format."}),"\n",(0,r.jsx)(n.li,{children:"Supports ORC format since 2.1.3."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"create-catalog",children:"Create Catalog"}),"\n",(0,r.jsx)(n.h3,{id:"create-catalog-based-on-hive-metastore",children:"Create Catalog Based on Hive Metastore"}),"\n",(0,r.jsxs)(n.p,{children:["It is basically the same as Hive Catalog, and only a simple example is given here. See ",(0,r.jsx)(n.a,{href:"/docs/lakehouse/datalake-analytics/hive",children:"Hive Catalog"})," for other examples."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.21.0.1:7004',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:4007',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:4007',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"create-catalog-based-on-iceberg-api",children:"Create Catalog based on Iceberg API"}),"\n",(0,r.jsx)(n.p,{children:"Use the Iceberg API to access metadata, and support services such as Hadoop File System, Hive, REST, DLF and Glue as Iceberg's Catalog."}),"\n",(0,r.jsx)(n.h4,{id:"hadoop-catalog",children:"Hadoop Catalog"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Note: The path of ",(0,r.jsx)(n.code,{children:"warehouse"})," should point to the parent path of ",(0,r.jsx)(n.code,{children:"Database"})," level."]}),"\n",(0,r.jsxs)(n.p,{children:["Eg: If you path is like ",(0,r.jsx)(n.code,{children:"s3://bucket/path/to/db1/table1"}),", the ",(0,r.jsx)(n.code,{children:"warehouse"})," should be ",(0,r.jsx)(n.code,{children:"s3://bucket/path/to/"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hadoop PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'hdfs://your-host:8020/dir/key'\n);\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hadoop_ha PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'hdfs://your-nameservice/dir/key',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:4007',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:4007',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_s3 PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 's3://bucket/dir/key',\n    's3.endpoint' = 's3.us-east-1.amazonaws.com',\n    's3.access_key' = 'ak',\n    's3.secret_key' = 'sk'\n);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"hive-metastore",children:"Hive Metastore"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type'='hms',\n    'hive.metastore.uris' = 'thrift://172.21.0.1:7004',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:4007',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:4007',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"aws-glue",children:"AWS Glue"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["When connecting Glue, if it's not on the EC2 environment, need copy the ",(0,r.jsx)(n.code,{children:"~/.aws"})," from the EC2 environment to the current environment. And can also download and configure the ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"AWS Cli tools"}),", which also creates the ",(0,r.jsx)(n.code,{children:".aws"})," directory under the current user directory.\nPlease upgrade to Doris 2.1.7, 3.0.3 or later version to connect to Glue."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'-- Using access key and secret key\nCREATE CATALOG glue2 PROPERTIES (\n    "type"="iceberg",\n    "iceberg.catalog.type" = "glue",\n    "glue.endpoint" = "https://glue.us-east-1.amazonaws.com/",\n    "client.credentials-provider" = "com.amazonaws.glue.catalog.credentials.ConfigAWSProvider",\n    "client.credentials-provider.glue.access_key" = "ak",\n    "client.credentials-provider.glue.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["For Iceberg properties, see ",(0,r.jsx)(n.a,{href:"https://iceberg.apache.org/docs/latest/aws/#glue-catalog",children:"Iceberg Glue Catalog"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If you do not specify ",(0,r.jsx)(n.code,{children:"client.credentials-provider"}),", the default DefaultAWSCredentialsProviderChain will be used, and it will read credentials and the system environment variables or instance profile properties on AWS EC2."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"alibaba-cloud-dlf",children:"Alibaba Cloud DLF"}),"\n",(0,r.jsxs)(n.p,{children:["see ",(0,r.jsx)(n.a,{href:"/docs/lakehouse/datalake-analytics/dlf",children:"Alibaba Cloud DLF Catalog"})]}),"\n",(0,r.jsx)(n.h4,{id:"rest-catalog",children:"REST Catalog"}),"\n",(0,r.jsx)(n.p,{children:"This method needs to provide REST services in advance, and users need to implement the REST interface for obtaining Iceberg metadata."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type'='rest',\n    'uri' = 'http://172.21.0.1:8181'\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:"If the data is on HDFS and High Availability (HA) is set up, need to add HA configuration to the Catalog."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg PROPERTIES (\n    'type'='iceberg',\n    'iceberg.catalog.type'='rest',\n    'uri' = 'http://172.21.0.1:8181',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.1:8020',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.2:8020',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"google-dataproc-metastore",children:"Google Dataproc Metastore"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG iceberg PROPERTIES (\n    "type"="iceberg",\n    "iceberg.catalog.type"="hms",\n    "hive.metastore.uris" = "thrift://172.21.0.1:9083",\n    "gs.endpoint" = "https://storage.googleapis.com",\n    "gs.region" = "us-east-1",\n    "gs.access_key" = "ak",\n    "gs.secret_key" = "sk",\n    "use_path_style" = "true"\n);\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"hive.metastore.uris"}),": Dataproc Metastore URI\uFF0CSee in Metastore Services \uFF1A",(0,r.jsx)(n.a,{href:"https://console.cloud.google.com/dataproc/metastore",children:"Dataproc Metastore Services"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"iceberg-on-object-storage",children:"Iceberg On Object Storage"}),"\n",(0,r.jsx)(n.p,{children:"If the data is stored on S3, the following parameters can be used in properties:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"s3.access_key" = "ak"\n"s3.secret_key" = "sk"\n"s3.endpoint" = "s3.us-east-1.amazonaws.com"\n"s3.region" = "us-east-1"\n'})}),"\n",(0,r.jsx)(n.p,{children:"The data is stored on Alibaba Cloud OSS:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"oss.access_key" = "ak"\n"oss.secret_key" = "sk"\n"oss.endpoint" = "oss-cn-beijing-internal.aliyuncs.com"\n"oss.region" = "oss-cn-beijing"\n'})}),"\n",(0,r.jsx)(n.p,{children:"The data is stored on Tencent Cloud COS:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"cos.access_key" = "ak"\n"cos.secret_key" = "sk"\n"cos.endpoint" = "cos.ap-beijing.myqcloud.com"\n"cos.region" = "ap-beijing"\n'})}),"\n",(0,r.jsx)(n.p,{children:"The data is stored on Huawei Cloud OBS:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"obs.access_key" = "ak"\n"obs.secret_key" = "sk"\n"obs.endpoint" = "obs.cn-north-4.myhuaweicloud.com"\n"obs.region" = "cn-north-4"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'-- MinIO & Rest Catalog\nCREATE CATALOG `iceberg` PROPERTIES (\n    "type" = "iceberg",\n    "iceberg.catalog.type" = "rest",\n    "uri" = "http://10.0.0.1:8181",\n    "warehouse" = "s3://bucket",\n    "token" = "token123456",\n    "s3.access_key" = "ak",\n    "s3.secret_key" = "sk",\n    "s3.endpoint" = "http://10.0.0.1:9000",\n    "s3.region" = "us-east-1"\n);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"column-type-mapping",children:"Column type mapping"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Iceberg Type"}),(0,r.jsx)(n.th,{children:"Doris Type"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:"boolean"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"int"}),(0,r.jsx)(n.td,{children:"int"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"long"}),(0,r.jsx)(n.td,{children:"bigint"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{children:"float"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"double"}),(0,r.jsx)(n.td,{children:"double"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"decimal(p,s)"}),(0,r.jsx)(n.td,{children:"decimal(p,s)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"date"}),(0,r.jsx)(n.td,{children:"date"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"uuid"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"timestamp (Timestamp without timezone)"}),(0,r.jsx)(n.td,{children:"datetime(6)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"timestamptz (Timestamp with timezone)"}),(0,r.jsx)(n.td,{children:"datetime(6)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"fixed(L)"}),(0,r.jsx)(n.td,{children:"char(L)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"binary"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"struct"}),(0,r.jsx)(n.td,{children:"struct (since 2.1.3)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"map"}),(0,r.jsx)(n.td,{children:"map (since 2.1.3)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"list"}),(0,r.jsx)(n.td,{children:"array"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"time"}),(0,r.jsx)(n.td,{children:"unsupported"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"time-travel",children:"Time Travel"}),"\n",(0,r.jsx)(n.p,{children:"Supports reading the snapshot specified by the Iceberg table."}),"\n",(0,r.jsx)(n.p,{children:"Every write operation to the iceberg table will generate a new snapshot."}),"\n",(0,r.jsx)(n.p,{children:"By default, read requests will only read the latest version of the snapshot."}),"\n",(0,r.jsxs)(n.p,{children:["You can use the ",(0,r.jsx)(n.code,{children:"FOR TIME AS OF"})," and ",(0,r.jsx)(n.code,{children:"FOR VERSION AS OF"})," statements to read historical versions of data based on the snapshot ID or the time when the snapshot was generated. Examples are as follows:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:'SELECT * FROM iceberg_tbl FOR TIME AS OF "2022-10-07 17:20:37";'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"SELECT * FROM iceberg_tbl FOR VERSION AS OF 868895038966572;"})}),"\n",(0,r.jsxs)(n.p,{children:["In addition, you can use the ",(0,r.jsx)(n.a,{href:"/docs/sql-manual/sql-functions/table-valued-functions/iceberg-meta",children:"iceberg_meta"})," table function to query the snapshot information of the specified table."]})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return o},a:function(){return i}});var a=s(667294);let r={},t=a.createContext(r);function i(e){let n=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);