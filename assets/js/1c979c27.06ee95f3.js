"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["673134"],{402941:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>i,metadata:()=>l,assets:()=>c,toc:()=>o,contentTitle:()=>a});var l=JSON.parse('{"id":"sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-POLICY","title":"CREATE-POLICY","description":"\x3c!--","source":"@site/versioned_docs/version-2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-POLICY.md","sourceDirName":"sql-manual/sql-reference/Data-Definition-Statements/Create","slug":"/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-POLICY","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-POLICY","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"CREATE-POLICY","language":"en"},"sidebar":"docs","previous":{"title":"CREATE-FILE","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-FILE"},"next":{"title":"CREATE-ENCRYPT-KEY","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-ENCRYPT-KEY"}}'),s=t("785893"),r=t("250065");let i={title:"CREATE-POLICY",language:"en"},a=void 0,c={},o=[{value:"CREATE-POLICY",id:"create-policy",level:2},{value:"Name",id:"name",level:3},{value:"Description",id:"description",level:3},{value:"Grammar:",id:"grammar",level:4},{value:"Example",id:"example",level:3},{value:"Keywords",id:"keywords",level:3},{value:"Best Practice",id:"best-practice",level:3}];function d(e){let n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"create-policy",children:"CREATE-POLICY"}),"\n",(0,s.jsx)(n.h3,{id:"name",children:"Name"}),"\n",(0,s.jsx)(n.p,{children:"CREATE POLICY"}),"\n",(0,s.jsx)(n.h3,{id:"description",children:"Description"}),"\n",(0,s.jsx)(n.p,{children:"Create policies,such as:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create security policies(ROW POLICY) and explain to view the rewritten SQL."}),"\n",(0,s.jsx)(n.li,{children:"Create storage migration policy(STORAGE POLICY), used for cold and hot data transform"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"grammar",children:"Grammar:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"ROW POLICY"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_1 ON test.table1 \nAS {RESTRICTIVE|PERMISSIVE} TO test USING (id in (1, 2));\n"})}),"\n",(0,s.jsx)(n.p,{children:"illustrate\uFF1A"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"filterType\uFF1AIt is usual to constrict a set of policies through AND. PERMISSIVE to constrict a set of policies through OR"}),"\n",(0,s.jsx)(n.li,{children:"Configure multiple policies. First, merge the RESTRICTIVE policy with the PERMISSIVE policy"}),"\n",(0,s.jsx)(n.li,{children:"It is connected with AND between RESTRICTIVE AND PERMISSIVE"}),"\n",(0,s.jsx)(n.li,{children:"It cannot be created for users root and admin"}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"STORAGE POLICY"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE STORAGE POLICY test_storage_policy_1\nPROPERTIES ("key"="value", ...);\n'})}),"\n",(0,s.jsx)(n.p,{children:"illustrate\uFF1A"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["PROPERTIES has such keys:\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"storage_resource\uFF1Astorage resource name for policy"}),"\n",(0,s.jsx)(n.li,{children:"cooldown_datetime\uFF1Acool down time for tablet, can't be set with cooldown_ttl."}),"\n",(0,s.jsx)(n.li,{children:"cooldown_ttl\uFF1Ahot data stay time. The time cost between the time of tablet created and\nthe time of migrated to cold data, formatted as\uFF1A\n1d\uFF1A1 day\n1h\uFF1A1 hour\n50000: 50000 second"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create a set of row security policies"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_1 ON test.table1 \nAS RESTRICTIVE TO test USING (c1 = 'a');\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_2 ON test.table1 \nAS RESTRICTIVE TO test USING (c2 = 'b');\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_3 ON test.table1 \nAS PERMISSIVE TO test USING (c3 = 'c');\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE ROW POLICY test_row_policy_3 ON test.table1 \nAS PERMISSIVE TO test USING (c4 = 'd');\n"})}),"\n",(0,s.jsx)(n.p,{children:"When we execute the query on Table1, the rewritten SQL is"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"select * from (select * from table1 where c1 = 'a' and c2 = 'b' or c3 = 'c' or c4 = 'd')\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create policy for storage"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["NOTE\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"To create a cold hot separation policy, you must first create a resource, and then associate the created resource name when creating a migration policy"}),"\n",(0,s.jsx)(n.li,{children:"Currently, the drop data migration policy is not supported to prevent data from being migrated. If the policy has been deleted, then the system cannot retrieve the data"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Create policy on cooldown_datetime"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE STORAGE POLICY testPolicy\nPROPERTIES(\n  "storage_resource" = "s3",\n  "cooldown_datetime" = "2022-06-08 00:00:00"\n);\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Create policy on cooldown_ttl"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE STORAGE POLICY testPolicy\nPROPERTIES(\n  "storage_resource" = "s3",\n  "cooldown_ttl" = "1d"\n);\n'})}),"\n",(0,s.jsx)(n.p,{children:"Relevant parameters are as follows:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"storage_resource"}),":  the storage resource of create"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cooldown_datetime"}),": Data migration time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cooldown_ttl"}),": Countdown of the distance between the migrated data and the current time"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"keywords",children:"Keywords"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CREATE, POLICY\n"})}),"\n",(0,s.jsx)(n.h3,{id:"best-practice",children:"Best Practice"})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return a},a:function(){return i}});var l=t(667294);let s={},r=l.createContext(s);function i(e){let n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);