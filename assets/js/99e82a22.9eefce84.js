"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["457882"],{8619:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>i,metadata:()=>o,assets:()=>a,toc:()=>d,contentTitle:()=>l});var o=JSON.parse('{"id":"admin-manual/cluster-management/elastic-expansion","title":"Elastic scaling","description":"\x3c!--","source":"@site/versioned_docs/version-2.0/admin-manual/cluster-management/elastic-expansion.md","sourceDirName":"admin-manual/cluster-management","slug":"/admin-manual/cluster-management/elastic-expansion","permalink":"/docs/2.0/admin-manual/cluster-management/elastic-expansion","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Elastic scaling","language":"en"},"sidebar":"docs","previous":{"title":"Cluster Upgrade","permalink":"/docs/2.0/admin-manual/cluster-management/upgrade"},"next":{"title":"Load Balancing","permalink":"/docs/2.0/admin-manual/cluster-management/load-balancing"}}'),s=t("785893"),r=t("250065");let i={title:"Elastic scaling",language:"en"},l="Elastic scaling",a={},d=[{value:"FE Scaling",id:"fe-scaling",level:2},{value:"Adding FE nodes",id:"adding-fe-nodes",level:3},{value:"Configure and start Follower or Observer.",id:"configure-and-start-follower-or-observer",level:4},{value:"Add Follower or Observer to the cluster",id:"add-follower-or-observer-to-the-cluster",level:4},{value:"Delete FE nodes",id:"delete-fe-nodes",level:3},{value:"BE Scaling",id:"be-scaling",level:2},{value:"Add BE nodes",id:"add-be-nodes",level:3},{value:"Delete BE nodes",id:"delete-be-nodes",level:3},{value:"Broker Scaling",id:"broker-scaling",level:2}];function c(e){let n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"elastic-scaling",children:"Elastic scaling"})}),"\n",(0,s.jsx)(n.p,{children:"Doris can easily expand and shrink FE, BE, Broker instances."}),"\n",(0,s.jsx)(n.h2,{id:"fe-scaling",children:"FE Scaling"}),"\n",(0,s.jsx)(n.p,{children:"High availability of FE can be achieved by expanding FE to three top-one nodes."}),"\n",(0,s.jsx)(n.p,{children:"Users can login to Master FE through MySQL client. By:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"SHOW PROC '/frontends';"})}),"\n",(0,s.jsx)(n.p,{children:"To view the current FE node situation."}),"\n",(0,s.jsxs)(n.p,{children:["You can also view the FE node through the front-end page connection: ",(0,s.jsx)(n.code,{children:"http://fe_hostname:fe_http_port/frontend"})," or ",(0,s.jsx)(n.code,{children:"http://fe_hostname:fe_http_port/system?Path=//frontends"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"All of the above methods require Doris's root user rights."}),"\n",(0,s.jsx)(n.p,{children:"The process of FE node expansion and contraction does not affect the current system operation."}),"\n",(0,s.jsx)(n.h3,{id:"adding-fe-nodes",children:"Adding FE nodes"}),"\n",(0,s.jsx)(n.p,{children:"FE is divided into two roles: Follower and Observer. The Follower role will elect a Follower node as the Master. By default, a cluster can only have one Follower role in the Master state, and there can be multiple Followers and Observers. At the same time, it is necessary to ensure that there are an odd number of Follower roles. All Follower roles form an election group. If the Follower in the Master state goes down, the remaining Followers will automatically elect a new Master to ensure high write availability. Observer synchronizes the data of Master, but does not participate in the election. If only one FE is deployed, the FE is the Master by default."}),"\n",(0,s.jsx)(n.p,{children:"The first FE to start automatically becomes Master. On this basis, several Followers and Observers can be added."}),"\n",(0,s.jsx)(n.h4,{id:"configure-and-start-follower-or-observer",children:"Configure and start Follower or Observer."}),"\n",(0,s.jsx)(n.p,{children:"Follower and Observer are configured with Master. The following commands need to be executed at the first startup:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"bin/start_fe.sh --helper host:edit_log_port --daemon"})}),"\n",(0,s.jsx)(n.p,{children:"The host is the node IP of Master, and the edit_log_port in Lead's configuration file fe.conf. The --helper is only required when follower/observer is first startup."}),"\n",(0,s.jsx)(n.h4,{id:"add-follower-or-observer-to-the-cluster",children:"Add Follower or Observer to the cluster"}),"\n",(0,s.jsx)(n.p,{children:"Add Follower or Observer. Connect to the started FE using mysql-client and execute:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'ALTER SYSTEM ADD FOLLOWER "follower_host:edit_log_port";'})}),"\n",(0,s.jsx)(n.p,{children:"or"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'ALTER SYSTEM ADD OBSERVER "observer_host:edit_log_port";'})}),"\n",(0,s.jsx)(n.p,{children:"The follower_host and observer_host is the node IP of Follower or Observer, and the edit_log_port in its configuration file fe.conf."}),"\n",(0,s.jsx)(n.p,{children:"View the status of Follower or Observer. Connect to any booted FE using mysql-client and execute:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"SHOW PROC '/frontends';"})}),"\n",(0,s.jsx)(n.p,{children:"You can view the FE currently joined the cluster and its corresponding roles."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Notes for FE expansion:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The number of Follower FEs (including Masters) must be odd. It is recommended that a maximum of three constituent high availability (HA) modes be deployed."}),"\n",(0,s.jsx)(n.li,{children:"When FE is in a highly available deployment (1 Master, 2 Follower), we recommend that the reading service capability of FE be extended by adding Observer FE. Of course, you can continue to add Follower FE, but it's almost unnecessary."}),"\n",(0,s.jsx)(n.li,{children:"Usually a FE node can handle 10-20 BE nodes. It is suggested that the total number of FE nodes should be less than 10. Usually three can meet most of the needs."}),"\n",(0,s.jsx)(n.li,{children:"The helper cannot point to the FE itself, it must point to one or more existing running Master/Follower FEs."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"delete-fe-nodes",children:"Delete FE nodes"}),"\n",(0,s.jsx)(n.p,{children:"Delete the corresponding FE node using the following command:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'ALTER SYSTEM DROP FOLLOWER[OBSERVER] "fe_host:edit_log_port";'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Notes for FE contraction:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"When deleting Follower FE, make sure that the remaining Follower (including Master) nodes are odd."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"be-scaling",children:"BE Scaling"}),"\n",(0,s.jsx)(n.p,{children:"Users can login to Master FE through mysql-client. By:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"SHOW PROC '/backends';"})}),"\n",(0,s.jsx)(n.p,{children:"To see the current BE node situation."}),"\n",(0,s.jsxs)(n.p,{children:["You can also view the BE node through the front-end page connection: ",(0,s.jsx)(n.code,{children:"http://fe_hostname:fe_http_port/backend"})," or ",(0,s.jsx)(n.code,{children:"http://fe_hostname:fe_http_port/system?Path=//backends"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"All of the above methods require Doris's root user rights."}),"\n",(0,s.jsxs)(n.p,{children:["The expansion and scaling process of BE nodes does not affect the current system operation and the tasks being performed, and does not affect the performance of the current system. Data balancing is done automatically. Depending on the amount of data available in the cluster, the cluster will be restored to load balancing in a few hours to a day. For cluster load, see the ",(0,s.jsx)(n.a,{href:"../cluster-management/load-balancing",children:"Tablet Load Balancing Document"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"add-be-nodes",children:"Add BE nodes"}),"\n",(0,s.jsxs)(n.p,{children:["The BE node is added in the same way as in the ",(0,s.jsx)(n.strong,{children:"BE deployment"})," section. The BE node is added by the ",(0,s.jsx)(n.code,{children:"ALTER SYSTEM ADD BACKEND"})," command."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Notes for BE expansion:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"After BE expansion, Doris will automatically balance the data according to the load, without affecting the use during the period."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"delete-be-nodes",children:"Delete BE nodes"}),"\n",(0,s.jsx)(n.p,{children:"There are two ways to delete BE nodes: DROP and DECOMMISSION"}),"\n",(0,s.jsx)(n.p,{children:"The DROP statement is as follows:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'ALTER SYSTEM DROP BACKEND "be_host:be_heartbeat_service_port";'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Note: DROP BACKEND will delete the BE directly and the data on it will not be recovered!!! So we strongly do not recommend DROP BACKEND to delete BE nodes. When you use this statement, there will be corresponding error-proof operation hints."})}),"\n",(0,s.jsx)(n.p,{children:"DECOMMISSION clause:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'ALTER SYSTEM DECOMMISSION BACKEND "be_host:be_heartbeat_service_port";'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"DECOMMISSION notes:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"This command is used to safely delete BE nodes. After the command is issued, Doris attempts to migrate the data on the BE to other BE nodes, and when all data is migrated, Doris automatically deletes the node."}),"\n",(0,s.jsxs)(n.li,{children:["The command is an asynchronous operation. After execution, you can see that the BE node's ",(0,s.jsx)(n.code,{children:"SystemDecommissioned"})," status is true through ``SHOW PROC '/backends';` Indicates that the node is offline."]}),"\n",(0,s.jsxs)(n.li,{children:["The order ",(0,s.jsx)(n.strong,{children:"does not necessarily carry out successfully"}),". For example, when the remaining BE storage space is insufficient to accommodate the data on the offline BE, or when the number of remaining machines does not meet the minimum number of replicas, the command cannot be completed, and the BE will always be in the state of ",(0,s.jsx)(n.code,{children:"SystemDecommissioned"})," as true."]}),"\n",(0,s.jsxs)(n.li,{children:["The progress of DECOMMISSION can be viewed through ",(0,s.jsx)(n.code,{children:"SHOW PROC '/backends';"})," Tablet Num, and if it is in progress, Tablet Num will continue to decrease."]}),"\n",(0,s.jsxs)(n.li,{children:["The operation can be carried out by:\n",(0,s.jsx)(n.code,{children:'CANCEL ALTER SYSTEM DECOMMISSION BACKEND "be_host:be_heartbeat_service_port";'}),"\nThe order was cancelled. When cancelled, the data on the BE will maintain the current amount of data remaining. Follow-up Doris re-load balancing"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["For expansion and scaling of BE nodes in multi-tenant deployment environments, please refer to the ",(0,s.jsx)(n.a,{href:"../../admin-manual/resource-admin/multi-tenant",children:"Multi-tenant Design Document"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"broker-scaling",children:"Broker Scaling"}),"\n",(0,s.jsx)(n.p,{children:"There is no rigid requirement for the number of Broker instances. Usually one physical machine is deployed. Broker addition and deletion can be accomplished by following commands:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:'ALTER SYSTEM ADD BROKER broker_name "broker_host:broker_ipc_port";'}),"\n",(0,s.jsx)(n.code,{children:'ALTER SYSTEM DROP BROKER broker_name "broker_host:broker_ipc_port";'}),"\n",(0,s.jsx)(n.code,{children:"ALTER SYSTEM DROP ALL BROKER broker_name;"})]}),"\n",(0,s.jsx)(n.p,{children:"Broker is a stateless process that can be started or stopped at will. Of course, when it stops, the job running on it will fail. Just try again."})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return l},a:function(){return i}});var o=t(667294);let s={},r=o.createContext(s);function i(e){let n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);