"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["927538"],{627051:function(e,n,i){i.r(n),i.d(n,{default:()=>h,frontMatter:()=>a,metadata:()=>t,assets:()=>l,toc:()=>c,contentTitle:()=>o});var t=JSON.parse('{"id":"lakehouse/datalake-analytics/hive","title":"Hive Catalog","description":"\x3c!--","source":"@site/versioned_docs/version-2.1/lakehouse/datalake-analytics/hive.md","sourceDirName":"lakehouse/datalake-analytics","slug":"/lakehouse/datalake-analytics/hive","permalink":"/docs/lakehouse/datalake-analytics/hive","draft":false,"unlisted":false,"tags":[],"version":"2.1","frontMatter":{"title":"Hive Catalog","language":"en"},"sidebar":"docs","previous":{"title":"Data Lakehouse Overview","permalink":"/docs/lakehouse/lakehouse-overview"},"next":{"title":"Hudi Catalog","permalink":"/docs/lakehouse/datalake-analytics/hudi"}}'),r=i("785893"),s=i("250065");let a={title:"Hive Catalog",language:"en"},o=void 0,l={},c=[{value:"Terms and Conditions",id:"terms-and-conditions",level:2},{value:"Create Catalog",id:"create-catalog",level:2},{value:"Hive On HDFS",id:"hive-on-hdfs",level:3},{value:"Hive On ViewFS",id:"hive-on-viewfs",level:3},{value:"Hive On JuiceFS",id:"hive-on-juicefs",level:3},{value:"Doris query DLC",id:"doris-query-dlc",level:3},{value:"Hive On S3",id:"hive-on-s3",level:3},{value:"Hive On OSS",id:"hive-on-oss",level:3},{value:"Hive On OSS-HDFS",id:"hive-on-oss-hdfs",level:3},{value:"Hive On OBS",id:"hive-on-obs",level:3},{value:"Hive On COS",id:"hive-on-cos",level:3},{value:"Hive With Glue",id:"hive-with-glue",level:3},{value:"Metadata Cache &amp; Refresh",id:"metadata-cache--refresh",level:2},{value:"Subscribe to Hive Metastore",id:"subscribe-to-hive-metastore",level:3},{value:"Hive Version",id:"hive-version",level:2},{value:"Column type mapping",id:"column-type-mapping",level:2},{value:"Query Hive partitions",id:"query-hive-partitions",level:2},{value:"Access HMS with broker",id:"access-hms-with-broker",level:2},{value:"Integrate with Apache Ranger",id:"integrate-with-apache-ranger",level:2},{value:"Settings",id:"settings",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Connect to Kerberos enabled Hive",id:"connect-to-kerberos-enabled-hive",level:2},{value:"Environment preparation",id:"environment-preparation",level:3},{value:"Catalog configuration",id:"catalog-configuration",level:3},{value:"Multi-Kerberos Cluster Configuration",id:"multi-kerberos-cluster-configuration",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Hive Transactional Tables",id:"hive-transactional-tables",level:2},{value:"Supported Operations for Hive Transactional Tables",id:"supported-operations-for-hive-transactional-tables",level:3},{value:"Current Limitations",id:"current-limitations",level:3},{value:"Best Practices",id:"best-practices-1",level:2}];function d(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"By connecting to Hive Metastore, or a metadata service compatible with Hive Metatore, Doris can automatically obtain Hive database table information and perform data queries."}),"\n",(0,r.jsx)(n.p,{children:"In addition to Hive, many other systems also use the Hive Metastore to store metadata. So through Hive Catalog, we can not only access Hive, but also access systems that use Hive Metastore as metadata storage. Such as Iceberg, Hudi, etc."}),"\n",(0,r.jsx)(n.h2,{id:"terms-and-conditions",children:"Terms and Conditions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Need to put core-site.xml, hdfs-site.xml and hive-site.xml in the conf directory of FE and BE. First read the hadoop configuration file in the conf directory, and then read the related to the environment variable ",(0,r.jsx)(n.code,{children:"HADOOP_CONF_DIR"})," configuration file."]}),"\n",(0,r.jsx)(n.li,{children:"hive supports version 1/2/3."}),"\n",(0,r.jsx)(n.li,{children:"Support Managed Table and External Table and part of Hive View."}),"\n",(0,r.jsx)(n.li,{children:"Can identify hive, iceberg, hudi metadata stored in Hive Metastore."}),"\n",(0,r.jsx)(n.li,{children:"If the Hadoop node is configured with hostname, please ensure to add the corresponding mapping relationship to the /etc/hosts file."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"create-catalog",children:"Create Catalog"}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-hdfs",children:"Hive On HDFS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hadoop.username' = 'hive'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In addition to the two required parameters of ",(0,r.jsx)(n.code,{children:"type"})," and ",(0,r.jsx)(n.code,{children:"hive.metastore.uris"}),", more parameters can be passed to pass the information required for the connection."]}),"\n",(0,r.jsxs)(n.p,{children:["Most of this properties can be found in ",(0,r.jsx)(n.code,{children:"core-site.xml"}),", ",(0,r.jsx)(n.code,{children:"hdfs-site.xml"})," and ",(0,r.jsx)(n.code,{children:"hive-site.xml"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"If HDFS HA information is provided, the example is as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:8088',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:8088',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["About Kerberos, please see ",(0,r.jsx)(n.code,{children:"Connect to Kerberos enabled Hive"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-viewfs",children:"Hive On ViewFS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices'='your-nameservice',\n    'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:8088',\n    'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:8088',\n    'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider',\n    'fs.defaultFS' = 'viewfs://your-cluster',\n    'fs.viewfs.mounttable.your-cluster.link./ns1' = 'hdfs://your-nameservice/',\n    'fs.viewfs.mounttable.your-cluster.homedir' = '/ns1'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["ViewFs related parameters can be added to the catalog configuration as above, or added to ",(0,r.jsx)(n.code,{children:"conf/core-site.xml"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["How ViewFs works and parameter configuration, please refer to relevant hadoop documents, for example, ",(0,r.jsx)(n.a,{href:"https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/ViewFs.html",children:"https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/ViewFs.html"})]}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-juicefs",children:"Hive On JuiceFS"}),"\n",(0,r.jsx)(n.p,{children:"Data is stored in JuiceFS, examples are as follows:"}),"\n",(0,r.jsxs)(n.p,{children:["(Need to put ",(0,r.jsx)(n.code,{children:"juicefs-hadoop-x.x.x.jar"})," under ",(0,r.jsx)(n.code,{children:"fe/lib/"})," and ",(0,r.jsx)(n.code,{children:"apache_hdfs_broker/lib/"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hadoop.username' = 'root',\n    'fs.jfs.impl' = 'io.juicefs.JuiceFileSystem',\n    'fs.AbstractFileSystem.jfs.impl' = 'io.juicefs.JuiceFS',\n    'juicefs.meta' = 'xxx'\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"doris-query-dlc",children:"Doris query DLC"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Supported since Doris version 2.0.13 / 2.1.5"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://cloud.tencent.com/product/dlc",children:"DLC"})," of Tencent Cloud use HMS to manage its metadata, so Hive catalog can be used.\nDLC stores data on LakeFS or COSN, below catalog is compatible with both file system."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG dlc PROPERTIES (\n    'type' = 'hms',\n    'hive.metastore.uris' = 'thrift://<dlc_metastore_ip>:<dlc_metastore_port>',\n    's3.access_key' = 'xxxxx',\n    's3.secret_key' = 'xxxxx',\n    's3.region' = 'ap-xxx',\n    's3.endpoint' = 'cos.ap-xxx.myqcloud.com',\n    'fs.cosn.bucket.region' = 'ap-xxx',\n    'fs.ofs.user.appid' = '<your_tencent_cloud_appid>',\n    'fs.ofs.tmp.cache.dir' = '<tmp_cache_dir>'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["After create catalog, you need to ",(0,r.jsx)(n.a,{href:"https://cloud.tencent.com/document/product/436/38648",children:"grant"})," essential privilege to the appid your dlc catalog is using."]}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-s3",children:"Hive On S3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.access_key" = "ak",\n    "s3.secret_key" = "sk",\n    "use_path_style" = "true"\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:"Options:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"s3.connection.maximum: s3 maximum connection number, default 50"}),"\n",(0,r.jsx)(n.li,{children:"s3.connection.request.timeout: s3 request timeout, default 3000ms"}),"\n",(0,r.jsx)(n.li,{children:"s3.connection.timeout: s3 connection timeout, default 1000ms"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-oss",children:"Hive On OSS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "oss.endpoint" = "oss.oss-cn-beijing.aliyuncs.com",\n    "oss.access_key" = "ak",\n    "oss.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-oss-hdfs",children:"Hive On OSS-HDFS"}),"\n",(0,r.jsxs)(n.p,{children:["You need to download ",(0,r.jsx)(n.a,{href:"https://github.com/aliyun/alibabacloud-jindodata/blob/master/docs/user/6.x/6.7.8/jindodata_download.md",children:"Jindo SDK"})," and put them in ",(0,r.jsx)(n.code,{children:"${DORIS_HOME}/fe/lib"})," and ",(0,r.jsx)(n.code,{children:"${DORIS_HOME}/be/lib/java_extensions/preload-extensions"}),", then restart FE and BE."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "oss.endpoint" = "cn-beijing.oss-dls.aliyuncs.com",\n    "oss.access_key" = "ak",\n    "oss.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.p,{children:"Notice that the endpoint of OSS-HDFS is different from OSS endpoint."}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-obs",children:"Hive On OBS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "obs.endpoint" = "obs.cn-north-4.myhuaweicloud.com",\n    "obs.access_key" = "ak",\n    "obs.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"hive-on-cos",children:"Hive On COS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.uris" = "thrift://172.0.0.1:9083",\n    "cos.endpoint" = "cos.ap-beijing.myqcloud.com",\n    "cos.access_key" = "ak",\n    "cos.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"hive-with-glue",children:"Hive With Glue"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["When connecting Glue, if it's not on the EC2 environment, need copy the ",(0,r.jsx)(n.code,{children:"~/.aws"})," from the EC2 environment to the current environment. And can also download and configure the ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"AWS Cli tools"}),", which also creates the ",(0,r.jsx)(n.code,{children:".aws"})," directory under the current user directory."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG hive PROPERTIES (\n    "type"="hms",\n    "hive.metastore.type" = "glue",\n    "glue.endpoint" = "https://glue.us-east-1.amazonaws.com",\n    "glue.access_key" = "ak",\n    "glue.secret_key" = "sk"\n);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"metadata-cache--refresh",children:"Metadata Cache & Refresh"}),"\n",(0,r.jsxs)(n.p,{children:["For metadata cache and refresh mechanisms, please refer to ",(0,r.jsx)(n.a,{href:"/docs/lakehouse/metacache",children:"Metadata Cache Documentation"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Here we mainly introduce automatic metadata subscription based on Hive Metastore metadata events."}),"\n",(0,r.jsx)(n.h3,{id:"subscribe-to-hive-metastore",children:"Subscribe to Hive Metastore"}),"\n",(0,r.jsx)(n.p,{children:"By letting FE nodes read HMS Notification Events regularly to perceive changes in Hive table metadata, we currently support processing the following Events:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Event"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Corresponding Update Operation"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"CREATE DATABASE"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Create a database in the corresponding catalog."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"DROP DATABASE"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Delete a database in the corresponding catalog."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"ALTER DATABASE"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Such alterations mainly include changes in properties, comments, or storage location of databases. They do not affect Doris' queries in External Catalogs so they will not be synchronized."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"CREATE TABLE"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Create a table in the corresponding database."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"DROP TABLE"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Delete a table in the corresponding database, and invalidate the cache of that table."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"ALTER TABLE"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"If it is a renaming, delete the table of the old name, and then create a new table with the new name; otherwise, invalidate the cache of that table."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"ADD PARTITION"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Add a partition to the cached partition list of the corresponding table."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"DROP PARTITION"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Delete a partition from the cached partition list of the corresponding table, and invalidate the cache of that partition."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"ALTER PARTITION"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"If it is a renaming, delete the partition of the old name, and then create a new partition with the new name; otherwise, invalidate the cache of that partition."})]})]})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["After data ingestion, changes in partition tables will follow the ",(0,r.jsx)(n.code,{children:"ALTER PARTITION"})," logic, while those in non-partition tables will follow the ",(0,r.jsx)(n.code,{children:"ALTER TABLE"})," logic."]}),"\n",(0,r.jsx)(n.p,{children:"If changes are conducted on the file system directly instead of through the HMS, the HMS will not generate an event. As a result, such changes will not be perceived by Doris."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The automatic update feature involves the following parameters in fe.conf:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"enable_hms_events_incremental_sync"}),": This specifies whether to enable automatic incremental synchronization for metadata, which is disabled by default."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hms_events_polling_interval_ms"}),": This specifies the interval between two readings, which is set to 10000 by default. (Unit: millisecond)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"hms_events_batch_size_per_rpc"}),": This specifies the maximum number of events that are read at a time, which is set to 500 by default."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To enable automatic update(Excluding Huawei MRS), you need to modify the hive-site.xml of HMS and then restart HMS and HiveServer2:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<property>\n    <name>hive.metastore.event.db.notification.api.auth</name>\n    <value>false</value>\n</property>\n<property>\n    <name>hive.metastore.dml.events</name>\n    <value>true</value>\n</property>\n<property>\n    <name>hive.metastore.transactional.event.listeners</name>\n    <value>org.apache.hive.hcatalog.listener.DbNotificationListener</value>\n</property>\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Huawei's MRS needs to change hivemetastore-site.xml and restart HMS and HiveServer2:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<property>\n    <name>metastore.transactional.event.listeners</name>\n    <value>org.apache.hive.hcatalog.listener.DbNotificationListener</value>\n</property>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Note: Value is appended with commas separated from the original value, not overwritten.For example, the default configuration for MRS 3.1.0 is"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<property>\n    <name>metastore.transactional.event.listeners</name>\n    <value>com.huawei.bigdata.hive.listener.TableKeyFileManagerListener,org.apache.hadoop.hive.metastore.listener.FileAclListener</value>\n</property>\n"})}),"\n",(0,r.jsx)(n.p,{children:"We need to change to"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<property>\n    <name>metastore.transactional.event.listeners</name>\n    <value>com.huawei.bigdata.hive.listener.TableKeyFileManagerListener,org.apache.hadoop.hive.metastore.listener.FileAclListener,org.apache.hive.hcatalog.listener.DbNotificationListener</value>\n</property>\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Note: To enable automatic update, whether for existing Catalogs or newly created Catalogs, all you need is to set ",(0,r.jsx)(n.code,{children:"enable_hms_events_incremental_sync"})," to ",(0,r.jsx)(n.code,{children:"true"}),", and then restart the FE node. You don't need to manually update the metadata before or after the restart."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"hive-version",children:"Hive Version"}),"\n",(0,r.jsx)(n.p,{children:"Doris can correctly access the Hive Metastore in different Hive versions. By default, Doris will access the Hive Metastore with a Hive 2.3 compatible interface."}),"\n",(0,r.jsxs)(n.p,{children:["If you meet error message like ",(0,r.jsx)(n.code,{children:"Invalid method name: 'get_table_req'"}),", which means the hive version is mismatch."]}),"\n",(0,r.jsx)(n.p,{children:"You can specify the hive version when creating the Catalog. If accessing Hive 1.1.0 version:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG hive PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hive.version' = '1.1.0'\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"column-type-mapping",children:"Column type mapping"}),"\n",(0,r.jsx)(n.p,{children:"For Hive/Iceberge/Hudi"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"HMS Type"}),(0,r.jsx)(n.th,{children:"Doris Type"}),(0,r.jsx)(n.th,{children:"Comment"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"tinyint"}),(0,r.jsx)(n.td,{children:"tinyint"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"smallint"}),(0,r.jsx)(n.td,{children:"smallint"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"int"}),(0,r.jsx)(n.td,{children:"int"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"bigint"}),(0,r.jsx)(n.td,{children:"bigint"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"date"}),(0,r.jsx)(n.td,{children:"date"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"timestamp"}),(0,r.jsx)(n.td,{children:"datetime"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{children:"float"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"double"}),(0,r.jsx)(n.td,{children:"double"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"char"}),(0,r.jsx)(n.td,{children:"char"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"varchar"}),(0,r.jsx)(n.td,{children:"varchar"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"decimal"}),(0,r.jsx)(n.td,{children:"decimal"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"array<type>"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"array<type>"})}),(0,r.jsxs)(n.td,{children:["support nested type, for example ",(0,r.jsx)(n.code,{children:"array<array<int>>"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"map<KeyType, ValueType>"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"map<KeyType, ValueType>"})}),(0,r.jsxs)(n.td,{children:["support nested type, for example ",(0,r.jsx)(n.code,{children:"map<string, array<int>>"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"struct<col1: Type1, col2: Type2, ...>"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"struct<col1: Type1, col2: Type2, ...>"})}),(0,r.jsxs)(n.td,{children:["support nested type, for example ",(0,r.jsx)(n.code,{children:"struct<col1: array<int>, col2: map<int, date>>"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"other"}),(0,r.jsx)(n.td,{children:"unsupported"}),(0,r.jsx)(n.td,{})]})]})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Note: Whether to truncate char or varchar columns according to the schema of the hive table"}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["If the session variable ",(0,r.jsx)(n.code,{children:"truncate_char_or_varchar_columns"})," is enabled, when the maximum length of the char or varchar column in the schema of the hive table is inconsistent with the schema in the underlying parquet or orc file, it will be truncated according to the maximum length of the hive table column."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"The variable default is false."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"query-hive-partitions",children:"Query Hive partitions"}),"\n",(0,r.jsx)(n.p,{children:"You can query Hive partition information in the following two ways."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"SHOW PARTITIONS FROM hive_table"})}),"\n",(0,r.jsx)(n.p,{children:"This statement can list all partitions and partition value information of the specified Hive table."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"table$partitions"})," metadata table"]}),"\n",(0,r.jsxs)(n.p,{children:["Since versions 2.1.7 and 3.0.3, users can query Hive partition information through the ",(0,r.jsx)(n.code,{children:"table$partitions"})," metadata table. ",(0,r.jsx)(n.code,{children:"table$partitions"})," is essentially a relational table, so it can be used in any SELECT statement."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"SELECT * FROM hive_table$partitions;\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"access-hms-with-broker",children:"Access HMS with broker"}),"\n",(0,r.jsxs)(n.p,{children:["Add following setting when creating an HMS catalog, file splitting and scanning for Hive external table will be completed by broker named ",(0,r.jsx)(n.code,{children:"test_broker"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'"broker.name" = "test_broker"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Doris has implemented Broker query support for HMS Catalog Iceberg based on the Iceberg ",(0,r.jsx)(n.code,{children:"FileIO"})," interface. If needed, the following configuration can be added when creating the HMS Catalog."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'"io-impl" = "org.apache.doris.datasource.iceberg.broker.IcebergBrokerIO"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"integrate-with-apache-ranger",children:"Integrate with Apache Ranger"}),"\n",(0,r.jsx)(n.p,{children:"Apache Ranger is a security framework for monitoring, enabling services, and comprehensive data security access management on the Hadoop platform."}),"\n",(0,r.jsx)(n.p,{children:"Doris supports using Apache Ranger for authentication for a specified External Hive Catalog."}),"\n",(0,r.jsx)(n.p,{children:"Currently, authentication of database, table, and column is supported. Functions such as encryption, row policy, and data masks are not currently supported."}),"\n",(0,r.jsxs)(n.p,{children:["To use Apache Ranger to authenticate the entire Doris cluster service, please refer to ",(0,r.jsx)(n.a,{href:"/docs/admin-manual/auth/ranger",children:"Apache Ranger"})]}),"\n",(0,r.jsx)(n.h3,{id:"settings",children:"Settings"}),"\n",(0,r.jsx)(n.p,{children:"To connect to the Hive Metastore with Ranger permission verification enabled, you need to add configuration & configuration environment:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"When creating a Catalog, add:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'"access_controller.properties.ranger.service.name" = "hive",\n"access_controller.class" = "org.apache.doris.catalog.authorizer.ranger.hive.RangerHiveAccessControllerFactory",\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Note:"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"access_controller.properties.ranger.service.name"})," refers to the type of service, such as ",(0,r.jsx)(n.code,{children:"hive"}),", ",(0,r.jsx)(n.code,{children:"hdfs"}),", etc. It is not the value of ",(0,r.jsx)(n.code,{children:"ranger.plugin.hive.service.name"})," in the configuration file."]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure all FE environments:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Copy the configuration files ranger-hive-audit.xml, ranger-hive-security.xml, and ranger-policymgr-ssl.xml under the HMS conf directory to the FE conf directory."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Modify the properties of ranger-hive-security.xml, the reference configuration is as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'<?xml version="1.0" encoding="UTF-8"?>\n<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>\n<configuration>\n    #The directory for caching permission data, needs to be writable\n    <property>\n        <name>ranger.plugin.hive.policy.cache.dir</name>\n        <value>/mnt/datadisk0/zhangdong/rangerdata</value>\n    </property>\n    #The time interval for periodically pulling permission data\n    <property>\n        <name>ranger.plugin.hive.policy.pollIntervalMs</name>\n        <value>30000</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.rest.client.connection.timeoutMs</name>\n        <value>60000</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.rest.client.read.timeoutMs</name>\n        <value>60000</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.rest.ssl.config.file</name>\n        <value></value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.rest.url</name>\n        <value>http://172.21.0.32:6080</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.policy.source.impl</name>\n        <value>org.apache.ranger.admin.client.RangerAdminRESTClient</value>\n    </property>\n\n    <property>\n        <name>ranger.plugin.hive.service.name</name>\n        <value>hive</value>\n    </property>\n\n    <property>\n        <name>xasecure.hive.update.xapolicies.on.grant.revoke</name>\n        <value>true</value>\n    </property>\n\n</configuration>\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["In order to obtain the log of Ranger authentication itself, add the configuration file log4j.properties in the ",(0,r.jsx)(n.code,{children:"<doris_home>/conf"})," directory."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Restart FE."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create user user1 on the ranger side and authorize the query permission of db1.table1.col1"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create role role1 on the ranger side and authorize the query permission of db1.table1.col2"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create a user user1 with the same name in doris, user1 will directly have the query authority of db1.table1.col1"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create role1 with the same name in doris, and assign role1 to user1, user1 will have the query authority of db1.table1.col1 and col2 at the same time"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The permissions of Admin and Root users are not controlled by Apache Ranger."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"connect-to-kerberos-enabled-hive",children:"Connect to Kerberos enabled Hive"}),"\n",(0,r.jsx)(n.p,{children:"This section mainly introduces how to connect to a Hive + HDFS cluster with Kerberos authentication enabled."}),"\n",(0,r.jsx)(n.h3,{id:"environment-preparation",children:"Environment preparation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"krb5.conf"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"krb5.conf"})," is the configuration file for the Kerberos authentication protocol. This file needs to be deployed on all FE and BE nodes. And ensure that the Doris cluster can connect to the KDC service recorded in this file."]}),"\n",(0,r.jsxs)(n.p,{children:["By default, this file is located in the ",(0,r.jsx)(n.code,{children:"/etc"})," directory of the Hadoop cluster. But please contact the Hadoop cluster administrator to obtain the correct ",(0,r.jsx)(n.code,{children:"krb5.conf"})," file and deploy it to the ",(0,r.jsx)(n.code,{children:"/etc"})," directory of all FE and BE nodes."]}),"\n",(0,r.jsxs)(n.p,{children:["Note that in some cases the file location of ",(0,r.jsx)(n.code,{children:"krb5.conf"})," may depend on the environment variable ",(0,r.jsx)(n.code,{children:"KRB5_CONFIG"})," or the ",(0,r.jsx)(n.code,{children:"-Djava.security.krb5.conf"})," in the JVM parameters. Please check these properties to determine the exact location of ",(0,r.jsx)(n.code,{children:"krb5.conf"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["To customize the location of ",(0,r.jsx)(n.code,{children:"krb5.conf"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["FE: Configure the JVM parameter ",(0,r.jsx)(n.code,{children:"-Djava.security.krb5.conf"})," in ",(0,r.jsx)(n.code,{children:"fe.conf"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["BE: Use the ",(0,r.jsx)(n.code,{children:"kerberos_krb5_conf_path"})," configuration item in ",(0,r.jsx)(n.code,{children:"be.conf"}),", the default value is ",(0,r.jsx)(n.code,{children:"/etc/krb5.conf"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JVM parameters"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Please add the following options to the JVM of FE and BE (located in ",(0,r.jsx)(n.code,{children:"fe.conf"})," and ",(0,r.jsx)(n.code,{children:"be.conf"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"* `-Djavax.security.auth.useSubjectCredsOnly=false`\n* `-Dsun.security.krb5.debug=true`\n"})}),"\n",(0,r.jsx)(n.p,{children:"And restart the FE and BE nodes to ensure it takes effect."}),"\n",(0,r.jsx)(n.h3,{id:"catalog-configuration",children:"Catalog configuration"}),"\n",(0,r.jsx)(n.p,{children:"Normally, to connect to a Kerberos enabled Hive cluster, you need to add the following attributes to the Catalog:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"hadoop.security.authentication" = "kerberos"'}),": Enable kerberos authentication method."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"hadoop.kerberos.principal" = "your_principal"'}),": The principal of the HDFS namenode. Typically the ",(0,r.jsx)(n.code,{children:"dfs.namenode.kerberos.principal"})," configuration of ",(0,r.jsx)(n.code,{children:"hdfs-site.xml"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"hadoop.kerberos.keytab" = "/path/to/your_keytab"'}),": keytab file of HDFS namenode. Typically the ",(0,r.jsx)(n.code,{children:"dfs.namenode.keytab.file"})," configuration of ",(0,r.jsx)(n.code,{children:"hdfs-site.xml"}),". Note that this file needs to be deployed to the same directory of all FE and BE nodes (can be customized)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"yarn.resourcemanager.principal" = "your_principal"'}),": The principal of Yarn Resource Manager, which can be found in ",(0,r.jsx)(n.code,{children:"yarn-site.xml"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"hive.metastore.kerberos.principal" = "your_principal"'}),": The principal of the Hive metastore. Can be found in ",(0,r.jsx)(n.code,{children:"hive-site.xml"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Note: Suggest to use ",(0,r.jsx)(n.code,{children:"kinit -kt your_principal /path/to/your_keytab"})," \u4EE5\u53CA ",(0,r.jsx)(n.code,{children:"klist -k /path/to/your_keytab"})," to get the ticket or check its validation."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Examples are as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG hive_krb PROPERTIES (\n     'type'='hms',\n     'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n     'hive.metastore.sasl.enabled' = 'true',\n     'hive.metastore.kerberos.principal' = 'your-hms-principal',\n     'hadoop.security.authentication' = 'kerberos',\n     'hadoop.kerberos.keytab' = '/your-keytab-filepath/your.keytab',\n     'hadoop.kerberos.principal' = 'your-principal@YOUR.COM',\n     'yarn.resourcemanager.principal' = 'your-rm-principal'\n);\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG hive_krb_ha PROPERTIES (\n     'type'='hms',\n     'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n     'hive.metastore.sasl.enabled' = 'true',\n     'hive.metastore.kerberos.principal' = 'your-hms-principal',\n     'hadoop.security.authentication' = 'kerberos',\n     'hadoop.kerberos.keytab' = '/your-keytab-filepath/your.keytab',\n     'hadoop.kerberos.principal' = 'your-principal@YOUR.COM',\n     'yarn.resourcemanager.principal' = 'your-rm-principal',\n     'dfs.nameservices'='your-nameservice',\n     'dfs.ha.namenodes.your-nameservice'='nn1,nn2',\n     'dfs.namenode.rpc-address.your-nameservice.nn1'='172.21.0.2:8088',\n     'dfs.namenode.rpc-address.your-nameservice.nn2'='172.21.0.3:8088',\n     'dfs.client.failover.proxy.provider.your-nameservice'='org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"multi-kerberos-cluster-configuration",children:"Multi-Kerberos Cluster Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["To access multiple Kerberos-enabled Hadoop clusters simultaneously, you need to modify the ",(0,r.jsx)(n.code,{children:"krb5.conf"})," file and configure the ",(0,r.jsx)(n.code,{children:"hadoop.security.auth_to_local"})," property. The detailed steps are as follows:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure Realms in the krb5.conf File"}),"\n",(0,r.jsxs)(n.p,{children:["When configuring multiple clusters, you need to include multiple realms in a single ",(0,r.jsx)(n.code,{children:"krb5.conf"})," file. The KDC and admin_server can also be domain names."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-properties",children:"[realms]\nREALM1.COM = {\n  kdc = 172.21.16.8:88\n  admin_server = 172.21.16.8\n}\nREALM2.COM = {\n  kdc = kdc_hostname:88\n  admin_server = kdc_hostname\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure domain_realm in the krb5.conf File"}),"\n",(0,r.jsx)(n.p,{children:"To locate the KDC, use the domain_name in the principal to find the corresponding realm."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-properties",children:"[libdefaults]\n  dns_lookup_realm = true\n  dns_lookup_kdc = true\n[domain_realm]\n  .your-host.example = REALM1.COM\n  your-host.example = REALM1.COM\n  .your-other-host.example = REALM2.COM\n  your-other-host.example = REALM2.COM\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If not configured correctly, you may see domain_realm-related errors in the ",(0,r.jsx)(n.code,{children:"log/be.out"})," or ",(0,r.jsx)(n.code,{children:"log/fe.out"})," of Doris, such as:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Unable to locate KDC for realm / Cannot locate KDC"}),"\n",(0,r.jsx)(n.li,{children:"No service creds"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure Domain-to-Realm Mapping"}),"\n",(0,r.jsxs)(n.p,{children:["To match principals used by different Kerberos services in a multi-cluster environment, it's recommended to add or modify the following configuration in ",(0,r.jsx)(n.code,{children:"core-site.xml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<property>\n    <name>hadoop.security.auth_to_local</name>\n    <value>RULE:[1:$1@$0](^.*@.*$)s/^(.*)@.*$/$1/g\n           RULE:[2:$1@$0](^.*@.*$)s/^(.*)@.*$/$1/g\n           DEFAULT</value>\n</property>\n"})}),"\n",(0,r.jsx)(n.p,{children:"If it needs to take effect individually in the Catalog, it can be directly configured in the properties:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG hive_krb PROPERTIES (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.0.0.1:9083',\n    'hive.metastore.sasl.enabled' = 'true',\n    'hive.metastore.kerberos.principal' = 'your-other-hms-principal',\n    'hadoop.security.authentication' = 'kerberos',\n    'hadoop.kerberos.keytab' = '/your-other-keytab-filepath/your-other.keytab',   \n    'hadoop.kerberos.principal' = 'your-other-principal@YOUR.COM',\n    'yarn.resourcemanager.principal' = 'your-other-rm-principal',\n    'hadoop.security.auth_to_local' = 'RULE:[1:$1@$0](^.*@.*$)s/^(.*)@.*$/$1/g\n                                   RULE:[2:$1@$0](^.*@.*$)s/^(.*)@.*$/$1/g\n                                   DEFAULT'\n);\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Restart Doris Service"}),"\n",(0,r.jsxs)(n.p,{children:["To verify whether the mapping rules match correctly, check if there are any errors such as ",(0,r.jsx)(n.code,{children:"NoMatchingRule: No rules applied to user/domain_name@REALM.COM"})," when accessing different clusters."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(n.p,{children:["In case of Kerberos authentication problems, after setting the JVM parameter ",(0,r.jsx)(n.code,{children:"-Dsun.security.krb5.debug=true"}),", Kerberos authentication related information will be printed in ",(0,r.jsx)(n.code,{children:"fe.out"})," or ",(0,r.jsx)(n.code,{children:"be.out"}),". You can refer to the related errors in ",(0,r.jsx)(n.a,{href:"../../faq/lakehouse-faq",children:"FAQ"})," for troubleshooting."]}),"\n",(0,r.jsx)(n.h2,{id:"hive-transactional-tables",children:"Hive Transactional Tables"}),"\n",(0,r.jsxs)(n.p,{children:["Hive transactional tables are tables in Hive that support ACID (Atomicity, Consistency, Isolation, Durability) semantics. For more details, you can refer to: ",(0,r.jsx)(n.a,{href:"https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions",children:"Hive Transactions"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"supported-operations-for-hive-transactional-tables",children:"Supported Operations for Hive Transactional Tables"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Transactional Table Type"}),(0,r.jsx)(n.th,{children:"Supported Operations in Hive"}),(0,r.jsx)(n.th,{children:"Hive Table Properties"}),(0,r.jsx)(n.th,{children:"Supported Hive Versions"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Full-ACID Transactional Table"}),(0,r.jsx)(n.td,{children:"Supports insert, update, delete operations"}),(0,r.jsx)(n.td,{children:"'transactional'='true', 'transactional_properties'='insert_only'"}),(0,r.jsx)(n.td,{children:"3.x, 2.x (requires major compaction in Hive before loading)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Insert-Only Transactional Table"}),(0,r.jsx)(n.td,{children:"Supports only Insert operations"}),(0,r.jsx)(n.td,{children:"'transactional'='true'"}),(0,r.jsx)(n.td,{children:"3.x, 2.x"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"current-limitations",children:"Current Limitations"}),"\n",(0,r.jsx)(n.p,{children:"Currently, it does not support scenarios involving Original Files.\nWhen a table is transformed into a transactional table, subsequent newly written data files will use the schema of the Hive transactional table. However, existing data files will not be converted to the schema of the transactional table. These existing files are referred to as Original Files."}),"\n",(0,r.jsx)(n.h2,{id:"best-practices-1",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Handling of Empty Lines in Hive Text Format Tables"}),"\n",(0,r.jsxs)(n.p,{children:["By default, Doris ignores empty lines in Text format tables. Starting from version 2.1.5, you can control this behavior by setting the session variable ",(0,r.jsx)(n.code,{children:"read_csv_empty_line_as_null"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"set read_csv_empty_line_as_null = true;"})}),"\n",(0,r.jsx)(n.p,{children:'The variable defaults to false, indicating that empty lines are ignored. If set to true, the empty line will be read as a line with "all columns are null" and returned, which is consistent with the behavior of some query engines in the Hadoop ecosystem.'}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return a}});var t=i(667294);let r={},s=t.createContext(r);function a(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);