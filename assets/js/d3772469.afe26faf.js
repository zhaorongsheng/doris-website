"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["590098"],{887714:function(e,t,n){n.r(t),n.d(t,{default:()=>d,frontMatter:()=>l,metadata:()=>r,assets:()=>a,toc:()=>c,contentTitle:()=>i});var r=JSON.parse('{"id":"data-operate/export/outfile","title":"Exporting Query Result","description":"\x3c!--","source":"@site/versioned_docs/version-2.0/data-operate/export/outfile.md","sourceDirName":"data-operate/export","slug":"/data-operate/export/outfile","permalink":"/docs/2.0/data-operate/export/outfile","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Exporting Query Result","language":"en"},"sidebar":"docs","previous":{"title":"Exporting Overview","permalink":"/docs/2.0/data-operate/export/export-manual"},"next":{"title":"Using MySQL Dump","permalink":"/docs/2.0/data-operate/export/export-with-mysql-dump"}}'),s=n("785893"),o=n("250065");let l={title:"Exporting Query Result",language:"en"},i=void 0,a={},c=[{value:"Examples",id:"examples",level:2},{value:"Export to HDFS",id:"export-to-hdfs",level:3},{value:"Export to Local Files",id:"export-to-local-files",level:3},{value:"Concurrent Export",id:"concurrent-export",level:2},{value:"How to Verify that the Result Set is Exported Concurrently",id:"how-to-verify-that-the-result-set-is-exported-concurrently",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Return Results",id:"return-results",level:2},{value:"Notice",id:"notice",level:2},{value:"More Help",id:"more-help",level:2}];function h(e){let t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["This document describes how to use the  ",(0,s.jsx)(t.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/OUTFILE",children:"SELECT INTO OUTFILE"}),"  command to export query results."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"SELECT INTO OUTFILE"})," is a synchronous command, which means that the operation is completed when the command returns. It also returns a row of results to show the execution result of the export."]}),"\n",(0,s.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(t.h3,{id:"export-to-hdfs",children:"Export to HDFS"}),"\n",(0,s.jsxs)(t.p,{children:["Export simple query results to the file ",(0,s.jsx)(t.code,{children:"hdfs://path/to/result.txt"}),", specifying the export format as CSV."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:'SELECT * FROM tbl\nINTO OUTFILE "hdfs://path/to/result_"\nFORMAT AS CSV\nPROPERTIES\n(\n    "broker.name" = "my_broker",\n    "column_separator" = ",",\n    "line_delimiter" = "\\n"\n);\n'})}),"\n",(0,s.jsx)(t.h3,{id:"export-to-local-files",children:"Export to Local Files"}),"\n",(0,s.jsxs)(t.p,{children:["When exporting to a local file, you need to configure ",(0,s.jsx)(t.code,{children:"enable_outfile_to_local=true"})," in fe.conf first"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:'select * from tbl1 limit 10 \nINTO OUTFILE "file:///home/work/path/result_";\n'})}),"\n",(0,s.jsxs)(t.p,{children:["For more usage, see ",(0,s.jsx)(t.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/OUTFILE",children:"OUTFILE documentation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"concurrent-export",children:"Concurrent Export"}),"\n",(0,s.jsx)(t.p,{children:"By default, the export of the query result set is non-concurrent, that is, a single point of export. If the user wants the query result set to be exported concurrently, the following conditions need to be met:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["session variable 'enable_parallel_outfile' to enable concurrent export: ",(0,s.jsx)(t.code,{children:"set enable_parallel_outfile = true;"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"The export method is S3, HDFS instead of using a broker"}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"The query can meet the needs of concurrent export, for example, the top level does not contain single point nodes such as sort. (I will give an example later, which is a query that does not export the result set concurrently)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["If the above three conditions are met, the concurrent export query result set can be triggered. Concurrency = ",(0,s.jsx)(t.code,{children:"be_instacne_num * parallel_fragment_exec_instance_num"})]}),"\n",(0,s.jsx)(t.h3,{id:"how-to-verify-that-the-result-set-is-exported-concurrently",children:"How to Verify that the Result Set is Exported Concurrently"}),"\n",(0,s.jsx)(t.p,{children:"After the user enables concurrent export through the session variable setting, if you want to verify whether the current query can be exported concurrently, you can use the following method."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'explain select xxx from xxx where xxx into outfile "s3://xxx" format as csv properties ("AWS_ENDPOINT" = "xxx", ...);\n'})}),"\n",(0,s.jsxs)(t.p,{children:["After explaining the query, Doris will return the plan of the query. If you find that ",(0,s.jsx)(t.code,{children:"RESULT FILE SINK"})," appears in ",(0,s.jsx)(t.code,{children:"PLAN FRAGMENT 1"}),", it means that the export concurrency has been opened successfully.\nIf ",(0,s.jsx)(t.code,{children:"RESULT FILE SINK"})," appears in ",(0,s.jsx)(t.code,{children:"PLAN FRAGMENT 0"}),", it means that the current query cannot be exported concurrently (the current query does not satisfy the three conditions of concurrent export at the same time)."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"Planning example for concurrent export:\n+-----------------------------------------------------------------------------+\n| Explain String                                                              |\n+-----------------------------------------------------------------------------+\n| PLAN FRAGMENT 0                                                             |\n|  OUTPUT EXPRS:<slot 2> | <slot 3> | <slot 4> | <slot 5>                     |\n|   PARTITION: UNPARTITIONED                                                  |\n|                                                                             |\n|   RESULT SINK                                                               |\n|                                                                             |\n|   1:EXCHANGE                                                                |\n|                                                                             |\n| PLAN FRAGMENT 1                                                             |\n|  OUTPUT EXPRS:`k1` + `k2`                                                   |\n|   PARTITION: HASH_PARTITIONED: `default_cluster:test`.`multi_tablet`.`k1`   |\n|                                                                             |\n|   RESULT FILE SINK                                                          |\n|   FILE PATH: s3://ml-bd-repo/bpit_test/outfile_1951_                        |\n|   STORAGE TYPE: S3                                                          |\n|                                                                             |\n|   0:OlapScanNode                                                            |\n|      TABLE: multi_tablet                                                    |\n+-----------------------------------------------------------------------------+\n"})}),"\n",(0,s.jsx)(t.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,s.jsxs)(t.p,{children:["For details, please refer to ",(0,s.jsx)(t.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/OUTFILE",children:"OUTFILE Document"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"return-results",children:"Return Results"}),"\n",(0,s.jsx)(t.p,{children:"The command is a synchronization command. The command returns, which means the operation is over.\nAt the same time, a row of results will be returned to show the exported execution result."}),"\n",(0,s.jsx)(t.p,{children:"If it exports and returns normally, the result is as follows:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'mysql> select * from tbl1 limit 10 into outfile "file:///home/work/path/result_";\n+------------+-----------+----------+--------------------------------------------------------------------+\n| FileNumber | TotalRows | FileSize | URL                                                                |\n+------------+-----------+----------+--------------------------------------------------------------------+\n|          1 |         2 |        8 | file:///192.168.1.10/home/work/path/result_{fragment_instance_id}_ |\n+------------+-----------+----------+--------------------------------------------------------------------+\n1 row in set (0.05 sec)\n'})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"FileNumber: The number of files finally generated."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"TotalRows: The number of rows in the result set."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"FileSize: The total size of the exported file. Unit byte."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"URL: If it is exported to a local disk, the Compute Node to which it is exported is displayed here."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"If a concurrent export is performed, multiple rows of data will be returned."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"+------------+-----------+----------+--------------------------------------------------------------------+\n| FileNumber | TotalRows | FileSize | URL                                                                |\n+------------+-----------+----------+--------------------------------------------------------------------+\n|          1 |         3 |        7 | file:///192.168.1.10/home/work/path/result_{fragment_instance_id}_ |\n|          1 |         2 |        4 | file:///192.168.1.11/home/work/path/result_{fragment_instance_id}_ |\n+------------+-----------+----------+--------------------------------------------------------------------+\n2 rows in set (2.218 sec)\n"})}),"\n",(0,s.jsx)(t.p,{children:"If the execution is incorrect, an error message will be returned, such as:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"mysql> SELECT * FROM tbl INTO OUTFILE ...\nERROR 1064 (HY000): errCode = 2, detailMessage = Open broker writer failed ...\n"})}),"\n",(0,s.jsx)(t.h2,{id:"notice",children:"Notice"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"The current version of the Nereids optimizer does not support concurrent Outfile. If the Nereids optimizer is enabled, concurrent Outfile will directly revert to the old optimizer, which will handle the concurrent Outfile export. Similarly, the current version of the pipeline engine also does not support concurrent Outfile. If the pipeline engine is enabled, concurrent Outfile will revert to single-threaded export."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["The CSV format does not support exporting binary types, such as BITMAP and HLL types. These types will be output as ",(0,s.jsx)(t.code,{children:"\\N"}),", which is null."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"If you do not enable concurrent export, the query result is exported by a single BE node in a single thread. Therefore, the export time and the export result set size are positively correlated. Turning on concurrent export can reduce the export time."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"The export command does not check whether the file and file path exist. Whether the path will be automatically created or whether the existing file will be overwritten is entirely determined by the semantics of the remote storage system."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"If an error occurs during the export process, the exported file may remain on the remote storage system. Doris will not clean these files. The user needs to manually clean up."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["The timeout of the export command is the same as the timeout of the query. It can be set by ",(0,s.jsx)(t.code,{children:"SET query_timeout = xxx"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"For empty result query, there will be an empty file."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["File spliting will ensure that a row of data is stored in a single file. Therefore, the size of the file is not strictly equal to ",(0,s.jsx)(t.code,{children:"max_file_size"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["For functions whose output is invisible characters, such as BITMAP and HLL types, the output is ",(0,s.jsx)(t.code,{children:"\\N"}),", which is NULL."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["At present, the output type of some geo functions, such as ",(0,s.jsx)(t.code,{children:"ST_Point"})," is VARCHAR, but the actual output value is an encoded binary character. Currently these functions will output garbled characters. For geo functions, use ",(0,s.jsx)(t.code,{children:"ST_AsText"})," for output."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"more-help",children:"More Help"}),"\n",(0,s.jsxs)(t.p,{children:["For more detailed syntax and best practices for using OUTFILE, please refer to the ",(0,s.jsx)(t.a,{href:"../../sql-manual/sql-reference/Data-Manipulation-Statements/OUTFILE",children:"OUTFILE"})," command manual, you can also More help information can be obtained by typing ",(0,s.jsx)(t.code,{children:"HELP OUTFILE"})," at the command line of the MySql client."]})]})}function d(e={}){let{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return i},a:function(){return l}});var r=n(667294);let s={},o=r.createContext(s);function l(e){let t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);