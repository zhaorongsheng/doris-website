"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["560412"],{105160:function(e,n,t){t.r(n),t.d(n,{default:()=>h,frontMatter:()=>o,metadata:()=>s,assets:()=>c,toc:()=>l,contentTitle:()=>r});var s=JSON.parse('{"id":"lakehouse/database/jdbc","title":"JDBC Catalog","description":"\x3c!--","source":"@site/versioned_docs/version-2.1/lakehouse/database/jdbc.md","sourceDirName":"lakehouse/database","slug":"/lakehouse/database/jdbc","permalink":"/docs/lakehouse/database/jdbc","draft":false,"unlisted":false,"tags":[],"version":"2.1","frontMatter":{"title":"JDBC Catalog","language":"en"},"sidebar":"docs","previous":{"title":"Iceberg","permalink":"/docs/lakehouse/datalake-building/iceberg-build"},"next":{"title":"MySQL","permalink":"/docs/lakehouse/database/mysql"}}'),i=t("785893"),a=t("250065");let o={title:"JDBC Catalog",language:"en"},r=void 0,c={},l=[{value:"Supported databases",id:"supported-databases",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Basic properties",id:"basic-properties",level:3},{value:"Optional properties",id:"optional-properties",level:3},{value:"Connection pool properties",id:"connection-pool-properties",level:3},{value:"Property Notes",id:"property-notes",level:2},{value:"Driver package path and security",id:"driver-package-path-and-security",level:3},{value:"Lowercase name synchronization",id:"lowercase-name-synchronization",level:3},{value:"Specify synchronization database",id:"specify-synchronization-database",level:3},{value:"Connection pool configuration",id:"connection-pool-configuration",level:3},{value:"Insert transaction",id:"insert-transaction",level:3},{value:"Example",id:"example",level:2},{value:"Statement transparent transmission",id:"statement-transparent-transmission",level:2},{value:"Transparent transmission of DDL and DML",id:"transparent-transmission-of-ddl-and-dml",level:3},{value:"Transparent query",id:"transparent-query",level:3},{value:"Principles and Limitations",id:"principles-and-limitations",level:3},{value:"Troubleshooting connection pool issues",id:"troubleshooting-connection-pool-issues",level:2},{value:"Druid connection pool version",id:"druid-connection-pool-version",level:3},{value:"HikariCP connection pool version",id:"hikaricp-connection-pool-version",level:3},{value:"Possible reasons:",id:"possible-reasons",level:4},{value:"Solution:",id:"solution",level:4}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Doris JDBC Catalog supports connecting to different databases that support the JDBC protocol through the standard JDBC interface. This document introduces the general configuration and usage of JDBC Catalog."}),"\n",(0,i.jsx)(n.h2,{id:"supported-databases",children:"Supported databases"}),"\n",(0,i.jsx)(n.p,{children:"Doris JDBC Catalog supports connecting to the following databases:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Database"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/docs/lakehouse/database/mysql",children:"MySQL"})}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/docs/lakehouse/database/postgresql",children:"PostgreSQL"})}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/docs/lakehouse/database/oracle",children:"Oracle"})}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/docs/lakehouse/database/sqlserver",children:"SQL Server"})}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/docs/lakehouse/database/ibm-db2",children:"IBM Db2"})}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/docs/lakehouse/database/clickhouse",children:"ClickHouse"})}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/docs/lakehouse/database/sap-hana",children:"SAP HANA"})}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/docs/lakehouse/database/oceanbase",children:"OceanBase"})}),(0,i.jsx)(n.td,{})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"basic-properties",children:"Basic properties"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameters"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"type"})}),(0,i.jsxs)(n.td,{children:["Fixed to ",(0,i.jsx)(n.code,{children:"jdbc"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"user"})}),(0,i.jsx)(n.td,{children:"Data source user name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"password"})}),(0,i.jsx)(n.td,{children:"Data source password"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"jdbc_url"})}),(0,i.jsx)(n.td,{children:"Data source connection URL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"driver_url"})}),(0,i.jsx)(n.td,{children:"Path to the data source JDBC driver"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"driver_class"})}),(0,i.jsx)(n.td,{children:"The class name of the data source JDBC driver"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"optional-properties",children:"Optional properties"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameters"}),(0,i.jsx)(n.th,{children:"Default value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lower_case_meta_names"})}),(0,i.jsx)(n.td,{children:'"false"'}),(0,i.jsx)(n.td,{children:"Whether to synchronize the library name, table name and column name of the external data source in lowercase"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"meta_names_mapping"})}),(0,i.jsx)(n.td,{children:'""'}),(0,i.jsxs)(n.td,{children:["When the external data source has the same name but different case, such as DORIS and doris, Doris reports an error when querying the Catalog due to ambiguity. In this case, the ",(0,i.jsx)(n.code,{children:"meta_names_mapping"})," parameter needs to be configured to resolve the conflict."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"only_specified_database"})}),(0,i.jsx)(n.td,{children:'"false"'}),(0,i.jsx)(n.td,{children:"Whether to synchronize only the Database of the data source specified in the JDBC URL (Database here is the Database level mapped to Doris)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"include_database_list"})}),(0,i.jsx)(n.td,{children:'""'}),(0,i.jsxs)(n.td,{children:["When ",(0,i.jsx)(n.code,{children:"only_specified_database=true"}),", specify to synchronize multiple Databases, separated by ','. Database names are case-sensitive."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"exclude_database_list"})}),(0,i.jsx)(n.td,{children:'""'}),(0,i.jsxs)(n.td,{children:["When ",(0,i.jsx)(n.code,{children:"only_specified_database=true"}),", specify multiple Databases that do not need to be synchronized, separated by ','. Database names are case-sensitive."]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"connection-pool-properties",children:"Connection pool properties"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Default value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"connection_pool_min_size"})}),(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"Defines the minimum number of connections in the connection pool, which is used to initialize the connection pool and ensure that at least this number of connections are active when the keep-alive mechanism is enabled."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"connection_pool_max_size"})}),(0,i.jsx)(n.td,{children:"30"}),(0,i.jsx)(n.td,{children:"Defines the maximum number of connections in the connection pool. Each FE or BE node corresponding to each Catalog can hold up to this number of connections."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"connection_pool_max_wait_time"})}),(0,i.jsx)(n.td,{children:"5000"}),(0,i.jsx)(n.td,{children:"Defines the maximum number of milliseconds the client will wait for a connection if there is no available connection in the connection pool."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"connection_pool_max_life_time"})}),(0,i.jsx)(n.td,{children:"1800000"}),(0,i.jsx)(n.td,{children:"Set the maximum time (in milliseconds) that a connection remains active in the connection pool. Timed out connections will be recycled. At the same time, half of this value will serve as the minimum eviction idle time of the connection pool, and connections that reach this time will become eviction candidates."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"connection_pool_keep_alive"})}),(0,i.jsx)(n.td,{children:"false"}),(0,i.jsx)(n.td,{children:"Only valid on BE nodes, used to decide whether to keep connections that have reached the minimum eviction idle time but have not reached the maximum lifetime active. Turned off by default to reduce unnecessary resource usage."})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"property-notes",children:"Property Notes"}),"\n",(0,i.jsx)(n.h3,{id:"driver-package-path-and-security",children:"Driver package path and security"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"driver_url"})," can be specified in the following three ways:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["File name. Such as ",(0,i.jsx)(n.code,{children:"mysql-connector-j-8.3.0.jar"}),". The Jar package needs to be pre-stored in ",(0,i.jsx)(n.code,{children:"jdbc_drivers/"})," under the FE and BE deployment directories.\nUnder contents. The system will automatically search in this directory. The location of this directory can also be modified by the ",(0,i.jsx)(n.code,{children:"jdbc_drivers_dir"})," configuration in fe.conf and be.conf."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Local absolute path. Such as ",(0,i.jsx)(n.code,{children:"file:///path/to/mysql-connector-j-8.3.0.jar"}),". Jar packages need to be stored in the paths specified by all FE/BE nodes in advance."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["HTTP address. For example: ",(0,i.jsx)(n.a,{href:"http://repo1.maven.org/maven2/com/mysql/mysql-connector-j/8.3.0/mysql-connector-j-8.3.0.jar",children:"http://repo1.maven.org/maven2/com/mysql/mysql-connector-j/8.3.0/mysql-connector-j-8.3.0.jar"})," The system will download the Driver file from this Http address. Only HTTP services without authentication are supported."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Driver package security"})}),"\n",(0,i.jsx)(n.p,{children:"In order to prevent the use of a Driver Jar package with an unallowed path when creating the Catalog, Doris will perform path management and checksum checking on the Jar package."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["For the above method 1, the ",(0,i.jsx)(n.code,{children:"jdbc_drivers_dir"})," configured by the Doris default user and all Jar packages in its directory are safe and will not be path checked."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"For the above methods 2 and 3, Doris will check the source of the Jar package. The checking rules are as follows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Control the allowed driver package paths through the FE configuration item ",(0,i.jsx)(n.code,{children:"jdbc_driver_secure_path"}),". This configuration item can configure multiple paths, separated by semicolons. When this option is configured, Doris\nIt will check whether the partial prefix of the path of driver_url in Catalog properties is in ",(0,i.jsx)(n.code,{children:"jdbc_driver_secure_path"}),". If it is not in it, the creation will be refused.\nCatalog."]}),"\n",(0,i.jsxs)(n.li,{children:["This parameter defaults to ",(0,i.jsx)(n.code,{children:"*"}),", which means Jar packages of all paths are allowed."]}),"\n",(0,i.jsxs)(n.li,{children:["If the configuration ",(0,i.jsx)(n.code,{children:"jdbc_driver_secure_path"})," is empty, it also means that Jar packages of all paths are allowed."]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{title:"remarks",type:"info",children:[(0,i.jsxs)(n.p,{children:["For example, configure ",(0,i.jsx)(n.code,{children:'jdbc_driver_secure_path = "file:///path/to/jdbc_drivers;http://path/to/jdbc_drivers"'}),":"]}),(0,i.jsxs)(n.p,{children:["Then only driver package paths starting with ",(0,i.jsx)(n.code,{children:"file:///path/to/jdbc_drivers"})," or ",(0,i.jsx)(n.code,{children:"http://path/to/jdbc_drivers"})," are allowed."]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["When creating a Catalog, you can specify the checksum of the driver package through the ",(0,i.jsx)(n.code,{children:"checksum"})," parameter. Doris will verify the driver package after loading the driver package. If the verification fails, the creation will be rejected.\nCatalog."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"remarks",type:"info",children:(0,i.jsx)(n.p,{children:"The above verification will only be performed when the catalog is created, and the already created catalog will not be verified again."})}),"\n",(0,i.jsx)(n.h3,{id:"lowercase-name-synchronization",children:"Lowercase name synchronization"}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"lower_case_meta_names"})," is set to ",(0,i.jsx)(n.code,{children:"true"}),", Doris maintains the mapping of lowercase names to actual names in the remote system, enabling queries to use lowercase to query non-lowercase databases, tables and columns of external data sources."]}),"\n",(0,i.jsxs)(n.p,{children:["Since FE has the ",(0,i.jsx)(n.code,{children:"lower_case_table_names"})," parameter, it will affect the table name case rules during query, so the rules are as follows"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"lower_case_meta_names = true"})}),"\n",(0,i.jsx)(n.p,{children:"Library table column names will be converted to lowercase."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"lower_case_meta_names = false"})}),"\n",(0,i.jsxs)(n.p,{children:["When the ",(0,i.jsx)(n.code,{children:"lower_case_table_names"})," parameter of FE is ",(0,i.jsx)(n.code,{children:"0"})," or ",(0,i.jsx)(n.code,{children:"2"}),", the library names, table names and column names will not be converted."]}),"\n",(0,i.jsxs)(n.p,{children:["When the ",(0,i.jsx)(n.code,{children:"lower_case_table_names"})," parameter of FE is ",(0,i.jsx)(n.code,{children:"1"}),", table names will be converted to lowercase, and library names and column names will not be converted."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If the parameter configuration when creating the Catalog matches the lowercase conversion rule in the above rules, Doris will convert the corresponding name to lowercase and store it in Doris. You need to use\nDoris displays the lowercase name to query."}),"\n",(0,i.jsxs)(n.p,{children:["If the external data source has the same name but different case, such as DORIS and doris, Doris will query the Catalog due to ambiguity.\nAn error is reported. At this time, the ",(0,i.jsx)(n.code,{children:"meta_names_mapping"})," parameter needs to be configured to resolve the conflict."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"meta_names_mapping"})," parameter accepts a Json format string with the following format:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "databases": [\n    {\n      "remoteDatabase": "DORIS",\n      "mapping": "doris_1"\n    },\n    {\n      "remoteDatabase": "doris",\n      "mapping": "doris_2"\n    }\n  ],\n  "tables": [\n    {\n      "remoteDatabase": "DORIS",\n      "remoteTable": "DORIS",\n      "mapping": "doris_1"\n    },\n    {\n      "remoteDatabase": "DORIS",\n      "remoteTable": "doris",\n      "mapping": "doris_2"\n    }\n  ],\n  "columns": [\n    {\n      "remoteDatabase": "DORIS",\n      "remoteTable": "DORIS",\n      "remoteColumn": "DORIS",\n      "mapping": "doris_1"\n    },\n    {\n      "remoteDatabase": "DORIS",\n      "remoteTable": "DORIS",\n      "remoteColumn": "doris",\n      "mapping": "doris_2"\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"When filling this configuration into the statement that creates the Catalog, there are double quotes in Json, so you need to escape the double quotes or directly use single quotes to wrap the Json string when filling in."}),"\n",(0,i.jsx)(n.h3,{id:"specify-synchronization-database",children:"Specify synchronization database"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"only_specified_database"}),":\nWhether to synchronize only the Database of the data source specified in the JDBC URL. The default value is ",(0,i.jsx)(n.code,{children:"false"}),", which means synchronizing all Databases in the JDBC URL."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"include_database_list"}),":\nOnly effective when ",(0,i.jsx)(n.code,{children:"only_specified_database=true"}),", specify the Schema of PostgreSQL that needs to be synchronized, separated by ','. Schema names are case-sensitive."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exclude_database_list"}),":\nOnly effective when ",(0,i.jsx)(n.code,{children:"only_specified_database=true"}),", specify the Schema of PostgreSQL that does not need to be synchronized, separated by ','. Schema names are case-sensitive."]}),"\n",(0,i.jsx)(n.admonition,{title:"remarks",type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The Database mentioned in the above three parameters refers to the Database level in Doris, not the Database level of external data sources. For specific mapping relationships, please refer to each data source document."}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"include_database_list"})," and ",(0,i.jsx)(n.code,{children:"exclude_database_list"})," have overlapping database configurations, ",(0,i.jsx)(n.code,{children:"exclude_database_list"})," will take effect first."]}),"\n"]})}),"\n",(0,i.jsx)(n.h3,{id:"connection-pool-configuration",children:"Connection pool configuration"}),"\n",(0,i.jsx)(n.p,{children:"In Doris, each FE and BE node maintains a connection pool, which avoids frequently opening and closing separate data source connections. Each connection in the connection pool can be used to establish a connection with the data source and execute queries. When the task is completed, these connections are returned to the pool for reuse, which not only improves performance, but also reduces the overhead of establishing connections and helps prevent the data source's connection limit from being reached."}),"\n",(0,i.jsx)(n.p,{children:"The connection pool size can be adjusted to better suit your workload. Typically, the minimum number of connections in a connection pool should be set to 1 to ensure that at least one connection is active when the keepalive mechanism is enabled. The maximum number of connections in the connection pool should be set to a reasonable value to avoid too many connections occupying resources."}),"\n",(0,i.jsxs)(n.p,{children:["At the same time, in order to avoid accumulating too many unused connection pool caches on BE, you can specify the time interval for clearing the cache by setting the ",(0,i.jsx)(n.code,{children:"jdbc_connection_pool_cache_clear_time_sec"})," parameter of BE. The default value is 28800 seconds (8 hours). After this interval, BE will forcefully clear all connection pool caches that have not been used for more than this time."]}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsx)(n.p,{children:"When using Doris JDBC Catalog to connect to external data sources, you need to be careful when updating database credentials.\nDoris maintains active connections through a connection pool to respond to queries quickly. However, after the credentials are changed, the connection pool may continue to use the old credentials to try to establish new connections and fail. Such erroneous attempts are repeated as the system attempts to maintain a certain number of active connections, and in some database systems, frequent failures may result in account lockout.\nIt is recommended that when credentials must be changed, the Doris JDBC Catalog configuration is updated synchronously and the Doris cluster is restarted to ensure that all nodes use the latest credentials to prevent connection failures and potential account lockouts."}),(0,i.jsx)(n.p,{children:"Account lockouts you may encounter are as follows:"}),(0,i.jsx)(n.p,{children:"MySQL: account is locked"}),(0,i.jsx)(n.p,{children:"Oracle: ORA-28000: the account is locked"}),(0,i.jsx)(n.p,{children:"SQL Server: Login is locked out"})]}),"\n",(0,i.jsx)(n.h3,{id:"insert-transaction",children:"Insert transaction"}),"\n",(0,i.jsxs)(n.p,{children:["Doris' data is written to the JDBC Catalog in a batch manner. If the import is interrupted midway, the previously written data may need to be rolled back. Therefore, JDBC Catalog supports transactions when data is written. Transaction support needs to be set by setting session variable: ",(0,i.jsx)(n.code,{children:"enable_odbc_transcation"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"set enable_odbc_transcation = true;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Transactions ensure the atomicity of JDBC Catalog data writing, but will reduce the performance of data writing to a certain extent. You can consider turning on this function as appropriate."}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:"Here, MySQL is used as an example to show how to create a MySQL Catalog and query the data in it."}),"\n",(0,i.jsxs)(n.p,{children:["Create a Catalog named ",(0,i.jsx)(n.code,{children:"mysql"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE CATALOG mysql PROPERTIES (\n    "type"="jdbc",\n    "user"="root",\n    "password"="secret",\n    "jdbc_url" = "jdbc:mysql://example.net:3306",\n    "driver_url" = "mysql-connector-j-8.3.0.jar",\n    "driver_class" = "com.mysql.cj.jdbc.Driver"\n)\n'})}),"\n",(0,i.jsx)(n.p,{children:"View all databases in this catalog by running SHOW DATABASES:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SHOW DATABASES FROM mysql;\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you have a MySQL database named test, you can view the tables in that database by running SHOW TABLES:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SHOW TABLES FROM mysql.test;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Finally, you can access the table in the MySQL database:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM mysql.test.table;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"statement-transparent-transmission",children:"Statement transparent transmission"}),"\n",(0,i.jsx)(n.p,{children:"Doris supports direct execution of DDL, DML statements and query statements of JDBC data sources through transparent transmission."}),"\n",(0,i.jsx)(n.h3,{id:"transparent-transmission-of-ddl-and-dml",children:"Transparent transmission of DDL and DML"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'CALL EXECUTE_STMT("catalog_name", "raw_stmt_string");\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"EXECUTE_STMT()"})," procedure takes two parameters:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Catalog Name: Currently only JDBC type Catalog is supported."}),"\n",(0,i.jsx)(n.li,{children:"Execution statements: Currently only DDL and DML statements are supported, and the syntax corresponding to the data source needs to be used directly."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'CALL EXECUTE_STMT("jdbc_catalog", "insert into db1.tbl1 values(1,2), (3, 4)");\n\nCALL EXECUTE_STMT("jdbc_catalog", "delete from db1.tbl1 where k1 = 2");\n\nCALL EXECUTE_STMT("jdbc_catalog", "create table dbl1.tbl2 (k1 int)");\n'})}),"\n",(0,i.jsx)(n.h3,{id:"transparent-query",children:"Transparent query"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'query(\n  "catalog" = "catalog_name",\n  "query" = "select * from db_name.table_name where condition"\n  );\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"query"})," table function takes two parameters:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"catalog"}),": Catalog name, which needs to be filled in according to the name of the Catalog."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"query"}),": The query statement that needs to be executed, and the syntax corresponding to the data source needs to be used directly."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'select * from query("catalog" = "jdbc_catalog", "query" = "select * from db_name.table_name where condition");\n'})}),"\n",(0,i.jsx)(n.h3,{id:"principles-and-limitations",children:"Principles and Limitations"}),"\n",(0,i.jsxs)(n.p,{children:["Through the ",(0,i.jsx)(n.code,{children:"CALL EXECUTE_STMT()"})," command, Doris will directly send the SQL statement written by the user to the JDBC data source corresponding to the Catalog for execution. Therefore, this operation has the following limitations:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The SQL statement must be the syntax corresponding to the data source. Doris will not perform syntax and semantic checks."}),"\n",(0,i.jsxs)(n.li,{children:["It is recommended that the table name referenced in the SQL statement be a fully qualified name, that is, in the format of ",(0,i.jsx)(n.code,{children:"db.tbl"}),". If db is not specified, the db name specified in the JDBC URL of the JDBC Catalog is used."]}),"\n",(0,i.jsx)(n.li,{children:"SQL statements cannot reference library tables other than JDBC data sources, nor can they reference Doris library tables. However, you can reference library tables in the JDBC data source but not synchronized to the Doris JDBC Catalog."}),"\n",(0,i.jsx)(n.li,{children:"When executing a DML statement, the number of rows inserted, updated, or deleted cannot be obtained, but only whether the command was successfully executed."}),"\n",(0,i.jsxs)(n.li,{children:["Only users with LOAD permissions on the Catalog can execute the ",(0,i.jsx)(n.code,{children:"CALL EXECUTE_STMT()"})," command."]}),"\n",(0,i.jsxs)(n.li,{children:["Only users with SELECT permissions on Catalog can execute the ",(0,i.jsx)(n.code,{children:"query()"})," table function."]}),"\n",(0,i.jsxs)(n.li,{children:["The supported data types of the data read by the ",(0,i.jsx)(n.code,{children:"query"})," table function are consistent with the data types supported by the queried catalog type."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting-connection-pool-issues",children:"Troubleshooting connection pool issues"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["In versions less than 2.0.5, the connection pool related configuration can only be configured in JAVA_OPTS of BE conf, refer to version 2.0.4 [be.conf](",(0,i.jsx)(n.a,{href:"https://github.com/apache/doris/blob/",children:"https://github.com/apache/doris/blob/"})," 2.0.4-rc06/conf/be.conf#L22)."]}),"\n",(0,i.jsx)(n.li,{children:"In versions 2.0.5 and later, connection pool related configurations can be configured in the Catalog properties, refer to [Connection Pool Properties](#Connection Pool Properties)."}),"\n",(0,i.jsx)(n.li,{children:"The connection pool used by Doris was changed from Druid to HikariCP starting from 2.0.10 (2.0 Release) and 2.1.3 (2.1 Release), so the connection pool related errors and troubleshooting methods are different, refer to the following"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"druid-connection-pool-version",children:"Druid connection pool version"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Initialize datasource failed: CAUSED BY: GetConnectionTimeoutException: wait millis 5006, active 10, maxActive 10, creating 1"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Reason 1: Too many queries cause the number of connections to exceed the configuration"}),"\n",(0,i.jsx)(n.li,{children:"Reason 2: The connection pool count is abnormal and the active count does not decrease."}),"\n",(0,i.jsxs)(n.li,{children:["Solution\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"alter catalog <catalog_name> set properties ('connection_pool_max_size' = '100'); Temporarily increase the connection pool capacity by adjusting the number of connections, and the connection pool cache can be refreshed in this way"}),"\n",(0,i.jsx)(n.li,{children:"Upgrade to replace the connection pool to Hikari version"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Initialize datasource failed: CAUSED BY: GetConnectionTimeoutException: wait millis 5006, active 10, maxActive 0, creating 1"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Reason 1: Network failure"}),"\n",(0,i.jsx)(n.li,{children:"Reason 2: The network delay is high, causing the connection creation to take more than 5s"}),"\n",(0,i.jsxs)(n.li,{children:["Solution\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check network"}),"\n",(0,i.jsx)(n.li,{children:"alter catalog <catalog_name> set properties ('connection_pool_max_wait' = '10000'); Increase the timeout"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"hikaricp-connection-pool-version",children:"HikariCP connection pool version"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"Connection is not available, request timed out after 5000ms"})}),"\n",(0,i.jsx)(n.h4,{id:"possible-reasons",children:"Possible reasons:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause 1"}),": Network problem (e.g. server unreachable)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause 2"}),": Authentication issues, such as invalid username or password"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause 3"}),": The network latency is too high, causing the connection creation to exceed the 5 second timeout"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause 4"}),": Too many concurrent queries, exceeding the maximum number of connections configured in the connection pool"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"solution",children:"Solution:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:'If there are only "Connection is not available, request timed out after 5000ms" errors'}),", please check ",(0,i.jsx)(n.strong,{children:"Cause 3"})," and ",(0,i.jsx)(n.strong,{children:"Cause 4"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check for high network latency or resource exhaustion."}),"\n",(0,i.jsxs)(n.li,{children:["Increase the maximum number of connections in the connection pool:\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER CATALOG <catalog_name> SET PROPERTIES ('connection_pool_max_size' = '100');\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Increase the connection timeout:\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER CATALOG <catalog_name> SET PROPERTIES ('connection_pool_max_wait_time' = '10000');\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:'If there are other error messages besides "Connection is not available, request timed out after 5000ms"'}),", please check these additional errors:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Network problems"})," (e.g. server unreachable) may cause connection failure. Please check whether the network connection is normal."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authentication issues"})," (e.g. invalid username or password) may also cause connection failure. Please check the database credentials used in the configuration to ensure that the username and password are correct."]}),"\n",(0,i.jsx)(n.li,{children:"Based on specific error messages, investigate network, database, or authentication-related issues to identify the root cause."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return r},a:function(){return o}});var s=t(667294);let i={},a=s.createContext(i);function o(e){let n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);