"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["998007"],{933285:function(e,n,t){t.r(n),t.d(n,{default:()=>u,frontMatter:()=>i,metadata:()=>s,assets:()=>c,toc:()=>o,contentTitle:()=>r});var s=JSON.parse('{"id":"sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-MATERIALIZED-VIEW","title":"CREATE-MATERIALIZED-VIEW","description":"\x3c!--","source":"@site/versioned_docs/version-2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-MATERIALIZED-VIEW.md","sourceDirName":"sql-manual/sql-reference/Data-Definition-Statements/Create","slug":"/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-MATERIALIZED-VIEW","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-MATERIALIZED-VIEW","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"CREATE-MATERIALIZED-VIEW","language":"en"},"sidebar":"docs","previous":{"title":"CREATE-VIEW","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-VIEW"},"next":{"title":"CREATE-FUNCTION","permalink":"/docs/2.0/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-FUNCTION"}}'),a=t("785893"),l=t("250065");let i={title:"CREATE-MATERIALIZED-VIEW",language:"en"},r=void 0,c={},o=[{value:"CREATE-MATERIALIZED-VIEW",id:"create-materialized-view",level:2},{value:"Name",id:"name",level:3},{value:"Description",id:"description",level:3},{value:"Example",id:"example",level:3},{value:"Keywords",id:"keywords",level:3},{value:"Best Practice",id:"best-practice",level:3}];function d(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"create-materialized-view",children:"CREATE-MATERIALIZED-VIEW"}),"\n",(0,a.jsx)(n.h3,{id:"name",children:"Name"}),"\n",(0,a.jsx)(n.p,{children:"CREATE MATERIALIZED VIEW"}),"\n",(0,a.jsx)(n.h3,{id:"description",children:"Description"}),"\n",(0,a.jsx)(n.p,{children:"This statement is used to create a materialized view."}),"\n",(0,a.jsxs)(n.p,{children:["This operation is an asynchronous operation. After the submission is successful, you need to view the job progress through ",(0,a.jsx)(n.a,{href:"/docs/2.0/sql-manual/sql-reference/Show-Statements/SHOW-ALTER-TABLE-MATERIALIZED-VIEW",children:"SHOW ALTER TABLE MATERIALIZED VIEW"}),". After displaying FINISHED, you can use the ",(0,a.jsx)(n.code,{children:"desc [table_name] all"})," command to view the schema of the materialized view."]}),"\n",(0,a.jsx)(n.p,{children:"grammar:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:'CREATE MATERIALIZED VIEW < MV name > as < query >\n[PROPERTIES ("key" = "value")]\n'})}),"\n",(0,a.jsx)(n.p,{children:"illustrate:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"MV name"}),": The name of the materialized view, required. Materialized view names for the same table cannot be repeated."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"query"}),": The query statement used to construct the materialized view, the result of the query statement is the data of the materialized view. Currently supported query formats are:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT select_expr[, select_expr ...]\nFROM [Base view name]\nGROUP BY column_name[, column_name ...]\nORDER BY column_name[, column_name ...]\n"})}),"\n",(0,a.jsx)(n.p,{children:"The syntax is the same as the query syntax."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"select_expr"}),": All columns in the schema of the materialized view.\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Contains at least one single column."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"base view name"}),": The original table name of the materialized view, required.\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Must be a single table and not a subquery"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"group by"}),": The grouping column of the materialized view, optional.\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If not filled, the data will not be grouped."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"order by"}),": the sorting column of the materialized view, optional.\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The declaration order of the sort column must be the same as the column declaration order in select_expr."}),"\n",(0,a.jsx)(n.li,{children:"If order by is not declared, the sorting column is automatically supplemented according to the rules. If the materialized view is an aggregate type, all grouping columns are automatically supplemented as sort columns. If the materialized view is of a non-aggregate type, the first 36 bytes are automatically supplemented as the sort column."}),"\n",(0,a.jsx)(n.li,{children:"If the number of auto-supplemented sorts is less than 3, the first three are used as the sort sequence. If query contains a grouping column, the sorting column must be the same as the grouping column."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"properties"}),"\n",(0,a.jsx)(n.p,{children:"Declare some configuration of the materialized view, optional."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:'PROPERTIES ("key" = "value", "key" = "value" ...)\n'})}),"\n",(0,a.jsx)(n.p,{children:"The following configurations can be declared here:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:" short_key: The number of sorting columns.\n timeout: The timeout for materialized view construction.\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,a.jsx)(n.p,{children:"Base table structure is"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"mysql> desc duplicate_table;\n+-------+--------+------+------+---------+-------+\n| Field | Type | Null | Key | Default | Extra |\n+-------+--------+------+------+---------+-------+\n| k1 | INT | Yes | true | N/A | |\n| k2 | INT | Yes | true | N/A | |\n| k3 | BIGINT | Yes | true | N/A | |\n| k4 | BIGINT | Yes | true | N/A | |\n+-------+--------+------+------+---------+-------+\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:'create table duplicate_table(\n	k1 int null,\n	k2 int null,\n	k3 bigint null,\n	k4 bigint null\n)\nduplicate key (k1,k2,k3,k4)\ndistributed BY hash(k4) buckets 3\nproperties("replication_num" = "1");\n'})}),"\n",(0,a.jsx)(n.p,{children:"attention\uFF1AIf the materialized view contains partitioned and distributed columns of the Base table, these columns must be used as key columns in the materialized view"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create a materialized view that contains only the columns of the original table (k1, k2)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"create materialized view k2_k1 as\nselect k2, k1 from duplicate_table;\n"})}),"\n",(0,a.jsx)(n.p,{children:"The schema of the materialized view is as follows, the materialized view contains only two columns k1, k2 without any aggregation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+-------+-------+--------+------+------+ ---------+-------+\n| IndexName | Field | Type | Null | Key | Default | Extra |\n+-------+-------+--------+------+------+ ---------+-------+\n| k2_k1 | k2 | INT | Yes | true | N/A | |\n| | k1 | INT | Yes | true | N/A | |\n+-------+-------+--------+------+------+ ---------+-------+\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create a materialized view with k2 as the sort column"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"create materialized view k2_order as\nselect k2, k1 from duplicate_table order by k2;\n"})}),"\n",(0,a.jsx)(n.p,{children:"The schema of the materialized view is shown in the figure below. The materialized view contains only two columns k2, k1, where k2 is the sorting column without any aggregation."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+-------+-------+--------+------+------- +---------+-------+\n| IndexName | Field | Type | Null | Key | Default | Extra |\n+-------+-------+--------+------+------- +---------+-------+\n| k2_order | k2 | INT | Yes | true | N/A | |\n| | k1 | INT | Yes | false | N/A | NONE |\n+-------+-------+--------+------+------- +---------+-------+\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create a materialized view with k1, k2 grouping and k3 column aggregated by SUM"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"create materialized view k1_k2_sumk3 as\nselect k1, k2, sum(k3) from duplicate_table group by k1, k2;\n"})}),"\n",(0,a.jsx)(n.p,{children:"The schema of the materialized view is shown in the figure below. The materialized view contains two columns k1, k2, sum(k3) where k1, k2 are the grouping columns, and sum(k3) is the sum value of the k3 column grouped by k1, k2."}),"\n",(0,a.jsx)(n.p,{children:"Since the materialized view does not declare a sorting column, and the materialized view has aggregated data, the system defaults to supplement the grouping columns k1 and k2 as sorting columns."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+-------+-------+--------+------+------- +---------+-------+\n| IndexName | Field | Type | Null | Key | Default | Extra |\n+-------+-------+--------+------+------- +---------+-------+\n| k1_k2_sumk3 | k1 | INT | Yes | true | N/A | |\n| | k2 | INT | Yes | true | N/A | |\n| | k3 | BIGINT | Yes | false | N/A | SUM |\n+-------+-------+--------+------+------- +---------+-------+\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create a materialized view that removes duplicate rows"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"create materialized view deduplicate as\nselect k1, k2, k3, k4 from duplicate_table group by k1, k2, k3, k4;\n"})}),"\n",(0,a.jsx)(n.p,{children:"The materialized view schema is as shown below. The materialized view contains columns k1, k2, k3, and k4, and there are no duplicate rows."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"+-------+-------+--------+------+------- +---------+-------+\n| IndexName | Field | Type | Null | Key | Default | Extra |\n+-------+-------+--------+------+------- +---------+-------+\n| deduplicate | k1 | INT | Yes | true | N/A | |\n| | k2 | INT | Yes | true | N/A | |\n| | k3 | BIGINT | Yes | true | N/A | |\n| | k4 | BIGINT | Yes | true | N/A | |\n+-------+-------+--------+------+------- +---------+-------+\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create a non-aggregate materialized view that does not declare a sort column"}),"\n",(0,a.jsx)(n.p,{children:"The schema of all_type_table is as follows"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"+-------+--------------+------+-------+---------+- ------+\n| Field | Type | Null | Key | Default | Extra |\n+-------+--------------+------+-------+---------+- ------+\n| k1 | TINYINT | Yes | true | N/A | |\n| k2 | SMALLINT | Yes | true | N/A | |\n| k3 | INT | Yes | true | N/A | |\n| k4 | BIGINT | Yes | true | N/A | |\n| k5 | DECIMAL(9,0) | Yes | true | N/A | |\n| k6 | DOUBLE | Yes | false | N/A | NONE |\n| k7 | VARCHAR(20) | Yes | false | N/A | NONE |\n+-------+--------------+------+-------+---------+- ------+\n"})}),"\n",(0,a.jsx)(n.p,{children:"The materialized view contains k3, k4, k5, k6, k7 columns, and does not declare a sort column, the creation statement is as follows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"create materialized view mv_1 as\nselect k3, k4, k5, k6, k7 from all_type_table;\n"})}),"\n",(0,a.jsx)(n.p,{children:"The default added sorting column of the system is k3, k4, k5 three columns. The sum of the bytes of these three column types is 4(INT) + 8(BIGINT) + 16(DECIMAL) = 28 < 36. So the addition is that these three columns are used as sorting columns. The schema of the materialized view is as follows, you can see that the key field of the k3, k4, k5 columns is true, that is, the sorting column. The key field of the k6, k7 columns is false, which is a non-sorted column."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"+----------------+-------+--------------+------+-- -----+---------+-------+\n| IndexName | Field | Type | Null | Key | Default | Extra |\n+----------------+-------+--------------+------+-- -----+---------+-------+\n| mv_1 | k3 | INT | Yes | true | N/A | |\n| | k4 | BIGINT | Yes | true | N/A | |\n| | k5 | DECIMAL(9,0) | Yes | true | N/A | |\n| | k6 | DOUBLE | Yes | false | N/A | NONE |\n| | k7 | VARCHAR(20) | Yes | false | N/A | NONE |\n+----------------+-------+--------------+------+-- -----+---------+-------+\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"keywords",children:"Keywords"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"CREATE, MATERIALIZED, VIEW\n"})}),"\n",(0,a.jsx)(n.h3,{id:"best-practice",children:"Best Practice"})]})}function u(e={}){let{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},250065:function(e,n,t){t.d(n,{Z:function(){return r},a:function(){return i}});var s=t(667294);let a={},l=s.createContext(a);function i(e){let n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);