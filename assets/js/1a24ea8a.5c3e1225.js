"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["769450"],{698594:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>c,metadata:()=>l,assets:()=>r,toc:()=>o,contentTitle:()=>a});var l=JSON.parse('{"id":"sql-manual/sql-functions/table-valued-functions/local","title":"LOCAL","description":"\x3c!--","source":"@site/versioned_docs/version-2.0/sql-manual/sql-functions/table-valued-functions/local.md","sourceDirName":"sql-manual/sql-functions/table-valued-functions","slug":"/sql-manual/sql-functions/table-valued-functions/local","permalink":"/docs/2.0/sql-manual/sql-functions/table-valued-functions/local","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"LOCAL","language":"en"},"sidebar":"docs","previous":{"title":"HDFS","permalink":"/docs/2.0/sql-manual/sql-functions/table-valued-functions/hdfs"},"next":{"title":"ICEBERG_META","permalink":"/docs/2.0/sql-manual/sql-functions/table-valued-functions/iceberg-meta"}}'),i=s("785893"),t=s("250065");let c={title:"LOCAL",language:"en"},a=void 0,r={},o=[{value:"local",id:"local",level:2},{value:"Name",id:"name",level:3},{value:"Description",id:"description",level:3},{value:"syntax",id:"syntax",level:4},{value:"Examples",id:"examples",level:3},{value:"Keywords",id:"keywords",level:3},{value:"Best Practice",id:"best-practice",level:3}];function d(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"local",children:"local"}),"\n",(0,i.jsx)(n.h3,{id:"name",children:"Name"}),"\n",(0,i.jsx)(n.p,{children:"local"}),"\n",(0,i.jsx)(n.h3,{id:"description",children:"Description"}),"\n",(0,i.jsxs)(n.p,{children:["Local table-valued-function(tvf), allows users to read and access local file contents on be node, just like accessing relational table. Currently supports ",(0,i.jsx)(n.code,{children:"csv/csv_with_names/csv_with_names_and_types/json/parquet/orc"})," file format."]}),"\n",(0,i.jsxs)(n.p,{children:["It needs ",(0,i.jsx)(n.code,{children:"ADMIN"})," privilege to use."]}),"\n",(0,i.jsx)(n.h4,{id:"syntax",children:"syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'local(\n  "file_path" = "path/to/file.txt", \n  "backend_id" = "be_id",\n  "format" = "csv",\n  "keyn" = "valuen" \n  ...\n  );\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"parameter description"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Related parameters for accessing local file on be node:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"file_path"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:["(required) The path of the file to be read, which is a relative path to the ",(0,i.jsx)(n.code,{children:"user_files_secure_path"})," directory, where ",(0,i.jsx)(n.code,{children:"user_files_secure_path"})," parameter ",(0,i.jsx)(n.a,{href:"/docs/2.0/admin-manual/config/be-config",children:"can be configured on be"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Can not contains ",(0,i.jsx)(n.code,{children:".."})," in path. Support using glob syntax to match multi files, such as ",(0,i.jsx)(n.code,{children:"log/*.log"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Related to execution method:"}),"\n",(0,i.jsx)(n.p,{children:"In versions prior to 2.1.1, Doris only supported specifying a BE node to read local data files on that node."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"backend_id"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:["The be id where the file is located. ",(0,i.jsx)(n.code,{children:"backend_id"})," can be obtained through the ",(0,i.jsx)(n.code,{children:"show backends"})," command."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Starting from version 2.1.2, Doris adds a new parameter ",(0,i.jsx)(n.code,{children:"shared_storage"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"shared_storage"})}),"\n",(0,i.jsx)(n.p,{children:"Default is false. If true, the specified file exists on shared storage (such as NAS). Shared storage must be compatible with the POXIS file interface and mounted on all BE nodes at the same time."}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"shared_storage"})," is true, you do not need to set ",(0,i.jsx)(n.code,{children:"backend_id"}),", Doris may use all BE nodes for data access. If ",(0,i.jsx)(n.code,{children:"backend_id"})," is set, still only executes on the specified BE node."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"File format parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"format"}),": (required) Currently support ",(0,i.jsx)(n.code,{children:"csv/csv_with_names/csv_with_names_and_types/json/parquet/orc"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"column_separator"}),": (optional) default ",(0,i.jsx)(n.code,{children:"\\t"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"line_delimiter"}),": (optional) default ",(0,i.jsx)(n.code,{children:"\\n"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"compress_type"}),": (optional) Currently support ",(0,i.jsx)(n.code,{children:"UNKNOWN/PLAIN/GZ/LZO/BZ2/LZ4FRAME/DEFLATE/SNAPPYBLOCK"}),". Default value is ",(0,i.jsx)(n.code,{children:"UNKNOWN"}),", it will automatically infer the type based on the suffix of ",(0,i.jsx)(n.code,{children:"uri"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The following parameters are used for loading in json format. For specific usage methods, please refer to: ",(0,i.jsx)(n.a,{href:"../../../data-operate/import/file-format/json",children:"Json Load"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"read_json_by_line"}),": (optional) default ",(0,i.jsx)(n.code,{children:'"true"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"strip_outer_array"}),": (optional) default ",(0,i.jsx)(n.code,{children:'"false"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"json_root"}),": (optional) default ",(0,i.jsx)(n.code,{children:'""'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"json_paths"}),": (optional) default ",(0,i.jsx)(n.code,{children:'""'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"num_as_string"}),": (optional) default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"fuzzy_parse"}),": (optional) default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The following parameters are used for loading in csv format"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"trim_double_quotes"}),": Boolean type (optional), the default value is ",(0,i.jsx)(n.code,{children:"false"}),". True means that the outermost double quotes of each field in the csv file are trimmed."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"skip_lines"}),": Integer type (optional), the default value is 0. It will skip some lines in the head of csv file. It will be disabled when the format is ",(0,i.jsx)(n.code,{children:"csv_with_names"})," or ",(0,i.jsx)(n.code,{children:"csv_with_names_and_types"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"other parameter:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path_partition_keys"}),': (optional) Specifies the column names carried in the file path. For example, if the file path is /path/to/city=beijing/date="2023-07-09", you should fill in ',(0,i.jsx)(n.code,{children:'path_partition_keys="city,date"'}),". It will automatically read the corresponding column names and values from the path during load process."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.p,{children:"Analyze the log file on specified BE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'mysql> select * from local(\n        "file_path" = "log/be.out",\n        "backend_id" = "10006",\n        "format" = "csv")\n       where c1 like "%start_time%" limit 10;\n+--------------------------------------------------------+\n| c1                                                     |\n+--------------------------------------------------------+\n| start time: 2023\u5E74 08\u6708 07\u65E5 \u661F\u671F\u4E00 23:20:32 CST       |\n| start time: 2023\u5E74 08\u6708 07\u65E5 \u661F\u671F\u4E00 23:32:10 CST       |\n| start time: 2023\u5E74 08\u6708 08\u65E5 \u661F\u671F\u4E8C 00:20:50 CST       |\n| start time: 2023\u5E74 08\u6708 08\u65E5 \u661F\u671F\u4E8C 00:29:15 CST       |\n+--------------------------------------------------------+\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Read and access csv format files located at path ",(0,i.jsx)(n.code,{children:"${DORIS_HOME}/student.csv"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'mysql> select * from local(\n      "file_path" = "student.csv", \n      "backend_id" = "10003", \n      "format" = "csv");\n+------+---------+--------+\n| c1   | c2      | c3     |\n+------+---------+--------+\n| 1    | alice   | 18     |\n| 2    | bob     | 20     |\n| 3    | jack    | 24     |\n| 4    | jackson | 19     |\n| 5    | liming  | d18    |\n+------+---------+--------+\n'})}),"\n",(0,i.jsx)(n.p,{children:"Query files on NAS:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'mysql> select * from local(\n        "file_path" = "/mnt/doris/prefix_*.txt",\n        "format" = "csv",\n        "column_separator" =",",\n        "shared_storage" = "true");\n+------+------+------+\n| c1   | c2   | c3   |\n+------+------+------+\n| 1    | 2    | 3    |\n| 1    | 2    | 3    |\n| 1    | 2    | 3    |\n| 1    | 2    | 3    |\n| 1    | 2    | 3    |\n+------+------+------+\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Can be used with ",(0,i.jsx)(n.code,{children:"desc function"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'mysql> desc function local(\n      "file_path" = "student.csv", \n      "backend_id" = "10003", \n      "format" = "csv");\n+-------+------+------+-------+---------+-------+\n| Field | Type | Null | Key   | Default | Extra |\n+-------+------+------+-------+---------+-------+\n| c1    | TEXT | Yes  | false | NULL    | NONE  |\n| c2    | TEXT | Yes  | false | NULL    | NONE  |\n| c3    | TEXT | Yes  | false | NULL    | NONE  |\n+-------+------+------+-------+---------+-------+\n'})}),"\n",(0,i.jsx)(n.h3,{id:"keywords",children:"Keywords"}),"\n",(0,i.jsx)(n.p,{children:"local, table-valued-function, tvf"}),"\n",(0,i.jsx)(n.h3,{id:"best-practice",children:"Best Practice"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["For more detailed usage of local tvf, please refer to ",(0,i.jsx)(n.a,{href:"/docs/2.0/sql-manual/sql-functions/table-valued-functions/s3",children:"S3"})," tvf, The only difference between them is the way of accessing the storage system."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Access data on NAS through local tvf"}),"\n",(0,i.jsx)(n.p,{children:"NAS shared storage allows to be mounted to multiple nodes at the same time. Each node can access files in the shared storage just like local files. Therefore, the NAS can be thought of as a local file system, accessed through local tvf."}),"\n",(0,i.jsxs)(n.p,{children:["When setting ",(0,i.jsx)(n.code,{children:'"shared_storage" = "true"'}),", Doris will think that the specified file can be accessed from any BE node. When a set of files is specified using wildcards, Doris will distribute requests to access files to multiple BE nodes, so that multiple nodes can be used to perform distributed file scanning and improve query performance."]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return a},a:function(){return c}});var l=s(667294);let i={},t=l.createContext(i);function c(e){let n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);