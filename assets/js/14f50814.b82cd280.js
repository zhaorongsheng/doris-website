"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["213180"],{87870:function(e,n,s){s.r(n),s.d(n,{default:()=>p,frontMatter:()=>i,metadata:()=>t,assets:()=>c,toc:()=>l,contentTitle:()=>a});var t=JSON.parse('{"id":"install/cluster-deployment/k8s-deploy/expansion-and-contraction","title":"Service expansion and contraction","description":"\x3c!--","source":"@site/versioned_docs/version-2.0/install/cluster-deployment/k8s-deploy/expansion-and-contraction.md","sourceDirName":"install/cluster-deployment/k8s-deploy","slug":"/install/cluster-deployment/k8s-deploy/expansion-and-contraction","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/expansion-and-contraction","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Service expansion and contraction","language":"en"},"sidebar":"docs","previous":{"title":"Used by Root users","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/root-user-use"},"next":{"title":"How to enter the container when the service crashes","permalink":"/docs/2.0/install/cluster-deployment/k8s-deploy/debug-crash"}}'),o=s("785893"),r=s("250065");let i={title:"Service expansion and contraction",language:"en"},a=void 0,c={},l=[{value:"Get DorisCluster resources",id:"get-doriscluster-resources",level:2},{value:"Expansion and contraction",id:"expansion-and-contraction",level:2},{value:"FE expansion",id:"fe-expansion",level:3},{value:"BE expansion",id:"be-expansion",level:3},{value:"Service contraction",id:"service-contraction",level:3}];function d(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"The expansion and contraction of Doris on K8S can be achieved by modifying the replicas field of the corresponding component of the DorisCluster resource. Modifications can be made by directly editing the corresponding resources, or by using commands."}),"\n",(0,o.jsx)(n.h2,{id:"get-doriscluster-resources",children:"Get DorisCluster resources"}),"\n",(0,o.jsxs)(n.p,{children:["Use the command ",(0,o.jsx)(n.code,{children:"kubectl --namespace {namespace} get doriscluster"})," to get the name of the deployed DorisCluster (referred to as dcr) resource. In this article, we use doris as the namespace."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"$ kubectl --namespace doris get doriscluster\nNAME                  FESTATUS    BESTATUS    CNSTATUS   BROKERSTATUS\ndoriscluster-sample   available   available\n"})}),"\n",(0,o.jsx)(n.h2,{id:"expansion-and-contraction",children:"Expansion and contraction"}),"\n",(0,o.jsxs)(n.p,{children:["All K8S operation and maintenance operations are performed by modifying the resources to the final state, and the Operator service automatically completes the operation and maintenance. For expansion and contraction operations, you can directly enter the edit mode to modify the replicas value of the corresponding spec through ",(0,o.jsx)(n.code,{children:"kubectl --namespace {namespace} edit doriscluster {dcr_name}"}),". After saving and exiting, Doris-Operator completes the operation and maintenance. You can also use the following commands to implement different components. Expansion and contraction."]}),"\n",(0,o.jsx)(n.h3,{id:"fe-expansion",children:"FE expansion"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"1. Check the current number of FE services"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'$ kubectl --namespace doris get pods -l "app.kubernetes.io/component=fe"\nNAME                       READY   STATUS    RESTARTS       AGE\ndoriscluster-sample-fe-0   1/1     Running   0              10d\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"2. Expansion FE"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'$ kubectl --namespace doris patch doriscluster doriscluster-sample --type merge --patch \'{"spec":{"feSpec":{"replicas":3}}}\'\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"3. Check expansion results"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'$ kubectl --namespace doris get pods -l "app.kubernetes.io/component=fe"\nNAME                       READY   STATUS    RESTARTS   AGE\ndoriscluster-sample-fe-2   1/1     Running   0          9m37s\ndoriscluster-sample-fe-1   1/1     Running   0          9m37s\ndoriscluster-sample-fe-0   1/1     Running   0          8m49s\n'})}),"\n",(0,o.jsx)(n.h3,{id:"be-expansion",children:"BE expansion"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"1. Check the current number of BE services"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'$ kubectl --namespace doris get pods -l "app.kubernetes.io/component=be"\nNAME                       READY   STATUS    RESTARTS      AGE\ndoriscluster-sample-be-0   1/1     Running   0             3d2h\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"2. Expansion BE"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'$ kubectl --namespace doris patch doriscluster doriscluster-sample --type merge --patch \'{"spec":{"beSpec":{"replicas":3}}}\'\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"3. Check expansion results"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'$ kubectl --namespace doris get pods -l "app.kubernetes.io/component=be"\nNAME                       READY   STATUS    RESTARTS      AGE\ndoriscluster-sample-be-0   1/1     Running   0             3d2h\ndoriscluster-sample-be-2   1/1     Running   0             12m\ndoriscluster-sample-be-1   1/1     Running   0             12m\n'})}),"\n",(0,o.jsx)(n.h3,{id:"service-contraction",children:"Service contraction"}),"\n",(0,o.jsxs)(n.p,{children:["Regarding the issue of node shrinkage, Doris-Operator currently does not support the safe shutdown of nodes. Here, the purpose of reducing FE or BE can still be achieved by reducing the replicas attribute of the cluster component. Here, the node is directly stopped to achieve node shutdown. line, the current version of Doris-Operator fails to implement ",(0,o.jsx)(n.a,{href:"../../../sql-manual/sql-reference/Cluster-Management-Statements/ALTER-SYSTEM-DECOMMISSION-BACKEND",children:"decommission"})," and goes offline after safely transferring the copy.  This may cause some problems and precautions as follows:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"If the BE node is rashly taken offline when there is a single copy of the table, there will definitely be data loss, so avoid this operation as much as possible."}),"\n",(0,o.jsx)(n.li,{children:"FE Follower nodes try to avoid being offline at will, which may cause metadata damage and affect services."}),"\n",(0,o.jsx)(n.li,{children:"FE Observer type nodes can be taken offline at will without risk."}),"\n",(0,o.jsx)(n.li,{children:"The CN node does not hold a copy of the data and can be offline at will. However, the remote data cache existing on the CN node will be lost, resulting in a certain performance regression in data query within a short period of time."}),"\n"]})]})}function p(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return a},a:function(){return i}});var t=s(667294);let o={},r=t.createContext(o);function i(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);