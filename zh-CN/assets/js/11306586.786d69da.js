"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["448439"],{28184:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>i,metadata:()=>l,assets:()=>o,toc:()=>a,contentTitle:()=>c});var l=JSON.parse('{"id":"lakehouse/sql-dialect","title":"SQL \u65B9\u8A00\u517C\u5BB9","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-2.1/lakehouse/sql-dialect.md","sourceDirName":"lakehouse","slug":"/lakehouse/sql-dialect","permalink":"/zh-CN/docs/lakehouse/sql-dialect","draft":false,"unlisted":false,"tags":[],"version":"2.1","frontMatter":{"title":"SQL \u65B9\u8A00\u517C\u5BB9","language":"zh-CN"},"sidebar":"docs","previous":{"title":"\u4E91\u670D\u52A1\u8BA4\u8BC1\u63A5\u5165","permalink":"/zh-CN/docs/lakehouse/cloud-auth"},"next":{"title":"\u4F7F\u7528 Doris \u548C Hudi","permalink":"/zh-CN/docs/lakehouse/lakehouse-best-practices/doris-hudi"}}'),r=s("785893"),t=s("250065");let i={title:"SQL \u65B9\u8A00\u517C\u5BB9",language:"zh-CN"},c=void 0,o={},a=[{value:"\u90E8\u7F72\u670D\u52A1",id:"\u90E8\u7F72\u670D\u52A1",level:2},{value:"\u4F7F\u7528 SQL \u65B9\u8A00",id:"\u4F7F\u7528-sql-\u65B9\u8A00",level:2},{value:"Presto",id:"presto",level:3},{value:"Clickhouse",id:"clickhouse",level:3}];function d(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"\u4ECE 2.1 \u7248\u672C\u5F00\u59CB\uFF0CDoris \u53EF\u4EE5\u652F\u6301\u591A\u79CD SQL \u65B9\u8A00\uFF0C\u5982 Presto\u3001Trino\u3001Hive\u3001PostgreSQL\u3001Spark\u3001Clickhouse \u7B49\u7B49\u3002\u901A\u8FC7\u8FD9\u4E2A\u529F\u80FD\uFF0C\u7528\u6237\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u5BF9\u5E94\u7684 SQL \u65B9\u8A00\u67E5\u8BE2 Doris \u4E2D\u7684\u6570\u636E\uFF0C\u65B9\u4FBF\u7528\u6237\u5C06\u539F\u5148\u7684\u4E1A\u52A1\u5E73\u6ED1\u7684\u8FC1\u79FB\u5230 Doris \u4E2D\u3002"})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["\u8BE5\u529F\u80FD\u76EE\u524D\u662F\u5B9E\u9A8C\u6027\u529F\u80FD\uFF0C\u60A8\u5728\u4F7F\u7528\u8FC7\u7A0B\u4E2D\u5982\u9047\u5230\u4EFB\u4F55\u95EE\u9898\uFF0C\u6B22\u8FCE\u901A\u8FC7\u90AE\u4EF6\u7EC4\u3001",(0,r.jsx)(n.a,{href:"https://github.com/apache/doris/issues",children:"GitHub Issue"})," \u7B49\u65B9\u5F0F\u8FDB\u884C\u53CD\u9988\u3002"]})}),"\n",(0,r.jsx)(n.h2,{id:"\u90E8\u7F72\u670D\u52A1",children:"\u90E8\u7F72\u670D\u52A1"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u4E0B\u8F7D\u6700\u65B0\u7248\u672C\u7684 ",(0,r.jsx)(n.a,{href:"https://www.selectdb.com/tools/doris-sql-convertor",children:"SQL \u65B9\u8A00\u8F6C\u6362\u5DE5\u5177"})]}),"\n",(0,r.jsx)(n.admonition,{title:"NOTE",type:"info",children:(0,r.jsxs)(n.p,{children:["SQL \u65B9\u8A00\u8F6C\u6362\u5DE5\u5177\u57FA\u4E8E\u5F00\u6E90\u7684 ",(0,r.jsx)(n.a,{href:"https://github.com/tobymao/sqlglot",children:"SQLGlot"})," \uFF0C\u7531 SelectDB \u8FDB\u884C\u4E8C\u6B21\u5F00\u53D1\uFF0C\u5173\u4E8E SQLGlot \u53EF\u53C2\u9605 ",(0,r.jsx)(n.a,{href:"https://sqlglot.com/sqlglot.html",children:"SQLGlot \u5B98\u7F51"}),"\u3002",(0,r.jsx)(n.br,{}),"\nSQL Convertor \u5E76\u975E\u7531 Apache Doris \u7EF4\u62A4\u6216\u8BA4\u53EF\uFF0C\u8FD9\u4E9B\u5DE5\u4F5C\u7531 Committers \u548C Doris PMC \u76D1\u7763\u3002\u4F7F\u7528\u8FD9\u4E9B\u8D44\u6E90\u548C\u670D\u52A1\u5B8C\u5168\u7531\u60A8\u81EA\u884C\u51B3\u5B9A\uFF0C\u793E\u533A\u4E0D\u8D1F\u8D23\u9A8C\u8BC1\u8FD9\u4E9B\u5DE5\u5177\u7684\u8BB8\u53EF\u6216\u6709\u6548\u6027\u3002"]})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5728\u4EFB\u610F FE \u8282\u70B9\uFF0C\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u542F\u52A8\u670D\u52A1\uFF1A"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u914D\u7F6E\u670D\u52A1\u7AEF\u53E3\nvim apiserver/conf/config.conf\n# \u542F\u52A8 SQL Converter for Apache Doris \u8F6C\u6362\u670D\u52A1\nsh apiserver/bin/start.sh\n# \u5982\u9700\u524D\u7AEF\u754C\u9762\uFF0C\u53EF\u5728 webserver \u4E2D\u914D\u7F6E\u76F8\u5E94\u7684\u7AEF\u53E3\u5E76\u542F\u52A8\uFF0C\u4E0D\u9700\u8981\u524D\u7AEF\u5219\u53EF\u4EE5\u5FFD\u7565\u4EE5\u4E0B\u64CD\u4F5C\nvim webserver/conf/config.conf\n# \u542F\u52A8\u524D\u7AEF\u754C\u9762\nsh webserver/bin/start.sh\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u8BE5\u670D\u52A1\u662F\u4E00\u4E2A\u65E0\u72B6\u6001\u7684\u670D\u52A1\uFF0C\u53EF\u968F\u65F6\u542F\u505C"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"apiserver/conf/config.conf"})," \u4E2D\u914D\u7F6E port \u6765\u6307\u5B9A\u4EFB\u610F\u4E00\u4E2A\u53EF\u7528\u7AEF\u53E3\uFF0C\u914D\u7F6E workers \u6765\u6307\u5B9A\u542F\u52A8\u7684\u7EBF\u7A0B\u6570\u91CF\u3002\u5728\u5E76\u53D1\u573A\u666F\u4E2D\uFF0C\u53EF\u4EE5\u6839\u636E\u9700\u8981\u8C03\u6574\uFF0C\u9ED8\u8BA4\u4E3A 1"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5EFA\u8BAE\u5728\u6BCF\u4E2A FE \u8282\u70B9\u90FD\u5355\u72EC\u542F\u52A8\u4E00\u4E2A\u670D\u52A1"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u5982\u9700\u542F\u52A8\u524D\u7AEF\u754C\u9762\uFF0C\u53EF\u4EE5\u5728 ",(0,r.jsx)(n.code,{children:"webserver/conf/config.conf"})," \u4E2D\u914D\u7F6E SQL Converter for Apache Doris \u8F6C\u6362\u670D\u52A1\u5730\u5740\uFF0C\u9ED8\u8BA4\u662F ",(0,r.jsx)(n.code,{children:"API_HOST=http://127.0.0.1:5001"})]}),"\n"]}),"\n"]})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u542F\u52A8 Doris \u96C6\u7FA4\uFF082.1 \u6216\u66F4\u9AD8\u7248\u672C\uFF09"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\uFF0C\u5728 Doris \u4E2D\u8BBE\u7F6E SQL \u65B9\u8A00\u8F6C\u6362\u670D\u52A1\u7684 URL\uFF1A"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:'MySQL> set global sql_converter_service_url = "http://127.0.0.1:5001/api/v1/convert"'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"127.0.0.1:5001"})," \u662F SQL \u65B9\u8A00\u8F6C\u6362\u670D\u52A1\u7684\u90E8\u7F72\u8282\u70B9 ip \u548C\u7AEF\u53E3\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u4F7F\u7528-sql-\u65B9\u8A00",children:"\u4F7F\u7528 SQL \u65B9\u8A00"}),"\n",(0,r.jsx)(n.p,{children:"\u76EE\u524D\u652F\u6301\u7684\u65B9\u8A00\u7C7B\u578B\u5305\u62EC\uFF1A"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"presto"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"trino"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"clickhouse"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"hive"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"spark"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"postgres"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u793A\u4F8B\uFF1A"}),"\n",(0,r.jsx)(n.h3,{id:"presto",children:"Presto"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"mysql> CREATE TABLE  test_sqlconvert (\n         id int,\n         start_time DateTime,\n         value String,\n         arr_int ARRAY<Int>,\n         arr_str ARRAY<String>\n     ) ENGINE=OLAP\n     DUPLICATE KEY(`id`)\n     COMMENT 'OLAP'\n     DISTRIBUTED BY HASH(`id`) BUCKETS 1\n     PROPERTIES (\n     \"replication_allocation\" = \"tag.location.default: 1\"\n     );\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql> INSERT INTO test_sqlconvert values(1, '2024-05-20 13:14:52', '2024-01-14',[1, 2, 3, 3], ['Hello', 'World']);\nQuery OK, 1 row affected (0.08 sec)\n\nmysql> set sql_dialect=presto;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> SELECT cast(start_time as varchar(20)) as col1,\n            array_distinct(arr_int) as col2,\n            FILTER(arr_str, x -> x LIKE '%World%') as col3,\n            to_date(value,'%Y-%m-%d') as col4,\n            YEAR(start_time) as col5,\n            date_add('month', 1, start_time) as col6,\n            REGEXP_EXTRACT_ALL(value, '-.') as col7,\n            JSON_EXTRACT('{\"id\": \"33\"}', '$.id')as col8,\n            element_at(arr_int, 1) as col9,\n            date_trunc('day',start_time) as col10\n         FROM test_sqlconvert\n         where date_trunc('day',start_time)= DATE'2024-05-20'     \n     order by id;\n+---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+\n| col1                | col2      | col3      | col4       | col5 | col6                | col7        | col8 | col9 | col10               |\n+---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+\n| 2024-05-20 13:14:52 | [1, 2, 3] | [\"World\"] | 2024-01-14 | 2024 | 2024-06-20 13:14:52 | ['-0','-1'] | \"33\" |    1 | 2024-05-20 00:00:00 |\n+---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+\n1 row in set (0.03 sec)\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"clickhouse",children:"Clickhouse"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"mysql> set sql_dialect=clickhouse;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select  toString(start_time) as col1,\n             arrayCompact(arr_int) as col2,\n             arrayFilter(x -> x like '%World%',arr_str)as col3,\n             toDate(value) as col4,\n             toYear(start_time)as col5,\n             addMonths(start_time, 1)as col6,\n             extractAll(value, '-.')as col7,\n             JSONExtractString('{\"id\": \"33\"}' , 'id')as col8,\n             arrayElement(arr_int, 1) as col9,\n             date_trunc('day',start_time) as col10\n          FROM test_sqlconvert\n          where date_trunc('day',start_time)= '2024-05-20 00:00:00'     \n     order by id;\n+---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+\n| col1                | col2      | col3      | col4       | col5 | col6                | col7        | col8 | col9 | col10               |\n+---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+\n| 2024-05-20 13:14:52 | [1, 2, 3] | [\"World\"] | 2024-01-14 | 2024 | 2024-06-20 13:14:52 | ['-0','-1'] | \"33\" |    1 | 2024-05-20 00:00:00 |\n+---------------------+-----------+-----------+------------+------+---------------------+-------------+------+------+---------------------+\n1 row in set (0.02 sec)\n"})})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return c},a:function(){return i}});var l=s(667294);let r={},t=l.createContext(r);function i(e){let n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);