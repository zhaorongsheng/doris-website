"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["67160"],{433854:function(e,n,s){s.r(n),s.d(n,{default:()=>u,frontMatter:()=>i,metadata:()=>r,assets:()=>o,toc:()=>l,contentTitle:()=>a});var r=JSON.parse('{"id":"admin-manual/auth/integrations/aws-authentication-and-authorization","title":"AWS \u8BA4\u8BC1\u548C\u9274\u6743","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-3.0/admin-manual/auth/integrations/aws-authentication-and-authorization.md","sourceDirName":"admin-manual/auth/integrations","slug":"/admin-manual/auth/integrations/aws-authentication-and-authorization","permalink":"/zh-CN/docs/3.0/admin-manual/auth/integrations/aws-authentication-and-authorization","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"AWS \u8BA4\u8BC1\u548C\u9274\u6743","language":"zh-CN"},"sidebar":"docs","previous":{"title":"\u52A0\u5BC6\u548C\u8131\u654F\u51FD\u6570","permalink":"/zh-CN/docs/3.0/admin-manual/auth/encryption-function"},"next":{"title":"Star Schema Benchmark","permalink":"/zh-CN/docs/3.0/benchmark/ssb"}}'),c=s("785893"),t=s("250065");let i={title:"AWS \u8BA4\u8BC1\u548C\u9274\u6743",language:"zh-CN"},a="\u8BA4\u8BC1\u65B9\u5F0F\u4ECB\u7ECD",o={},l=[{value:"IAM User \u8BA4\u8BC1\u9274\u6743",id:"iam-user-\u8BA4\u8BC1\u9274\u6743",level:2},{value:"Step1 \u767B\u5F55AWS\u63A7\u5236\u53F0\u521B\u5EFAIAM User\u5E76\u914D\u7F6EIAM\u7B56\u7565",id:"step1-\u767B\u5F55aws\u63A7\u5236\u53F0\u521B\u5EFAiam-user\u5E76\u914D\u7F6Eiam\u7B56\u7565",level:3},{value:"Step2 \u901A\u8FC7\u8BBF\u95EE\u5BC6\u94A5\u548CSQL\u8BED\u53E5\u4F7F\u7528Doris\u5BF9\u5E94\u529F\u80FD",id:"step2-\u901A\u8FC7\u8BBF\u95EE\u5BC6\u94A5\u548Csql\u8BED\u53E5\u4F7F\u7528doris\u5BF9\u5E94\u529F\u80FD",level:3},{value:"Assumed Role \u8BA4\u8BC1\u9274\u6743",id:"assumed-role-\u8BA4\u8BC1\u9274\u6743",level:2},{value:"Step1 \u51C6\u5907\u5DE5\u4F5C",id:"step1-\u51C6\u5907\u5DE5\u4F5C",level:3},{value:"Step2 \u914D\u7F6E\u6E90\u8D26\u6237IAM\u89D2\u8272( EC2 \u5B9E\u4F8B\u5173\u8054\u89D2\u8272) \u6743\u9650\u7B56\u7565",id:"step2-\u914D\u7F6E\u6E90\u8D26\u6237iam\u89D2\u8272-ec2-\u5B9E\u4F8B\u5173\u8054\u89D2\u8272-\u6743\u9650\u7B56\u7565",level:3},{value:"Step3 \u914D\u7F6E\u76EE\u6807\u8D26\u6237IAM\u89D2\u8272\u4FE1\u4EFB\u7B56\u7565\u548C\u6743\u9650\u7B56\u7565",id:"step3-\u914D\u7F6E\u76EE\u6807\u8D26\u6237iam\u89D2\u8272\u4FE1\u4EFB\u7B56\u7565\u548C\u6743\u9650\u7B56\u7565",level:3},{value:"Step4 \u901A\u8FC7<code>role_arn</code>\u548C<code>external_id</code>\u5B57\u6BB5\u4F7F\u7528Doris\u5BF9\u5E94SQL\u529F\u80FD",id:"step4-\u901A\u8FC7role_arn\u548Cexternal_id\u5B57\u6BB5\u4F7F\u7528doris\u5BF9\u5E94sql\u529F\u80FD",level:4}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:["Doris \u652F\u6301\u4E24\u79CD AWS \u8BA4\u8BC1\u3001\u9274\u6743\u65B9\u5F0F\u8BBF\u95EE AWS \u670D\u52A1\uFF0C",(0,c.jsx)(n.code,{children:"IAM User"}),"\u548C",(0,c.jsx)(n.code,{children:"Assumed Role"}),"\uFF0C\u672C\u6587\u4ECB\u7ECD\u5982\u4F55\u914D\u7F6E\u8FD9\u4E24\u79CD\u8BA4\u8BC1\u3001\u9274\u6743\u65B9\u5F0F\u7684 AWS \u5B89\u5168\u51ED\u8BC1\u5E76\u901A\u8FC7\u5B89\u5168\u51ED\u8BC1\u4F7F\u7528Doris\u76F8\u5173\u7684\u529F\u80FD\u6765\u8BBF\u95EEAWS\u7684\u670D\u52A1\u8D44\u6E90\u3002"]}),"\n",(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"\u8BA4\u8BC1\u65B9\u5F0F\u4ECB\u7ECD",children:"\u8BA4\u8BC1\u65B9\u5F0F\u4ECB\u7ECD"})}),"\n",(0,c.jsx)(n.h2,{id:"iam-user-\u8BA4\u8BC1\u9274\u6743",children:"IAM User \u8BA4\u8BC1\u9274\u6743"}),"\n",(0,c.jsxs)(n.p,{children:["Doris \u652F\u6301\u901A\u8FC7 \u914D\u7F6E",(0,c.jsx)(n.code,{children:"AWS IAM User"}),"\u7684\u65B9\u5F0F\u6765\u5B9E\u73B0\u5BF9\u5916\u90E8\u6570\u636E\u6E90\u7684\u8BBF\u95EE\uFF08\u5373",(0,c.jsx)(n.code,{children:"access_key"}),"\u548C",(0,c.jsx)(n.code,{children:"secret_key"}),"\u5BC6\u94A5\u7684\u65B9\u5F0F\uFF09\uFF0C\u8BE6\u7EC6\u7684\u914D\u7F6E\u6B65\u9AA4\u5982\u4E0B(\u66F4\u8BE6\u7EC6\u7684\u4ECB\u7ECD\u8BF7\u53C2\u89C1 AWS \u5B98\u7F51\u6587\u6863 ",(0,c.jsx)(n.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html",children:"IAM users"}),")\uFF1A"]}),"\n",(0,c.jsx)(n.h3,{id:"step1-\u767B\u5F55aws\u63A7\u5236\u53F0\u521B\u5EFAiam-user\u5E76\u914D\u7F6Eiam\u7B56\u7565",children:"Step1 \u767B\u5F55AWS\u63A7\u5236\u53F0\u521B\u5EFAIAM User\u5E76\u914D\u7F6EIAM\u7B56\u7565"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\u767B\u5F55 ",(0,c.jsx)(n.code,{children:"AWS\u63A7\u5236\u53F0"})," \u9009\u62E9 ",(0,c.jsx)(n.code,{children:"Create user"})," \u6309\u94AE"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(622756).Z+"",width:"1280",height:"567"})}),"\n",(0,c.jsxs)(n.ol,{start:"2",children:["\n",(0,c.jsxs)(n.li,{children:["\u586B\u5199\u597DIAM user\u540D\u5B57\u540E\uFF0C\u5728",(0,c.jsx)(n.code,{children:"Set pemissions"}),"\u90E8\u5206\u9009\u62E9\u76F4\u63A5\u9644\u52A0\u7B56\u7565"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(378198).Z+"",width:"1280",height:"635"})}),"\n",(0,c.jsxs)(n.ol,{start:"3",children:["\n",(0,c.jsx)(n.li,{children:"\u5728\u7B56\u7565\u7F16\u8F91\u5668\u4E2D\u586B\u5165\u5BF9\u5E94\u7684AWS\u8D44\u6E90\u7B56\u7565\uFF0C\u4E0B\u6587\u4EE5\u8BBF\u95EES3 Bucket\u8D44\u6E90\u4E3A\u4F8B\u5217\u51FA\u4E86\u8BFB/\u5199\u7B56\u7565\u7684\u5E38\u89C1\u6A21\u677F"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(285612).Z+"",width:"1280",height:"588"})}),"\n",(0,c.jsx)(n.p,{children:"S3 Bucket\u8BFB\u7B56\u7565\u6A21\u7248\uFF0C\u9002\u7528\u4E8E\u53EA\u9700\u8BFB\u53D6\u548C\u5217\u51FAbucket\u4E2D\u5BF9\u8C61\u7684Doris\u529F\u80FD\uFF0C\u6BD4\u5982S3 Load\uFF0C TVF\uFF0CExternal Catalog\u7B49"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u6CE8\u610F: "})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u66FF\u6362\u5BF9\u5E94\u7684bucket name\u548Cprefix\u8DEF\u5F84"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u4E0D\u8981\u6DFB\u52A0\u591A\u4F59\u7684\u201C/\u201D\u5206\u5272\u7B26"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Action": [\n              "s3:GetObject",\n              "s3:GetObjectVersion",\n            ],\n            "Resource": "arn:aws:s3:::<your-bucket>/your-prefix/*"\n        },\n        {\n            "Effect": "Allow",\n            "Action": [\n                "s3:ListBucket",\n                "s3:GetBucketLocation"\n            ],\n            "Resource": "arn:aws:s3:::<your-bucket>"\n        }    \n    ]\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"S3 Bucket\u5199\u7B56\u7565\u6A21\u677F, \u9002\u7528\u4E8E\u9700\u8981\u8BFB\u53D6\u3001\u5217\u51FA\u548C\u5199\u5165bucket\u5BF9\u8C61\u7684Doris\u529F\u80FD\uFF0C\u6BD4\u5982Export\uFF0C Storage Vault\uFF0C Resource\uFF0CRepository\u7B49"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u6CE8\u610F: "})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u66FF\u6362\u5BF9\u5E94\u7684bucket name\u548Cprefix\u8DEF\u5F84"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u4E0D\u8981\u6DFB\u52A0\u591A\u4F59\u7684\u201C/\u201D\u5206\u5272\u7B26"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Action": [\n              "s3:PutObject",\n              "s3:GetObject",\n              "s3:GetObjectVersion",\n              "s3:DeleteObject",\n              "s3:DeleteObjectVersion",\n              "s3:AbortMultipartUpload",      \n              "s3:ListMultipartUploadParts"\n            ],\n            "Resource": "arn:aws:s3:::<your-bucket>/<your-prefix>/*"\n        },\n        {\n            "Effect": "Allow",\n            "Action": [\n                "s3:ListBucket",\n                "s3:GetBucketLocation",\n                "s3:GetBucketVersioning",\n                "s3:GetLifecycleConfiguration"\n            ],\n            "Resource": "arn:aws:s3:::<your-bucket>"\n        }    \n    ]\n}\n'})}),"\n",(0,c.jsxs)(n.ol,{start:"4",children:["\n",(0,c.jsx)(n.li,{children:"\u521B\u5EFAIAM User\u6210\u529F\u540E\uFF0C\u521B\u5EFAaccess/secret key\u5BC6\u94A5"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(808504).Z+"",width:"1280",height:"518"})}),"\n",(0,c.jsx)(n.h3,{id:"step2-\u901A\u8FC7\u8BBF\u95EE\u5BC6\u94A5\u548Csql\u8BED\u53E5\u4F7F\u7528doris\u5BF9\u5E94\u529F\u80FD",children:"Step2 \u901A\u8FC7\u8BBF\u95EE\u5BC6\u94A5\u548CSQL\u8BED\u53E5\u4F7F\u7528Doris\u5BF9\u5E94\u529F\u80FD"}),"\n",(0,c.jsxs)(n.p,{children:["\u5B8C\u6210\u4E0A\u8FF0Step1\u4E2D\u7684\u6240\u6709\u914D\u7F6E\u540E\uFF0C\u53EF\u83B7\u5F97",(0,c.jsx)(n.code,{children:"access_key"}),"\u548C",(0,c.jsx)(n.code,{children:"secret_key"}),"\u8BBF\u95EE\u5BC6\u94A5\uFF0C\u901A\u8FC7\u8BBF\u95EE\u5BC6\u94A5\u53EF\u4EE5\u4F7F\u7528Doris\u5BF9\u5E94\u7684\u529F\u80FD\uFF0C\u5177\u4F53\u4F8B\u5B50\u5982\u4E0B\uFF1A"]}),"\n",(0,c.jsx)(n.p,{children:"S3 Load"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'  LOAD LABEL s3_load_2022_04_01\n  (\n      DATA INFILE("s3://your_bucket_name/s3load_example.csv")\n      INTO TABLE test_s3load\n      COLUMNS TERMINATED BY ","\n      FORMAT AS "CSV"\n      (user_id, name, age)\n  )\n  WITH S3\n  (\n      "provider" = "S3",\n      "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n      "s3.region" = "us-east-1",\n      "s3.access_key" = "<your-access-key>",\n      "s3.secret_key" = "<your-secrety-key>"\n  )\n  PROPERTIES\n  (\n      "timeout" = "3600"\n  );\n'})}),"\n",(0,c.jsx)(n.p,{children:"TVF"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:"  SELECT * FROM S3 (\n      'uri' = 's3://your_bucket/path/to/tvf_test/test.parquet',\n      'format' = 'parquet',\n      's3.endpoint' = 's3.us-east-1.amazonaws.com',\n      's3.region' = 'us-east-1',\n      \"s3.access_key\" = \"<your-access-key>\",\n      \"s3.secret_key\"=\"<your-secret-key>\"\n  )\n"})}),"\n",(0,c.jsx)(n.p,{children:"External Catalog"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:"  CREATE CATALOG iceberg_catalog PROPERTIES (\n      'type' = 'iceberg',\n      'iceberg.catalog.type' = 'hadoop',\n      'warehouse' = 's3://your_bucket/dir/key',\n      's3.endpoint' = 's3.us-east-1.amazonaws.com',\n      's3.region' = 'us-east-1',\n      \"s3.access_key\" = \"<your-access-key>\",\n      \"s3.secret_key\"=\"<your-secret-key>\"\n  );\n"})}),"\n",(0,c.jsx)(n.p,{children:"Storage Vault"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'CREATE STORAGE VAULT IF NOT EXISTS s3_demo_vault\nPROPERTIES (\n    "type" = "S3",\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.bucket" = "<your-bucket>",\n    "s3.access_key" = "<your-access-key>",\n    "s3.secret_key"="<your-secret-key>",\n    "s3.root.path" = "s3_demo_vault_prefix",\n    "provider" = "S3",\n    "use_path_style" = "false"\n);\n'})}),"\n",(0,c.jsx)(n.p,{children:"Export"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'EXPORT TABLE s3_test TO "s3://your_bucket/a/b/c" \nPROPERTIES (\n    "column_separator"="\\\\x07", \n    "line_delimiter" = "\\\\x07"\n) WITH S3 (\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.access_key" = "<your-access-key>",\n    "s3.secret_key"="<your-secret-key>",\n)\n'})}),"\n",(0,c.jsx)(n.p,{children:"Repository"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'CREATE REPOSITORY `s3_repo`\nWITH S3\nON LOCATION "s3://your_bucket/s3_repo"\nPROPERTIES\n(\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.access_key" = "<your-access-key>",\n    "s3.secret_key"="<your-secret-key>"\n);\n'})}),"\n",(0,c.jsx)(n.p,{children:"Resource"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'CREATE RESOURCE "remote_s3"\nPROPERTIES\n(\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.bucket" = "<your-bucket>",\n    "s3.access_key" = "<your-access-key>",\n    "s3.secret_key"="<your-secret-key>"\n);\n'})}),"\n",(0,c.jsxs)(n.p,{children:["\u60A8\u53EF\u4EE5\u5728\u4E0D\u540C\u4E1A\u52A1\u903B\u8F91\u91CC\u6307\u5B9A\u4E0D\u540C\u7684 IAM User \u7684 ",(0,c.jsx)(n.code,{children:"access_key"})," \u548C ",(0,c.jsx)(n.code,{children:"secret_key"}),"\uFF0C\u4ECE\u800C\u5B9E\u73B0\u5916\u90E8\u6570\u636E\u7684\u8BBF\u95EE\u63A7\u5236\u3002"]}),"\n",(0,c.jsx)(n.h2,{id:"assumed-role-\u8BA4\u8BC1\u9274\u6743",children:"Assumed Role \u8BA4\u8BC1\u9274\u6743"}),"\n",(0,c.jsxs)(n.p,{children:["Assumed Role \u652F\u6301\u901A\u8FC7\u62C5\u4EFB AWS IAM Role \u6765\u5B9E\u73B0\u5BF9\u5916\u90E8\u6570\u636E\u6E90\u7684\u8BBF\u95EE\u8BA4\u8BC1\u548C\u9274\u6743(\u8BE6\u7EC6\u7684\u4ECB\u7ECD\u8BF7\u53C2\u89C1 AWS \u5B98\u7F51\u6587\u6863 ",(0,c.jsx)(n.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_manage-assume.html",children:"\u4EE3\u5165\u89D2\u8272"}),")\uFF0C\u4E0B\u56FE\u5217\u51FA\u4E86Assumed Role\u6240\u9700\u8981\u914D\u7F6E\u7684\u7B80\u8981\u6D41\u7A0B:"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(214010).Z+"",width:"4162",height:"1342"})}),"\n",(0,c.jsx)(n.p,{children:"\u540D\u8BCD\u4ECB\u7ECD:"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"\u6E90\u8D26\u6237(Source Account)"}),"\u200B: \u53D1\u8D77 Assume Role \u7684 AWS \u8D26\u6237(\u672C\u4F8B\u4E2D\u662FDoris FE/BE EC2\u673A\u5668\u6240\u5C5E\u8D26\u6237);"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"\u76EE\u6807\u8D26\u6237(Target Account)"}),"\u200B: \u62E5\u6709\u76EE\u6807 S3 Bucket \u7684 AWS \u8D26\u6237;"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"ec2_role"}),":  \u6E90\u8D26\u6237\u521B\u5EFA\u7684Role\uFF0C\u5E76\u4E14\u9700\u8981\u7ED1\u5B9A\u5230\u6BCF\u4E00\u4E2A\u90E8\u7F72Doris FE/BE \u90E8\u7F72EC2\u673A\u5668\u4E0A;"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"bucket_role"}),": \u76EE\u6807\u8D26\u6237\u521B\u5EFA\u7684Role\uFF0C\u5E76\u4E14\u9700\u8981\u5173\u8054\u76EE\u6807bucket\u6743\u9650;"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u6CE8\u610F: "})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.strong,{children:"\u6E90\u8D26\u6237\u548C\u76EE\u6807\u8D26\u6237\u53EF\u4EE5\u662F\u540C\u4E00\u4E2AAWS\u8D26\u6237;"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsxs)(n.strong,{children:["\u8BF7\u786E\u4FDD\u6240\u6709Doris FE/BE \u90E8\u7F72\u6240\u5728\u7684 EC2\u673A\u5668\u90FD\u7ED1\u5B9A\u5230\u4E86",(0,c.jsx)(n.code,{children:"ec_role"}),"\u4E0A\uFF0C\u5C24\u5176\u662F\u6269\u5BB9\u7684\u65F6\u5019\u3002"]})}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u66F4\u8BE6\u7EC6\u7684\u914D\u7F6E\u6B65\u9AA4\u5982\u4E0B\uFF1A"}),"\n",(0,c.jsx)(n.h3,{id:"step1-\u51C6\u5907\u5DE5\u4F5C",children:"Step1 \u51C6\u5907\u5DE5\u4F5C"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["\u8BF7\u786E\u4FDD\u6E90\u8D26\u6237\u521B\u5EFA\u4E86\u4E00\u4E2A",(0,c.jsx)(n.code,{children:"ec2_role"}),"\uFF0CDoris FE/BE \u90E8\u7F72\u7684EC2\u673A\u5668\u90FD\u7ED1\u5B9A\u5230\u4E86\u65B0\u521B\u5EFA\u7684",(0,c.jsx)(n.code,{children:"ec2_role"}),";"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["\u8BF7\u786E\u4FDD\u76EE\u6807\u8D26\u6237\u521B\u5EFA\u4E86\u4E00\u4E2A",(0,c.jsx)(n.code,{children:"bucket_role"}),"\u548C\u5BF9\u5E94\u7684bucket;"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["EC2\u673A\u5668\u7ED1\u5B9A",(0,c.jsx)(n.code,{children:"ec2_role"}),"\u6210\u529F\u540E\uFF0C ",(0,c.jsx)(n.code,{children:"role_arn"}),"\u67E5\u8BE2\u5982\u4E0B\u56FE\u6240\u793A:"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(682778).Z+"",width:"1280",height:"522"})}),"\n",(0,c.jsx)(n.h3,{id:"step2-\u914D\u7F6E\u6E90\u8D26\u6237iam\u89D2\u8272-ec2-\u5B9E\u4F8B\u5173\u8054\u89D2\u8272-\u6743\u9650\u7B56\u7565",children:"Step2 \u914D\u7F6E\u6E90\u8D26\u6237IAM\u89D2\u8272( EC2 \u5B9E\u4F8B\u5173\u8054\u89D2\u8272) \u6743\u9650\u7B56\u7565"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\u767B\u5F55 ",(0,c.jsx)(n.a,{href:"https://us-east-1.console.aws.amazon.com/iamv2/home#/home",children:"AWS IAM \u63A7\u5236\u53F0"}),"\uFF0C\u5728\u5DE6\u4FA7\u5BFC\u822A\u680F\u9009\u62E9 ",(0,c.jsx)(n.code,{children:"Access management > Roles"}),";"]}),"\n",(0,c.jsxs)(n.li,{children:["\u627E\u5230 ",(0,c.jsx)(n.code,{children:"EC2"})," \u5B9E\u4F8B\u5173\u8054\u89D2\u8272\uFF0C\u5355\u51FB\u89D2\u8272\u540D\u79F0\uFF1B"]}),"\n",(0,c.jsxs)(n.li,{children:["\u5728\u89D2\u8272\u8BE6\u60C5\u9875\u7684 ",(0,c.jsx)(n.code,{children:"Permissions"}),"  \u533A\u57DF, \u5355\u51FB ",(0,c.jsx)(n.code,{children:"Add permissions"})," \u5E76\u9009\u62E9 ",(0,c.jsx)(n.code,{children:"Create inline policy"}),"\uFF1B"]}),"\n",(0,c.jsxs)(n.li,{children:["\u5728 ",(0,c.jsx)(n.code,{children:"Specify permissions"})," \u6B65\u9AA4\uFF0C \u5355\u51FB JSON \u9875\u7B7E\uFF0C\u7136\u540E\u586B\u5165\u5982\u4E0B\u7B56\u7565\uFF0C\u6700\u540E\uFF0C\u5355\u51FB ",(0,c.jsx)(n.code,{children:"Review policy"}),"\uFF1B"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(897045).Z+"",width:"1280",height:"601"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-JSON",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Action": ["sts:AssumeRole"],\n            "Resource": "*"\n        }\n    ]\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"step3-\u914D\u7F6E\u76EE\u6807\u8D26\u6237iam\u89D2\u8272\u4FE1\u4EFB\u7B56\u7565\u548C\u6743\u9650\u7B56\u7565",children:"Step3 \u914D\u7F6E\u76EE\u6807\u8D26\u6237IAM\u89D2\u8272\u4FE1\u4EFB\u7B56\u7565\u548C\u6743\u9650\u7B56\u7565"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\u767B\u5F55 ",(0,c.jsx)(n.a,{href:"https://us-east-1.console.aws.amazon.com/iamv2/home#/home",children:"AWS IAM \u63A7\u5236\u53F0"}),"\uFF0C\u5728\u5DE6\u4FA7\u5BFC\u822A\u680F\u9009\u62E9 ",(0,c.jsx)(n.code,{children:"Access management > Roles"})," \u627E\u5230 ",(0,c.jsx)(n.code,{children:"Assumed Target Role"}),"\uFF0C\u5355\u51FB\u89D2\u8272\u540D\u79F0 \u5728\u89D2\u8272\u8BE6\u60C5\u9875\u4E0A;"]}),"\n",(0,c.jsxs)(n.li,{children:["\u5355\u51FB ",(0,c.jsx)(n.code,{children:"Trust relationships"})," \u9875\u7B7E\uFF0C\u7136\u540E\u5728 ",(0,c.jsx)(n.code,{children:"Trust relationships"})," \u9875\u7B7E\u4E0A\u5355\u51FB ",(0,c.jsx)(n.code,{children:"Edit trust policy"}),"\u3002\u5728 ",(0,c.jsx)(n.code,{children:"Edit trust policy"})," \u9875\u9762\u4E2D\u586B\u5165\u5982\u4E0BJSON\u3002\u6700\u540E\uFF0C\u5355\u51FB ",(0,c.jsx)(n.code,{children:"Update policy"}),"(\u9700\u8981\u628A\u4E0B\u9762\u7B56\u7565\u4E2D\u7684 ",(0,c.jsx)(n.code,{children:"<ec2_iam_role_arn>"})," \u66FF\u6362\u4E3A EC2 \u5B9E\u4F8B\u5173\u8054\u89D2\u8272\u7684 ARN);"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(38772).Z+"",width:"1280",height:"634"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsxs)(n.strong,{children:["\u6CE8\u610F: Condition\u90E8\u5206\u4E2D\u7684ExternalId\u662F\u53EF\u9009\u7684\u5B57\u7B26\u4E32\u914D\u7F6E\uFF0C\u7528\u4E8E\u533A\u5206\u9700\u8981\u4F7F\u7528\u591A\u4E2A\u6E90\u7528\u6237assume \u540C\u4E00\u4E2Arole\u7684\u60C5\u51B5\uFF0C\u5982\u679C\u914D\u7F6E\u4E86\u8BF7\u5728\u5BF9\u5E94doris sql\u8BED\u53E5\u4E2D\u586B\u5165\u8BE5\u914D\u7F6E\uFF0C\u5173\u4E8EExternalId \u7684\u8BE6\u7EC6\u4ECB\u7ECD\uFF0C\u8BF7\u53C2\u7167",(0,c.jsx)(n.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_common-scenarios_third-party.html",children:"aws \u5B98\u65B9\u6587\u6863"})]})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-JSON",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": "<ec2_iam_role_arn>"\n            },\n            "Action": "sts:AssumeRole",\n            "Condition": {\n                "StringEquals": {\n                    "sts:ExternalId": "1001"\n                }\n            }\n        }\n    ]\n}\n'})}),"\n",(0,c.jsxs)(n.ol,{start:"3",children:["\n",(0,c.jsxs)(n.li,{children:["\u5728\u89D2\u8272\u8BE6\u60C5\u9875\u7684 ",(0,c.jsx)(n.code,{children:"Permissions"})," \u533A\u57DF\uFF0C\u5355\u51FB ",(0,c.jsx)(n.code,{children:"Add permissions"})," \u5E76\u9009\u62E9 ",(0,c.jsx)(n.code,{children:"Create inline policy"}),",\u5728 Specify permissions \u6B65\u9AA4, \u5355\u51FB JSON \u9875\u7B7E\uFF0C\u8F93\u5165\u5982\u4E0BJSON\u7B56\u7565\u914D\u7F6E; \u6700\u540E\uFF0C\u5355\u51FB Review policy;"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:s(375386).Z+"",width:"1280",height:"636"})}),"\n",(0,c.jsx)(n.p,{children:"S3 Bucket\u8BFB\u7B56\u7565\u6A21\u7248\uFF0C\u9002\u7528\u4E8E\u53EA\u9700\u8BFB\u53D6\u548CList bucket\u4E2D\u5BF9\u8C61\u7684Doris\u529F\u80FD\uFF0C\u6BD4\u5982S3 Load\uFF0C TVF\uFF0CExternal Catalog\u7B49"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u6CE8\u610F: "})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u66FF\u6362\u5BF9\u5E94\u7684bucket name\u548Cprefix\u8DEF\u5F84"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u4E0D\u8981\u6DFB\u52A0\u591A\u4F59\u7684\u201C/\u201D\u5206\u5272\u7B26"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Action": [\n              "s3:GetObject",\n              "s3:GetObjectVersion"\n            ],\n            "Resource": "arn:aws:s3:::<bucket>/<prefix>/*"\n        },\n        {\n            "Effect": "Allow",\n            "Action": [\n                "s3:ListBucket",\n                "s3:GetBucketLocation"\n            ],\n            "Resource": "arn:aws:s3:::<bucket>",\n        }\n    ]\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"S3 Bucket\u5199\u7B56\u7565\u6A21\u677F, \u9002\u7528\u4E8E\u9700\u8981\u5F80bucket\u4E2D\u8BFB\u53D6\u548C\u5199\u5165\u5BF9\u8C61\u7684Doris\u529F\u80FD\uFF0C\u6BD4\u5982Export\uFF0C Storage Vault\uFF0C Resource\uFF0CRepository\u7B49"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u6CE8\u610F: "})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u66FF\u6362\u5BF9\u5E94\u7684bucket name\u548Cprefix\u8DEF\u5F84"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u4E0D\u8981\u6DFB\u52A0\u591A\u4F59\u7684\u201C/\u201D\u5206\u5272\u7B26"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Action": [\n              "s3:PutObject",\n              "s3:GetObject",\n              "s3:GetObjectVersion",\n              "s3:DeleteObject",\n              "s3:DeleteObjectVersion",\n              "s3:AbortMultipartUpload",      \n              "s3:ListMultipartUploadParts"\n            ],\n            "Resource": "arn:aws:s3:::<bucket>/<prefix>/*"\n        },\n        {\n            "Effect": "Allow",\n            "Action": [\n                "s3:ListBucket",\n                "s3:GetBucketLocation"\n            ],\n            "Resource": "arn:aws:s3:::<bucket>"\n        }\n    ]\n}\n'})}),"\n",(0,c.jsxs)(n.h4,{id:"step4-\u901A\u8FC7role_arn\u548Cexternal_id\u5B57\u6BB5\u4F7F\u7528doris\u5BF9\u5E94sql\u529F\u80FD",children:["Step4 \u901A\u8FC7",(0,c.jsx)(n.code,{children:"role_arn"}),"\u548C",(0,c.jsx)(n.code,{children:"external_id"}),"\u5B57\u6BB5\u4F7F\u7528Doris\u5BF9\u5E94SQL\u529F\u80FD"]}),"\n",(0,c.jsxs)(n.p,{children:["\u901A\u8FC7\u4E0A\u8FF0\u914D\u7F6E\u6B65\u9AA4\u5B8C\u6210assume role\u9700\u8981\u7684\u6743\u9650\u914D\u7F6E\u540E\uFF0C\u53EF\u5F97\u5230\u4E00\u4E2A\u76EE\u6807\u8D26\u6237\u7684",(0,c.jsx)(n.code,{children:"role_arn"}),"\u4FE1\u606F\u548C",(0,c.jsx)(n.code,{children:"external_id"})," (\u5982\u6709)\uFF0C"]}),"\n",(0,c.jsxs)(n.p,{children:["\u63A5\u4E0B\u6765\u5206\u522B\u4ECB\u7ECD\u5982\u4F55\u901A\u8FC7",(0,c.jsx)(n.code,{children:"arn_role"}),"\u548C",(0,c.jsx)(n.code,{children:"external_id"}),"\u5B57\u6BB5\u4F7F\u7528Doris\u5BF9\u5E94\u529F\u80FD\u7684sql\u8BED\u6CD5\uFF0C \u4E3B\u8981\u5173\u6CE8\u5982\u4E0B\u4E24\u4E2A\u5B57\u6BB5\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:'"s3.role_arn" = "<your-target-role-arn>",\n"s3.external_id" = "<your-external-id>"      -- \u53EF\u9009\u53C2\u6570\n'})}),"\n",(0,c.jsx)(n.p,{children:"S3 Load"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'  LOAD LABEL s3_load_2022_04_01\n  (\n      DATA INFILE("s3://your_bucket_name/s3load_example.csv")\n      INTO TABLE test_s3load\n      COLUMNS TERMINATED BY ","\n      FORMAT AS "CSV"\n      (user_id, name, age)\n  )\n  WITH S3\n  (\n      "provider" = "S3",\n      "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n      "s3.region" = "us-east-1",\n      "s3.role_arn" = "<your-target-role-arn>",\n      "s3.external_id" = "<your-external-id>"      -- \u53EF\u9009\u53C2\u6570\n  )\n  PROPERTIES\n  (\n      "timeout" = "3600"\n  );\n'})}),"\n",(0,c.jsx)(n.p,{children:"TVF"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'  SELECT * FROM S3 (\n      "uri" = "s3://your_bucket/path/to/tvf_test/test.parquet",\n      "format" = "parquet",\n      "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n      "s3.region" = "us-east-1",\n      "s3.role_arn" = "<your-target-role-arn>",\n      "s3.external_id" = "<your-external-id>"      -- \u53EF\u9009\u53C2\u6570\n  )\n'})}),"\n",(0,c.jsx)(n.p,{children:"External Catalog"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'  CREATE CATALOG iceberg_catalog PROPERTIES (\n      "type" = "iceberg",\n      "iceberg.catalog.type" = "hadoop",\n      "warehouse" = "s3://your_bucket/dir/key",\n      "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n      "s3.region" = "us-east-1",\n      "s3.role_arn" = "<your-target-role-arn>",\n      "s3.external_id" = "<your-external-id>"      -- \u53EF\u9009\u53C2\u6570\n  );\n'})}),"\n",(0,c.jsx)(n.p,{children:"Storage Vault"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'CREATE STORAGE VAULT IF NOT EXISTS s3_demo_vault\nPROPERTIES (\n    "type" = "S3",\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.bucket" = "<your-bucket>",\n    "s3.role_arn" = "<your-target-role-arn>",\n    "s3.external_id" = "<your-external-id>",            -- \u53EF\u9009\u53C2\u6570\n    "s3.root.path" = "s3_demo_vault_prefix",\n    "provider" = "S3",\n    "use_path_style" = "false"\n);\n'})}),"\n",(0,c.jsx)(n.p,{children:"Export"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'EXPORT TABLE s3_test TO "s3://your_bucket/a/b/c" \nPROPERTIES (\n    "column_separator"="\\\\x07", \n    "line_delimiter" = "\\\\x07"\n) WITH S3 (\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.role_arn" = "<your-target-role-arn>",\n    "s3.external_id" = "<your-external-id>"\n)\n'})}),"\n",(0,c.jsx)(n.p,{children:"Repository"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'CREATE REPOSITORY `s3_repo`\nWITH S3\nON LOCATION "s3://your_bucket/s3_repo"\nPROPERTIES\n(\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.role_arn" = "<your-target-role-arn>",\n    "s3.external_id" = "<your-external-id>"\n);\n'})}),"\n",(0,c.jsx)(n.p,{children:"Resource"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-SQL",children:'CREATE RESOURCE "remote_s3"\nPROPERTIES\n(\n    "s3.endpoint" = "s3.us-east-1.amazonaws.com",\n    "s3.region" = "us-east-1",\n    "s3.bucket" = "<your-bucket>",\n    "s3.role_arn" = "<your-target-role-arn>",\n    "s3.external_id" = "<your-external-id>"\n);\n'})})]})}function u(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},214010:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/assumed_role_flow-837d28757ca8913718b05b66b6b82ce2.png"},622756:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/create_iam_user-2f5798289db11561f58996f843a57007.png"},682778:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/ec2_instance-8a07fa1579df9c49f28d1afeb8b43320.png"},378198:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/iam_user_attach_policy1-82e3e146a7e676f875e6b8ec7a976eb8.png"},285612:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/iam_user_attach_policy2-3dd286ac1d3849842ffc68dbe63ff671.png"},808504:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/iam_user_create_ak_sk-6085deeaca04ff0daec92673dda55f45.png"},897045:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/source_role_permission-39ded5d47d26095cb01555e8fd159001.png"},375386:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/target_role_permission2-62b5c0254e966762f0c5f299499b6bdd.png"},38772:function(e,n,s){s.d(n,{Z:function(){return r}});let r=s.p+"assets/images/target_role_trust_policy-86ffe376e4663a12a675419bfb4e6e70.png"},250065:function(e,n,s){s.d(n,{Z:function(){return a},a:function(){return i}});var r=s(667294);let c={},t=r.createContext(c);function i(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);