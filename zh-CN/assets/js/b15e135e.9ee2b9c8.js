"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["3899"],{405788:function(n,e,s){s.r(e),s.d(e,{default:()=>a,frontMatter:()=>d,metadata:()=>i,assets:()=>t,toc:()=>o,contentTitle:()=>c});var i=JSON.parse('{"id":"query/udf/remote-user-defined-function","title":"Remote UDF","description":"\x3c!--","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-2.0/query/udf/remote-user-defined-function.md","sourceDirName":"query/udf","slug":"/query/udf/remote-user-defined-function","permalink":"/zh-CN/docs/2.0/query/udf/remote-user-defined-function","draft":false,"unlisted":false,"tags":[],"version":"2.0","frontMatter":{"title":"Remote UDF","language":"zh-CN"},"sidebar":"docs","previous":{"title":"Java UDF","permalink":"/zh-CN/docs/2.0/query/udf/java-user-defined-function"},"next":{"title":"\u6E56\u4ED3\u4E00\u4F53\u6982\u8FF0","permalink":"/zh-CN/docs/2.0/lakehouse/lakehouse-overview"}}'),r=s("785893"),l=s("250065");let d={title:"Remote UDF",language:"zh-CN"},c=void 0,t={},o=[{value:"Remote UDF",id:"remote-udf",level:2},{value:"\u7F16\u5199 UDF \u51FD\u6570",id:"\u7F16\u5199-udf-\u51FD\u6570",level:2},{value:"\u62F7\u8D1D proto \u6587\u4EF6",id:"\u62F7\u8D1D-proto-\u6587\u4EF6",level:3},{value:"\u751F\u6210\u63A5\u53E3",id:"\u751F\u6210\u63A5\u53E3",level:3},{value:"\u5B9E\u73B0\u63A5\u53E3",id:"\u5B9E\u73B0\u63A5\u53E3",level:3},{value:"\u521B\u5EFA UDF",id:"\u521B\u5EFA-udf",level:2},{value:"\u4F7F\u7528 UDF",id:"\u4F7F\u7528-udf",level:2},{value:"\u5220\u9664 UDF",id:"\u5220\u9664-udf",level:2},{value:"\u793A\u4F8B",id:"\u793A\u4F8B",level:2}];function h(n){let e={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"remote-udf",children:"Remote UDF"}),"\n",(0,r.jsx)(e.p,{children:"Remote UDF Service \u652F\u6301\u901A\u8FC7 RPC \u7684\u65B9\u5F0F\u8BBF\u95EE\u7528\u6237\u63D0\u4F9B\u7684 UDF Service\uFF0C\u4EE5\u5B9E\u73B0\u7528\u6237\u81EA\u5B9A\u4E49\u51FD\u6570\u7684\u6267\u884C\u3002\u76F8\u6BD4\u4E8E Native \u7684 UDF \u5B9E\u73B0\uFF0CRemote UDF Service \u6709\u5982\u4E0B\u4F18\u52BF\u548C\u9650\u5236\uFF1A"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"1. \u4F18\u52BF"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8DE8\u8BED\u8A00\uFF1A\u53EF\u4EE5\u7528 Protobuf \u652F\u6301\u7684\u5404\u7C7B\u8BED\u8A00\u7F16\u5199 UDF Service\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5B89\u5168\uFF1AUDF \u6267\u884C\u5931\u8D25\u6216\u5D29\u6E83\uFF0C\u4EC5\u4F1A\u5F71\u54CD UDF Service \u81EA\u8EAB\uFF0C\u800C\u4E0D\u4F1A\u5BFC\u81F4 Doris \u8FDB\u7A0B\u5D29\u6E83\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7075\u6D3B\uFF1AUDF Service \u4E2D\u53EF\u4EE5\u8C03\u7528\u4EFB\u610F\u5176\u4ED6\u670D\u52A1\u6216\u7A0B\u5E8F\u5E93\u7C7B\uFF0C\u4EE5\u6EE1\u8DB3\u66F4\u591A\u6837\u7684\u4E1A\u52A1\u9700\u6C42\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"2. \u4F7F\u7528\u9650\u5236"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u6027\u80FD\uFF1A\u76F8\u6BD4\u4E8E Native UDF\uFF0CUDF Service \u4F1A\u5E26\u6765\u989D\u5916\u7684\u7F51\u7EDC\u5F00\u9500\uFF0C\u56E0\u6B64\u6027\u80FD\u4F1A\u8FDC\u4F4E\u4E8E Native UDF\u3002\u540C\u65F6\uFF0CUDF Service \u81EA\u8EAB\u7684\u5B9E\u73B0\u4E5F\u4F1A\u5F71\u54CD\u51FD\u6570\u7684\u6267\u884C\u6548\u7387\uFF0C\u7528\u6237\u9700\u8981\u81EA\u884C\u5904\u7406\u9AD8\u5E76\u53D1\u3001\u7EBF\u7A0B\u5B89\u5168\u7B49\u95EE\u9898\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5355\u884C\u6A21\u5F0F\u548C\u6279\u5904\u7406\u6A21\u5F0F\uFF1ADoris \u539F\u5148\u7684\u57FA\u4E8E\u884C\u5B58\u7684\u67E5\u8BE2\u6267\u884C\u6846\u67B6\u4F1A\u5BF9\u6BCF\u4E00\u884C\u6570\u636E\u6267\u884C\u4E00\u6B21 UDF RPC \u8C03\u7528\uFF0C\u56E0\u6B64\u6267\u884C\u6548\u7387\u975E\u5E38\u5DEE\uFF0C\u800C\u5728\u65B0\u7684\u5411\u91CF\u5316\u6267\u884C\u6846\u67B6\u4E0B\uFF0C\u4F1A\u5BF9\u6BCF\u4E00\u6279\u6570\u636E\uFF08\u9ED8\u8BA4 2048 \u884C\uFF09\u6267\u884C\u4E00\u6B21 UDF RPC \u8C03\u7528\uFF0C\u56E0\u6B64\u6027\u80FD\u6709\u660E\u663E\u63D0\u5347\u3002\u5B9E\u9645\u6D4B\u8BD5\u4E2D\uFF0C\u57FA\u4E8E\u5411\u91CF\u5316\u548C\u6279\u5904\u7406\u65B9\u5F0F\u7684 Remote UDF \u6027\u80FD\u548C\u57FA\u4E8E\u884C\u5B58\u7684 Native UDF \u6027\u80FD\u76F8\u5F53\uFF0C\u53EF\u4F9B\u53C2\u8003\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u7F16\u5199-udf-\u51FD\u6570",children:"\u7F16\u5199 UDF \u51FD\u6570"}),"\n",(0,r.jsxs)(e.p,{children:["\u672C\u5C0F\u8282\u4E3B\u8981\u4ECB\u7ECD\u5982\u4F55\u5F00\u53D1\u4E00\u4E2A Remote RPC service\u3002\u5728 ",(0,r.jsx)(e.code,{children:"samples/doris-demo/udf-demo/"})," \u4E0B\u63D0\u4F9B\u4E86 Java \u7248\u672C\u7684\u793A\u4F8B\uFF0C\u53EF\u4F9B\u53C2\u8003\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"\u62F7\u8D1D-proto-\u6587\u4EF6",children:"\u62F7\u8D1D proto \u6587\u4EF6"}),"\n",(0,r.jsx)(e.p,{children:"\u62F7\u8D1D gensrc/proto/function_service.proto \u548C gensrc/proto/types.proto \u5230 Rpc \u670D\u52A1\u4E2D"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"function_service.proto"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"PFunctionCallRequest"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"function_name\uFF1A\u51FD\u6570\u540D\u79F0\uFF0C\u5BF9\u5E94\u521B\u5EFA\u51FD\u6570\u65F6\u6307\u5B9A\u7684 symbol"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"args\uFF1A\u65B9\u6CD5\u4F20\u9012\u7684\u53C2\u6570"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"context\uFF1A\u67E5\u8BE2\u4E0A\u4E0B\u6587\u4FE1\u606F"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"PFunctionCallResponse"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"result\uFF1A\u7ED3\u679C"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"status\uFF1A\u72B6\u6001\uFF0C0 \u4EE3\u8868\u6B63\u5E38"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"PCheckFunctionRequest"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"function\uFF1A\u51FD\u6570\u76F8\u5173\u4FE1\u606F"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"match_type\uFF1A\u5339\u914D\u7C7B\u578B"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"PCheckFunctionResponse"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"status\uFF1A\u72B6\u6001\uFF0C0 \u4EE3\u8868\u6B63\u5E38"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u751F\u6210\u63A5\u53E3",children:"\u751F\u6210\u63A5\u53E3"}),"\n",(0,r.jsx)(e.p,{children:"\u901A\u8FC7 protoc \u751F\u6210\u4EE3\u7801\uFF0C\u5177\u4F53\u53C2\u6570\u901A\u8FC7 protoc -h \u67E5\u770B"}),"\n",(0,r.jsx)(e.h3,{id:"\u5B9E\u73B0\u63A5\u53E3",children:"\u5B9E\u73B0\u63A5\u53E3"}),"\n",(0,r.jsx)(e.p,{children:"\u5171\u9700\u8981\u5B9E\u73B0\u4EE5\u4E0B\u4E09\u4E2A\u65B9\u6CD5"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"fnCall\uFF1A\u7528\u4E8E\u7F16\u5199\u8BA1\u7B97\u903B\u8F91"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"checkFn\uFF1A\u7528\u4E8E\u521B\u5EFA UDF \u65F6\u6821\u9A8C\uFF0C\u6821\u9A8C\u51FD\u6570\u540D/\u53C2\u6570/\u8FD4\u56DE\u503C\u7B49\u662F\u5426\u5408\u6CD5"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"handShake\uFF1A\u7528\u4E8E\u63A5\u53E3\u63A2\u6D3B"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u521B\u5EFA-udf",children:"\u521B\u5EFA UDF"}),"\n",(0,r.jsx)(e.p,{children:"\u76EE\u524D\u6682\u4E0D\u652F\u6301 UDTF"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:'CREATE FUNCTION \nname ([,...])\n[RETURNS] rettype\nPROPERTIES (["key"="value"][,...])	\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u8BF4\u660E\uFF1A"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["PROPERTIES \u4E2D",(0,r.jsx)(e.code,{children:"symbol"}),"\u8868\u793A\u7684\u662F rpc \u8C03\u7528\u4F20\u9012\u7684\u65B9\u6CD5\u540D\uFF0C\u8FD9\u4E2A\u53C2\u6570\u662F\u5FC5\u987B\u8BBE\u5B9A\u7684\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["PROPERTIES \u4E2D",(0,r.jsx)(e.code,{children:"object_file"}),"\u8868\u793A\u7684 rpc \u670D\u52A1\u5730\u5740\uFF0C\u76EE\u524D\u652F\u6301\u5355\u4E2A\u5730\u5740\u548C brpc \u517C\u5BB9\u683C\u5F0F\u7684\u96C6\u7FA4\u5730\u5740\uFF0C\u96C6\u7FA4\u8FDE\u63A5\u65B9\u5F0F \u53C2\u8003 ",(0,r.jsx)(e.a,{href:"https://github.com/apache/brpc/blob/master/docs/cn/client.md#%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4",children:"\u683C\u5F0F\u8BF4\u660E"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["PROPERTIES \u4E2D",(0,r.jsx)(e.code,{children:"type"}),"\u8868\u793A\u7684 UDF \u8C03\u7528\u7C7B\u578B\uFF0C\u9ED8\u8BA4\u4E3A Native\uFF0C\u4F7F\u7528 Rpc UDF \u65F6\u4F20 RPC\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["name: \u4E00\u4E2A function \u662F\u8981\u5F52\u5C5E\u4E8E\u67D0\u4E2A DB \u7684\uFF0Cname \u7684\u5F62\u5F0F\u4E3A",(0,r.jsx)(e.code,{children:"dbName"}),".",(0,r.jsx)(e.code,{children:"funcName"}),"\u3002\u5F53",(0,r.jsx)(e.code,{children:"dbName"}),"\u6CA1\u6709\u660E\u786E\u6307\u5B9A\u7684\u65F6\u5019\uFF0C\u5C31\u662F\u4F7F\u7528\u5F53\u524D session \u6240\u5728\u7684 db \u4F5C\u4E3A",(0,r.jsx)(e.code,{children:"dbName"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u793A\u4F8B\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:'CREATE FUNCTION rpc_add_two(INT,INT) RETURNS INT PROPERTIES (\n  "SYMBOL"="add_int_two",\n  "OBJECT_FILE"="127.0.0.1:9114",\n  "TYPE"="RPC"\n);\nCREATE FUNCTION rpc_add_one(INT) RETURNS INT PROPERTIES (\n  "SYMBOL"="add_int_one",\n  "OBJECT_FILE"="127.0.0.1:9114",\n  "TYPE"="RPC"\n);\nCREATE FUNCTION rpc_add_string(varchar(30)) RETURNS varchar(30) PROPERTIES (\n  "SYMBOL"="add_string",\n  "OBJECT_FILE"="127.0.0.1:9114",\n  "TYPE"="RPC"\n);\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u4F7F\u7528-udf",children:"\u4F7F\u7528 UDF"}),"\n",(0,r.jsxs)(e.p,{children:["\u7528\u6237\u4F7F\u7528 UDF \u5FC5\u987B\u62E5\u6709\u5BF9\u5E94\u6570\u636E\u5E93\u7684 ",(0,r.jsx)(e.code,{children:"SELECT"})," \u6743\u9650\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["UDF \u7684\u4F7F\u7528\u4E0E\u666E\u901A\u7684\u51FD\u6570\u65B9\u5F0F\u4E00\u81F4\uFF0C\u552F\u4E00\u7684\u533A\u522B\u5728\u4E8E\uFF0C\u5185\u7F6E\u51FD\u6570\u7684\u4F5C\u7528\u57DF\u662F\u5168\u5C40\u7684\uFF0C\u800C UDF \u7684\u4F5C\u7528\u57DF\u662F DB \u5185\u90E8\u3002\u5F53\u94FE\u63A5 session \u4F4D\u4E8E\u6570\u636E\u5185\u90E8\u65F6\uFF0C\u76F4\u63A5\u4F7F\u7528 UDF \u540D\u5B57\u4F1A\u5728\u5F53\u524D DB \u5185\u90E8\u67E5\u627E\u5BF9\u5E94\u7684 UDF\u3002\u5426\u5219\u7528\u6237\u9700\u8981\u663E\u793A\u7684\u6307\u5B9A UDF \u7684\u6570\u636E\u5E93\u540D\u5B57\uFF0C\u4F8B\u5982 ",(0,r.jsx)(e.code,{children:"dbName"}),".",(0,r.jsx)(e.code,{children:"funcName"}),"\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u5220\u9664-udf",children:"\u5220\u9664 UDF"}),"\n",(0,r.jsxs)(e.p,{children:["\u5F53\u4F60\u4E0D\u518D\u9700\u8981 UDF \u51FD\u6570\u65F6\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7\u4E0B\u8FF0\u547D\u4EE4\u6765\u5220\u9664\u4E00\u4E2A UDF \u51FD\u6570\uFF0C\u53EF\u4EE5\u53C2\u8003 ",(0,r.jsx)(e.code,{children:"DROP FUNCTION"}),"\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u793A\u4F8B",children:"\u793A\u4F8B"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728",(0,r.jsx)(e.code,{children:"samples/doris-demo/"})," \u76EE\u5F55\u4E2D\u63D0\u4F9B\u548C cpp/java/python \u8BED\u8A00\u7684 rpc server \u5B9E\u73B0\u793A\u4F8B\u3002\u5177\u4F53\u4F7F\u7528\u65B9\u6CD5\u89C1\u6BCF\u4E2A\u76EE\u5F55\u4E0B\u7684",(0,r.jsx)(e.code,{children:"README.md"}),"\n\u4F8B\u5982 rpc_add_string"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"mysql >select rpc_add_string('doris');\n+-------------------------+\n| rpc_add_string('doris') |\n+-------------------------+\n| doris_rpc_test          |\n+-------------------------+\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u65E5\u5FD7\u4F1A\u663E\u793A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-text",children:'INFO: fnCall request=function_name: "add_string"\nargs {\n  type {\n    id: STRING\n  }\n  has_null: false\n  string_value: "doris"\n}\nINFO: fnCall res=result {\n  type {\n    id: STRING\n  }\n  has_null: false\n  string_value: "doris_rpc_test"\n}\nstatus {\n  status_code: 0\n}\n'})})]})}function a(n={}){let{wrapper:e}={...(0,l.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}},250065:function(n,e,s){s.d(e,{Z:function(){return c},a:function(){return d}});var i=s(667294);let r={},l=i.createContext(r);function d(n){let e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);